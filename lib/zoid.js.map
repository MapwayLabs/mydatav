{"version":3,"sources":["webpack://zoid/webpack/universalModuleDefinition","webpack://zoid/webpack/bootstrap","webpack://zoid/./node_modules/belter/src/device.js","webpack://zoid/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://zoid/./node_modules/zalgo-promise/src/utils.js","webpack://zoid/./node_modules/zalgo-promise/src/exceptions.js","webpack://zoid/./node_modules/zalgo-promise/src/flush.js","webpack://zoid/./node_modules/zalgo-promise/src/promise.js","webpack://zoid/./node_modules/cross-domain-utils/src/util.js","webpack://zoid/./node_modules/cross-domain-utils/src/constants.js","webpack://zoid/./node_modules/cross-domain-utils/src/utils.js","webpack://zoid/./node_modules/cross-domain-utils/src/types.js","webpack://zoid/./node_modules/cross-domain-utils/src/index.js","webpack://zoid/./node_modules/cross-domain-safe-weakmap/src/native.js","webpack://zoid/./node_modules/cross-domain-safe-weakmap/src/util.js","webpack://zoid/./node_modules/cross-domain-safe-weakmap/src/weakmap.js","webpack://zoid/./node_modules/belter/src/util.js","webpack://zoid/./node_modules/belter/src/constants.js","webpack://zoid/./node_modules/belter/src/dom.js","webpack://zoid/./node_modules/belter/src/storage.js","webpack://zoid/./node_modules/belter/src/experiment.js","webpack://zoid/./node_modules/belter/src/global.js","webpack://zoid/./node_modules/belter/src/http.js","webpack://zoid/./node_modules/belter/src/types.js","webpack://zoid/./node_modules/belter/src/decorators.js","webpack://zoid/./node_modules/belter/src/css.js","webpack://zoid/./node_modules/belter/src/test.js","webpack://zoid/./node_modules/belter/src/index.js","webpack://zoid/./node_modules/post-robot/src/conf/config.js","webpack://zoid/./node_modules/post-robot/src/conf/constants.js","webpack://zoid/./node_modules/post-robot/src/conf/index.js","webpack://zoid/./node_modules/post-robot/src/global.js","webpack://zoid/./node_modules/post-robot/src/lib/hello.js","webpack://zoid/./node_modules/post-robot/src/lib/compat.js","webpack://zoid/./node_modules/post-robot/src/lib/windows.js","webpack://zoid/./node_modules/post-robot/src/lib/index.js","webpack://zoid/./node_modules/universal-serialize/src/constants.js","webpack://zoid/./node_modules/universal-serialize/src/common.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/array.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/boolean.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/date.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/error.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/function.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/number.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/object.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/promise.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/regex.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/string.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/null.js","webpack://zoid/./node_modules/universal-serialize/src/serializers/index.js","webpack://zoid/./node_modules/universal-serialize/src/serialize.js","webpack://zoid/./node_modules/universal-serialize/src/deserialize.js","webpack://zoid/./node_modules/universal-serialize/src/types.js","webpack://zoid/./node_modules/universal-serialize/src/index.js","webpack://zoid/./node_modules/post-robot/src/bridge/bridge.js","webpack://zoid/./node_modules/post-robot/src/bridge/common.js","webpack://zoid/./node_modules/post-robot/src/bridge/child.js","webpack://zoid/./node_modules/post-robot/src/bridge/parent.js","webpack://zoid/./node_modules/post-robot/src/bridge/setup.js","webpack://zoid/./node_modules/post-robot/src/bridge/index.js","webpack://zoid/./node_modules/post-robot/src/serialize/window.js","webpack://zoid/./node_modules/post-robot/src/serialize/function.js","webpack://zoid/./node_modules/post-robot/src/serialize/promise.js","webpack://zoid/./node_modules/post-robot/src/serialize/serialize.js","webpack://zoid/./node_modules/post-robot/src/serialize/index.js","webpack://zoid/./node_modules/post-robot/src/drivers/send/strategies.js","webpack://zoid/./node_modules/post-robot/src/drivers/send/index.js","webpack://zoid/./node_modules/post-robot/src/drivers/listeners.js","webpack://zoid/./node_modules/post-robot/src/drivers/receive/types.js","webpack://zoid/./node_modules/post-robot/src/drivers/receive/index.js","webpack://zoid/./node_modules/post-robot/src/drivers/index.js","webpack://zoid/./node_modules/post-robot/src/public/on.js","webpack://zoid/./node_modules/post-robot/src/public/send.js","webpack://zoid/./node_modules/post-robot/src/public/index.js","webpack://zoid/./node_modules/post-robot/src/setup.js","webpack://zoid/./node_modules/post-robot/src/types.js","webpack://zoid/./node_modules/post-robot/src/clean.js","webpack://zoid/./node_modules/post-robot/src/index.js","webpack://zoid/./src/lib/global.js","webpack://zoid/./src/lib/serialize.js","webpack://zoid/./src/lib/index.js","webpack://zoid/./src/constants.js","webpack://zoid/./src/child/props.js","webpack://zoid/./src/child/window.js","webpack://zoid/./src/child/index.js","webpack://zoid/./src/parent/drivers.js","webpack://zoid/./src/parent/props.js","webpack://zoid/./src/parent/index.js","webpack://zoid/./src/delegate/index.js","webpack://zoid/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://zoid/./src/drivers/react.js","webpack://zoid/./src/drivers/vue.js","webpack://zoid/./src/drivers/angular.js","webpack://zoid/./src/drivers/angular2.js","webpack://zoid/./src/drivers/index.js","webpack://zoid/./src/component/validate.js","webpack://zoid/./src/component/templates/container.js","webpack://zoid/./src/component/templates/component.js","webpack://zoid/./src/component/templates/index.js","webpack://zoid/./src/component/props.js","webpack://zoid/./src/component/component.js","webpack://zoid/./src/component/index.js","webpack://zoid/./src/index.js"],"names":["getUserAgent","window","navigator","mockUserAgent","userAgent","isDevice","match","isWebView","test","isStandAlone","standalone","matchMedia","matches","isFacebookWebView","ua","indexOf","isFirefoxIOS","isEdgeIOS","isOperaMini","isAndroid","isIos","isGoogleSearchApp","isQQBrowser","isIosWebview","isAndroidWebview","isIE","document","documentMode","Boolean","isIECompHeader","mHttp","querySelector","mContent","isElectron","process","versions","electron","isIEIntranet","status","err","isMacOsCna","supportsPopups","isChrome","isSafari","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","isPromise","item","Promise","Window","constructor","toString","name","then","dispatchedErrors","possiblyUnhandledPromiseHandlers","dispatchPossiblyUnhandledError","promise","push","setTimeout","__DEBUG__","j","onPossiblyUnhandledException","handler","cancel","splice","activeCount","flushPromise","flushActive","resolve","startActive","endActive","awaitActive","Zalgo","ZalgoPromise","resolved","rejected","errorHandled","value","error","handlers","dispatching","stack","result","isAsync","res","reject","Error","dispatch","asyncReject","chain","firstPromise","secondPromise","onSuccess","onError","catch","undefined","finally","onFinally","try","timeout","time","clearTimeout","toPromise","TypeError","all","promises","count","results","prom","hash","keys","map","items","method","context","args","delay","flush","isRegex","noop","PROTOCOL","MOCK","FILE","ABOUT","WILDCARD","WINDOW_TYPE","IFRAME","POPUP","IE_WIN_ACCESS_ERROR","isFileProtocol","win","location","protocol","isAboutProtocol","getParent","parent","getOpener","opener","canReadFromWindow","href","getActualDomain","host","getDomain","domain","mockDomain","isBlankDomain","isActuallySameDomain","desc","getOwnPropertyDescriptor","enumerable","isSameDomain","assertSameDomain","getParents","isAncestorParent","child","childParent","getFrames","frames","len","frame","getAllChildFrames","childFrame","getTop","top","getNextOpener","getUltimateTop","getAllFramesInWindow","getAllWindows","isTop","isFrameWindowClosed","contentWindow","parentNode","doc","ownerDocument","documentElement","contains","safeIndexOf","collection","iframeWindows","iframeFrames","isWindowClosed","allowMock","closed","message","mockclosed","iframeIndex","cleanIframes","linkFrameWindow","getFrameByName","winFrames","findChildFrameByName","namedFrame","findFrameByName","isParent","frameParent","isOpener","getAncestor","getAncestors","ancestor","isAncestor","actualParent","isPopup","isIframe","isFullpage","anyMatch","collection1","collection2","item1","item2","getDistanceFromTop","distance","getNthParent","n","getNthParentFromTop","isSameTopWindow","win1","win2","top1","top2","allFrames1","allFrames2","opener1","opener2","matchDomain","pattern","origin","Array","isArray","JSON","stringify","some","subpattern","stringifyDomainPattern","join","getDomainFromUrl","url","split","slice","onCloseWindow","callback","maxtime","Infinity","check","isWindow","obj","self","__cross_domain_utils_window_check__","isBrowser","isCurrentDomain","isMockDomain","normalizeMockUrl","replace","closeWindow","close","getFrameForWindow","frameElement","querySelectorAll","TYPES","hasNativeWeakMap","WeakMap","freeze","testWeakMap","testKey","testValue","set","get","CrossDomainSafeWeakMap","weakmap","values","Math","random","_cleanupClosedWindows","delete","isSafeToReadWrite","entry","defineProperty","writable","index","has","getOrSet","getter","getFunctionName","fn","__name__","displayName","setFunctionName","base64encode","str","btoa","encodeURIComponent","m","p1","String","fromCharCode","parseInt","Buffer","from","base64decode","atob","decodeURIComponent","c","charCodeAt","uniqueID","chars","randomID","charAt","floor","timeID","Date","toISOString","toLowerCase","getGlobal","global","__GLOBAL__","objectIDs","getObjectID","uid","serializeArgs","subkey","val","memoize","options","cacheMap","memoizedFunction","cache","thisNamespace","cacheTime","now","reset","promiseIdentity","memoizePromise","memoizedPromiseFunction","promisify","promisifiedFunction","inlineMemoize","logic","__inline_memoize_cache__","once","called","onceFunction","hashStr","pow","sqrt","strHashStr","total","abs","regmatch","awaitKey","configurable","stringifyError","level","newErr","stringifyErrorMessage","defaultMessage","domainMatches","hostname","patchMethod","original","patchedMethod","callOriginal","extend","perc","pixels","percentage","round","min","max","regexMap","regexp","regexMapMatcher","svgToBase64","svg","objFilter","filter","identity","regexTokenize","text","token","promiseDebounce","promiseDebounced","localPromise","safeInterval","loop","isInteger","isFloat","serializePrimitive","deserializePrimitive","parseFloat","dotify","prefix","newobj","every","undotify","keyResult","parts","part","isLast","isIndex","eventEmitter","triggered","on","eventName","handlerList","cancelled","listener","trigger","triggerOnce","camelToDasherize","string","g","dasherizeToCamel","toUpperCase","capitalizeFirstLetter","path","def","pathParts","safeTimeout","interval","defineLazyProp","arrayFrom","isObject","isObjectObject","isPlainObject","replaceObject","replacer","fullKey","itemKey","el","copyProp","descriptor","regex","start","RegExp","groups","end","regexAll","isDefined","cycle","debounce","debounceWrapper","weakMapMemoize","weakmapMemoized","arg","weakMapMemoizePromise","weakmapMemoizedPromise","cleanup","tasks","cleaned","register","task","pop","tryCatch","removeFromArray","arr","assertExists","thing","unique","KEY_CODES","ENTER","isDocumentReady","body","readyState","urlEncode","waitForWindowReady","addEventListener","waitForDocumentReady","setInterval","clearInterval","waitForDocumentBody","parseQuery","queryString","params","pair","getQueryParam","search","urlWillRedirectPage","formatQuery","extendQuery","originalQuery","props","extendUrl","query","originalUrl","originalHash","hashString","redirect","hasMetaViewPort","meta","screen","width","isElementVisible","offsetWidth","offsetHeight","getClientRects","enablePerformance","performance","timing","connectEnd","navigationStart","getPageRenderTime","domInteractive","htmlEncode","html","selector","onClick","element","event","keyCode","getScript","scripts","getElementsByTagName","script","src","isLocalStorageEnabled","localStorage","setItem","getItem","removeItem","getBrowserLocales","nav","locales","languages","language","userLanguage","locale","lang","country","appendChild","container","isElement","Element","nodeType","style","getElementSafe","id","getElement","elementReady","PopupOpenError","create","popup","height","left","outerWidth","screenX","outerHeight","screenY","toolbar","menubar","resizable","scrollbars","open","writeToWindow","write","err2","writeElementToWindow","tag","tagName","children","removeChild","setStyle","styleText","styleSheet","cssText","createTextNode","awaitFrameLoadPromises","awaitFrameLoad","awaitFrameWindow","loadedFrame","createElement","class","className","setAttribute","attributes","innerHTML","iframe","allowTransparency","backgroundColor","border","hasAttribute","removeEventListener","bindEvents","eventNames","VENDOR_PREFIXES","setVendorCSS","capitalizedName","ANIMATION_START_EVENTS","ANIMATION_END_EVENTS","animate","clean","hasStarted","startTimeout","endTimeout","startEvent","endEvent","cleanUp","animationName","stopPropagation","STYLE","DISPLAY","NONE","BLOCK","VISIBILITY","VISIBLE","HIDDEN","IMPORTANT","makeElementVisible","setProperty","makeElementInvisible","showElement","hideElement","destroyElement","showAndAnimate","animation","animateAndHide","addClass","classList","add","removeClass","remove","isElementClosed","watchElementForClose","fixScripts","newScript","textContent","replaceChild","onResize","currentWidth","currentHeight","newWidth","newHeight","observer","ResizeObserver","observe","MutationObserver","childList","subtree","characterData","disconnect","getResourceLoadTime","getEntries","entries","duration","DEFAULT_SESSION_STORAGE","getStorage","lifetime","STORAGE_KEY","accessedStorage","getState","localStorageEnabled","storage","rawStorage","parse","getID","getSession","session","__session__","created","guid","getSessionState","state","getSessionID","getBelterExperimentStorage","isEventUnique","loggedBeacons","getThrottlePercentile","throttlePercentiles","THROTTLE_GROUP","TEST","CONTROL","THROTTLE","experiment","sample","logTreatment","logCheckpoint","throttle","group","treatment","started","forced","isEnabled","isDisabled","getTreatment","log","checkpoint","payload","logStart","logComplete","getGlobalNameSpace","version","globalKey","namespace","defValue","HEADERS","CONTENT_TYPE","ACCEPT","headerBuilders","parseHeaders","rawHeaders","trim","line","request","headers","json","data","normalizedHeaders","headerBuilder","builtHeaders","xhr","XMLHttpRequest","xhrLoad","responseHeaders","getAllResponseHeaders","contentType","isJSON","responseBody","responseText","evt","setRequestHeader","ontimeout","xhrTimeout","send","addHeaderBuilder","memoized","isPerc","isPx","toNum","toPx","toCSS","percOf","num","normalizeDimension","dim","wrapPromise","expected","timer","expect","expectWrapper","avoid","avoidWrapper","expectError","expectErrorWrapper","drain","BRIDGE_TIMEOUT","CHILD_WINDOW_TIMEOUT","ACK_TIMEOUT","ACK_TIMEOUT_KNOWN","RES_TIMEOUT","__TEST__","RESPONSE_CYCLE_TIME","MESSAGE_TYPE","REQUEST","RESPONSE","ACK","MESSAGE_ACK","SUCCESS","ERROR","MESSAGE_NAME","METHOD","HELLO","OPEN_TUNNEL","SEND_STRATEGY","POST_MESSAGE","BRIDGE","GLOBAL","BRIDGE_NAME_PREFIX","POSTROBOT_PROXY","SERIALIZATION_TYPE","CROSS_DOMAIN_ZALGO_PROMISE","CROSS_DOMAIN_FUNCTION","CROSS_DOMAIN_WINDOW","__POST_ROBOT__","deleteGlobal","getObj","globalStore","defStore","store","storeKey","defVal","del","WildCard","getWildcard","WINDOW_WILDCARD","windowStore","winStore","getStore","getInstanceID","getHelloPromise","helloPromises","resolveHelloPromise","existingPromise","newPromise","listenForHello","instanceID","sayHello","getWindowInstanceID","initHello","awaitWindowHello","needsGlobalMessagingForBrowser","markWindowKnown","knownWindows","isWindowKnown","TYPE","FUNCTION","PROMISE","REGEX","DATE","ARRAY","OBJECT","STRING","NUMBER","BOOLEAN","NULL","UNDEFINED","isSerializedType","__type__","determineType","serializeType","type","__val__","serializeArray","deserializeArray","serializeBoolean","deserializeBoolean","serializeDate","toJSON","deserializeDate","serializeError","code","deserializeError","serializeFunction","deserializeFunction","serializeNumber","deserializeNumber","serializeObject","deserializeObject","serializePromise","deserializePromise","serializeRegex","deserializeRegex","serializeString","deserializeString","serializeNull","deserializeNull","SERIALIZER","defaultSerializers","serialize","serializers","serializer","DESERIALIZER","defaultDeserializers","deserialize","deserializers","deserializer","cleanTunnelWindows","tunnelWindows","tunnelWindow","addTunnelWindow","canary","sendMessage","setupOpenTunnelToParent","openTunnelToParent","parentWindow","needsBridgeForBrowser","needsBridgeForWin","needsBridgeForDomain","needsBridge","getBridgeName","sanitizedDomain","isBridge","documentBodyReady","registerRemoteWindow","remoteWindowPromises","findRemoteWindow","remoteWinPromise","registerRemoteSendMessage","sendMessageWrapper","remoteWin","remoteDomain","fireAndForget","rejectRemoteSendMessage","sendBridgeMessage","messagingChild","messagingParent","awaitRemoteBridgeForWindow","openTunnelToOpener","receiveMessage","bridge","listenForOpenTunnel","popupWindowsByName","bridgePromise","winDetails","openBridgeFrame","hasBridge","bridges","openBridge","bridgeFrames","linkWindow","popupWindowsByWin","winName","details","linkUrl","listenForWindowOpen","windowOpen","windowOpenWrapper","last","destroyBridges","setupBridge","cleanupProxyWindows","idToProxyWindow","shouldClean","getSerializedWindow","winPromise","windowNamePromise","getType","getName","focus","isClosed","setLocation","setName","sameDomain","ProxyWindow","serializedWindow","isProxyWindow","actualWindow","actualWindowPromise","setWindow","isPopupPromise","getNamePromise","reopenPromise","focusPromise","getWindow","awaitWindow","matchWindow","proxyInstanceID","knownWindowInstanceID","unwrap","toProxyWindow","serializeWindow","destination","deserializeWindow","addMethod","methodStore","proxyWindowMethods","methods","lookupMethod","listenForFunctionCalls","meth","methodSource","__id__","getDeserializedFunction","opts","crossDomainFunctionWrapper","originalStack","__origin__","__source__","serializeMessage","deserializeMessage","serializedPromise","serializedFunction","SEND_MESSAGE_STRATEGIES","serializedMessage","domains","dom","forEach","postMessage","foreignGlobal","strategies","errors","strategyName","resetListeners","responseListeners","erroredResponseListeners","__DOMAIN_REGEX__","addResponseListener","getResponseListener","deleteResponseListener","cancelResponseListeners","markResponseListenerErrored","isResponseListenerErrored","getRequestListener","requestListeners","winQualifier","nameListeners","domainListeners","addRequestListener","listenersCollection","cancelListener","existingListener","strDomain","regexListeners","regexListener","RECEIVE_MESSAGE_TYPES","logName","sendResponse","ack","response","pathname","handleError","parseMessage","parsedMessage","receivedMessages","setupGlobalReceiveMessage","messageListener","sourceElement","originalEvent","listenForMessages","stopListenForMessages","listenerOptions","errorHandler","requestListener","validateOptions","normalizeDomain","targetDomain","actualDomain","normalizedDomain","responseTimeout","childTimeout","responseListener","reqPromises","totalAckTimeout","totalResTimeout","ackTimeout","resTimeout","internalSerializeMessage","internalDeserializeMessage","createProxyWindow","setup","initialized","destroy","cleanUpWindow","requestPromises","__ZOID__","destroyGlobal","getProxyObject","ZOID","DELEGATE","ALLOW_DELEGATE","PROP_TYPE","INITIAL_PROPS","RAW","UID","WINDOW_REFERENCES","OPENER","PARENT","PROP_SERIALIZATION","DOTIFY","BASE64","CONTEXT","DEFAULT_DIMENSIONS","WIDTH","HEIGHT","EVENT","RENDER","RENDERED","CLOSE","PROPS","RESIZE","FOCUS","normalizeChildProp","component","helpers","prop","getPropDefinition","childDecorate","onProps","resize","getParentDomain","show","hide","normalizeChildProps","parentComponentWindow","isUpdate","alias","getPropNames","parseChildWindowName","windowName","zoidcomp","encodedPayload","getChildPayload","ChildComponent","parentDomain","onPropHandlers","autoResize","childPayload","exports","getParentComponentWindow","checkParentDomain","initialProps","getPropsByRef","setProps","watchForClose","init","buildExports","watchForResize","getHelpers","allowedParentDomains","ref","windows","getProps","existingProps","normalizedProps","checkClose","getAutoResize","updateProps","RENDER_DRIVERS","openFrame","title","proxyFrame","frameWatcher","openPrerenderFrame","openPrerender","proxyWin","proxyPrerenderFrame","prerenderFrame","prerenderFrameWindow","delegate","dimensions","extendProps","inputProps","propNames","aliases","propDef","default","validate","decorate","required","queryParam","getQueryValue","queryValue","propsToQuery","propsDef","serialization","dotkey","ParentComponent","driver","initPromise","handledErrors","proxyContainer","visible","setupEvents","registerActiveComponent","destroyActiveComponent","watchForUnload","onRender","onDisplay","onRendered","onClose","onFocus","render","childDomain","getChildDomain","checkAllowRender","windowProp","buildUrl","getProxyContainer","getProxyWindow","buildWindowName","renderContainer","setState","setProxyWin","prerender","proxyPrerenderWin","setWindowName","loadUrl","runTimeout","containerElement","buildChildPayload","getPropsRef","getPropsForChild","propRef","getWindowRef","buildParentExports","builtinProps","getUrl","sendToChild","propName","allowDelegate","overridesPromise","overrides","overriddenFunction","unloadWindowListener","initChild","secondClosed","prerenderTemplate","prerenderWindow","renderTemplate","renderer","innerContainer","containerTemplate","bridgeUrl","getBridgeUrl","bridgeDomain","DelegateComponent","watchForSourceClose","getDelegate","getOverrides","closeSourceWindowListener","delegateOverride","_inheritsLoose","subClass","superClass","__proto__","react","React","ReactDOM","componentDidMount","findDOMNode","componentDidUpdate","Component","vue","Vue","inheritAttrs","mounted","$el","$attrs","watch","deep","angular","ng","module","directive","scope","restrict","controller","$scope","$element","safeApply","$root","$$phase","$apply","angularWrapped","instance","$watch","equals","obj1","obj2","checked","angular2","zoid","AngularComponent","NgModule","ElementRef","NgZone","internalProps","angular2Wrapped","zone","run","ComponentInstance","template","inputs","Class","angularConstructor","elementRef","_props","ngOnInit","targetElement","nativeElement","ngDoCheck","ModuleInstance","declarations","validatePropDefinitions","PROP_TYPE_LIST","defaultContext","CLASS","INVISIBLE","defaultContainerTemplate","div","cspNonce","defaultPrerenderTemplate","spinner","defaultNoop","decorateOnce","getBuiltInProps","driverCache","xprops","logger","components","debug","info","warn","registerChild","listenDelegate","dep","isChild","canRenderTo","getDefaultContainer","getDefaultContext","finalContext","renderTo","activeComponents","setupPostRobot","destroyAll","destroyComponents","destroyPostRobot"],"mappings":"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","file":"zoid.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"zoid\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"zoid\"] = factory();\n\telse\n\t\troot[\"zoid\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/* @flow */\n\nexport function getUserAgent() : string {\n    return window.navigator.mockUserAgent || window.navigator.userAgent;\n}\n\nexport function isDevice(userAgent? : string = getUserAgent()) : boolean {\n    if (userAgent.match(/Android|webOS|iPhone|iPad|iPod|bada|Symbian|Palm|CriOS|BlackBerry|IEMobile|WindowsMobile|Opera Mini/i)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function isWebView() : boolean {\n    let userAgent = getUserAgent();\n    return (/(iPhone|iPod|iPad|Macintosh).*AppleWebKit(?!.*Safari)/i).test(userAgent) ||\n        (/\\bwv\\b/).test(userAgent) ||\n    (/Android.*Version\\/(\\d)\\.(\\d)/i).test(userAgent);\n}\n\nexport function isStandAlone() : boolean {\n    return (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches);\n}\n\nexport function isFacebookWebView(ua? : string = getUserAgent()) : boolean {\n    return (ua.indexOf('FBAN') !== -1) || (ua.indexOf('FBAV') !== -1);\n}\n\nexport function isFirefoxIOS(ua? : string = getUserAgent()) : boolean {\n    return (/FxiOS/i).test(ua);\n}\n\nexport function isEdgeIOS(ua? : string = getUserAgent()) : boolean {\n    return (/EdgiOS/i).test(ua);\n}\n\nexport function isOperaMini(ua? : string = getUserAgent()) : boolean {\n    return ua.indexOf('Opera Mini') > -1;\n}\n\nexport function isAndroid(ua? : string = getUserAgent()) : boolean {\n    return (/Android/).test(ua);\n}\n\nexport function isIos(ua? : string = getUserAgent()) : boolean {\n    return (/iPhone|iPod|iPad/).test(ua);\n}\n\nexport function isGoogleSearchApp(ua? : string = getUserAgent()) : boolean {\n    return (/\\bGSA\\b/).test(ua);\n}\n\nexport function isQQBrowser(ua? : string = getUserAgent()) : boolean {\n    return (/QQBrowser/).test(ua);\n}\n\nexport function isIosWebview(ua? : string = getUserAgent()) : boolean {\n    if (isIos(ua)) {\n        if (isGoogleSearchApp(ua)) {\n            return true;\n        }\n        return (/.+AppleWebKit(?!.*Safari)/).test(ua);\n    }\n    return false;\n}\n\nexport function isAndroidWebview(ua? : string = getUserAgent()) : boolean {\n    if (isAndroid(ua)) {\n        return (/Version\\/[\\d.]+/).test(ua) && !isOperaMini(ua);\n    }\n    return false;\n}\n\nexport function isIE() : boolean {\n\n    if (window.document.documentMode) {\n        return true;\n    }\n\n    return Boolean(\n        window.navigator &&\n        window.navigator.userAgent &&\n        (/Edge|MSIE|rv:11/i).test(window.navigator.userAgent)\n    );\n}\n\nexport function isIECompHeader() : boolean {\n    let mHttp = window.document.querySelector('meta[http-equiv=\"X-UA-Compatible\"]');\n    let mContent = window.document.querySelector('meta[content=\"IE=edge\"]');\n    if (mHttp && mContent) {\n        return true;\n    }\n    return false;\n}\n\nexport function isElectron() : boolean {\n    if (typeof process !== 'undefined' && process.versions && process.versions.electron) {\n        return true;\n    }\n    return false;\n}\n\nexport function isIEIntranet() : boolean {\n\n    // This status check only works for older versions of IE with document.documentMode set\n\n    if (window.document.documentMode) {\n        try {\n            let status = window.status;\n\n            window.status = 'testIntranetMode';\n\n            if (window.status === 'testIntranetMode') {\n                window.status = status;\n\n                return true;\n            }\n\n            return false;\n\n        } catch (err) {\n\n            return false;\n        }\n    }\n\n    return false;\n}\n\nexport function isMacOsCna() : boolean {\n    let userAgent = getUserAgent();\n    return (/Macintosh.*AppleWebKit(?!.*Safari)/i).test(userAgent);\n}\n\nexport function supportsPopups(ua? : string = getUserAgent()) : boolean {\n    return !(isIosWebview(ua) || isAndroidWebview(ua) || isOperaMini(ua) ||\n        isFirefoxIOS(ua) || isEdgeIOS(ua) || isFacebookWebView(ua) || isQQBrowser(ua) || isElectron() || isMacOsCna() || isStandAlone());\n}\n\nexport function isChrome(ua? : string = getUserAgent()) : boolean {\n    return (/Chrome|Chromium|CriOS/).test(ua);\n}\n\nexport function isSafari(ua? : string = getUserAgent()) : boolean {\n    return (/Safari/).test(ua) && !isChrome(ua);\n}\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","/* @flow */\n\nexport function isPromise(item : mixed) : boolean {\n    try {\n        if (!item) {\n            return false;\n        }\n\n        if (typeof Promise !== 'undefined' && item instanceof Promise) {\n            return true;\n        }\n\n        if (typeof window !== 'undefined' && typeof window.Window === 'function' && item instanceof window.Window) {\n            return false;\n        }\n\n        if (typeof window !== 'undefined' && typeof window.constructor === 'function' && item instanceof window.constructor) {\n            return false;\n        }\n\n        let toString = ({}).toString;\n\n        if (toString) {\n            let name = toString.call(item);\n\n            if (name === '[object Window]' || name === '[object global]' || name === '[object DOMWindow]') {\n                return false;\n            }\n        }\n\n        if (typeof item.then === 'function') {\n            return true;\n        }\n    } catch (err) {\n        return false;\n    }\n\n    return false;\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from './promise';\n\nconst dispatchedErrors = [];\nconst possiblyUnhandledPromiseHandlers : Array<(mixed, promise? : ZalgoPromise<mixed>) => void> = [];\n\nexport function dispatchPossiblyUnhandledError<T>(err : mixed, promise : ZalgoPromise<T>) {\n\n    if (dispatchedErrors.indexOf(err) !== -1) {\n        return;\n    }\n\n    dispatchedErrors.push(err);\n\n    setTimeout(() => {\n        if (__DEBUG__) {\n            // $FlowFixMe\n            throw new Error(`${ err.stack || err.toString() }\\n\\nFrom promise:\\n\\n${ promise.stack }`);\n        }\n\n        throw err;\n    }, 1);\n\n    for (let j = 0; j < possiblyUnhandledPromiseHandlers.length; j++) {\n        // $FlowFixMe\n        possiblyUnhandledPromiseHandlers[j](err, promise);\n    }\n}\n\nexport function onPossiblyUnhandledException(handler : (mixed, promise? : ZalgoPromise<mixed>) => void) : { cancel : () => void } {\n    possiblyUnhandledPromiseHandlers.push(handler);\n\n    return {\n        cancel() {\n            possiblyUnhandledPromiseHandlers.splice(possiblyUnhandledPromiseHandlers.indexOf(handler), 1);\n        }\n    };\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from './promise';\n\nlet activeCount = 0;\nlet flushPromise;\n\nfunction flushActive() {\n    if (!activeCount && flushPromise) {\n        const promise = flushPromise;\n        flushPromise = null;\n        promise.resolve();\n    }\n}\n\nexport function startActive() {\n    activeCount += 1;\n}\n\nexport function endActive() {\n    activeCount -= 1;\n    flushActive();\n}\n\nexport function awaitActive(Zalgo : Class<ZalgoPromise<*>>) : ZalgoPromise<void> { // eslint-disable-line no-undef\n    let promise = flushPromise = flushPromise || new Zalgo();\n    flushActive();\n    return promise;\n}\n","/* @flow */\n\nimport { isPromise } from './utils';\nimport { onPossiblyUnhandledException, dispatchPossiblyUnhandledError } from './exceptions';\nimport { startActive, endActive, awaitActive } from './flush';\n\nexport class ZalgoPromise<R : mixed> {\n\n    resolved : boolean\n    rejected : boolean\n    errorHandled : boolean\n    value : R\n    error : mixed\n    handlers : Array<{\n        promise : ZalgoPromise<*>,\n        onSuccess : void | (result : R) => mixed,\n        onError : void | (error : mixed) => mixed\n    }>\n    dispatching : boolean\n    stack : string\n\n    constructor(handler : ?(resolve : (result : R) => void, reject : (error : mixed) => void) => void) {\n\n        this.resolved = false;\n        this.rejected = false;\n        this.errorHandled = false;\n\n        this.handlers = [];\n\n        if (handler) {\n\n            let result;\n            let error;\n            let resolved = false;\n            let rejected = false;\n            let isAsync = false;\n\n            startActive();\n\n            try {\n                handler(res => {\n                    if (isAsync) {\n                        this.resolve(res);\n                    } else {\n                        resolved = true;\n                        result = res;\n                    }\n\n                }, err => {\n                    if (isAsync) {\n                        this.reject(err);\n                    } else {\n                        rejected = true;\n                        error = err;\n                    }\n                });\n\n            } catch (err) {\n                endActive();\n                this.reject(err);\n                return;\n            }\n\n            endActive();\n\n            isAsync = true;\n\n            if (resolved) {\n                // $FlowFixMe\n                this.resolve(result);\n            } else if (rejected) {\n                this.reject(error);\n            }\n        }\n\n        if (__DEBUG__) {\n            try {\n                throw new Error(`ZalgoPromise`);\n            } catch (err) {\n                this.stack = err.stack;\n            }\n        }\n    }\n\n    resolve(result : R) : ZalgoPromise<R> {\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        if (isPromise(result)) {\n            throw new Error('Can not resolve promise with another promise');\n        }\n\n        this.resolved = true;\n        this.value = result;\n        this.dispatch();\n\n        return this;\n    }\n\n    reject(error : mixed) : ZalgoPromise<R> {\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        if (isPromise(error)) {\n            throw new Error('Can not reject promise with another promise');\n        }\n\n        if (!error) {\n            // $FlowFixMe\n            let err = (error && typeof error.toString === 'function' ? error.toString() : Object.prototype.toString.call(error));\n            error = new Error(`Expected reject to be called with Error, got ${ err }`);\n        }\n\n        this.rejected = true;\n        this.error = error;\n\n        if (!this.errorHandled) {\n            setTimeout(() => {\n                if (!this.errorHandled) {\n                    dispatchPossiblyUnhandledError(error, this);\n                }\n            }, 1);\n        }\n\n        this.dispatch();\n\n        return this;\n    }\n\n    asyncReject(error : mixed) : ZalgoPromise<R> {\n        this.errorHandled = true;\n        this.reject(error);\n        return this;\n    }\n    \n    dispatch() {\n\n        let { dispatching, resolved, rejected, handlers } = this;\n\n        if (dispatching) {\n            return;\n        }\n\n        if (!resolved && !rejected) {\n            return;\n        }\n\n        this.dispatching = true;\n        startActive();\n\n        const chain = <T>(firstPromise : ZalgoPromise<T>, secondPromise : ZalgoPromise<T>) => {\n            return firstPromise.then(res => {\n                secondPromise.resolve(res);\n            }, err => {\n                secondPromise.reject(err);\n            });\n        };\n\n        for (let i = 0; i < handlers.length; i++) {\n\n            let { onSuccess, onError, promise } = handlers[i];\n\n            let result;\n\n            if (resolved) {\n\n                try {\n                    result = onSuccess ? onSuccess(this.value) : this.value;\n                } catch (err) {\n                    promise.reject(err);\n                    continue;\n                }\n\n            } else if (rejected) {\n\n                if (!onError) {\n                    promise.reject(this.error);\n                    continue;\n                }\n\n                try {\n                    result = onError(this.error);\n                } catch (err) {\n                    promise.reject(err);\n                    continue;\n                }\n            }\n\n            if (result instanceof ZalgoPromise && (result.resolved || result.rejected)) {\n\n                if (result.resolved) {\n                    promise.resolve(result.value);\n                } else {\n                    promise.reject(result.error);\n                }\n\n                result.errorHandled = true;\n\n            } else if (isPromise(result)) {\n\n                if (result instanceof ZalgoPromise && (result.resolved || result.rejected)) {\n                    if (result.resolved) {\n                        promise.resolve(result.value);\n                    } else {\n                        promise.reject(result.error);\n                    }\n\n                } else {\n                    // $FlowFixMe\n                    chain(result, promise);\n                }\n\n            } else {\n\n                promise.resolve(result);\n            }\n        }\n\n        handlers.length = 0;\n        this.dispatching = false;\n        endActive();\n    }\n\n    then<X : mixed, Y : mixed>(onSuccess : void | (result : R) => (ZalgoPromise<X> | Y), onError : void | (error : mixed) => (ZalgoPromise<X> | Y)) : ZalgoPromise<X | Y> {\n\n        if (onSuccess && typeof onSuccess !== 'function' && !onSuccess.call) {\n            throw new Error('Promise.then expected a function for success handler');\n        }\n\n        if (onError && typeof onError !== 'function' && !onError.call) {\n            throw new Error('Promise.then expected a function for error handler');\n        }\n\n        let promise : ZalgoPromise<X | Y> = new ZalgoPromise();\n\n        this.handlers.push({\n            promise,\n            onSuccess,\n            onError\n        });\n\n        this.errorHandled = true;\n\n        this.dispatch();\n\n        return promise;\n    }\n\n    catch<X : mixed, Y : mixed>(onError : (error : mixed) => ZalgoPromise<X> | Y) : ZalgoPromise<X | Y> {\n        return this.then(undefined, onError);\n    }\n\n    finally(onFinally : () => mixed) : ZalgoPromise<R> {\n\n        if (onFinally && typeof onFinally !== 'function' && !onFinally.call) {\n            throw new Error('Promise.finally expected a function');\n        }\n\n        return this.then((result) => {\n            return ZalgoPromise.try(onFinally)\n                .then(() => {\n                    return result;\n                });\n        }, (err) => {\n            return ZalgoPromise.try(onFinally)\n                .then(() => {\n                    throw err;\n                });\n        });\n    }\n\n    timeout(time : number, err : ?Error) : ZalgoPromise<R> {\n\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        let timeout = setTimeout(() => {\n\n            if (this.resolved || this.rejected) {\n                return;\n            }\n\n            this.reject(err || new Error(`Promise timed out after ${ time }ms`));\n\n        }, time);\n\n        return this.then(result => {\n            clearTimeout(timeout);\n            return result;\n        });\n    }\n\n    // $FlowFixMe\n    toPromise() : Promise<R> {\n        // $FlowFixMe\n        if (typeof Promise === 'undefined') {\n            throw new TypeError(`Could not find Promise`);\n        }\n        // $FlowFixMe\n        return Promise.resolve(this); // eslint-disable-line compat/compat\n    }\n\n    static resolve<X : mixed>(value : X | ZalgoPromise<X>) : ZalgoPromise<X> {\n\n        if (value instanceof ZalgoPromise) {\n            return value;\n        }\n\n        if (isPromise(value)) {\n            // $FlowFixMe\n            return new ZalgoPromise((resolve, reject) => value.then(resolve, reject));\n        }\n\n        return new ZalgoPromise().resolve(value);\n    }\n\n    static reject(error : mixed) : ZalgoPromise<R> {\n        return new ZalgoPromise().reject(error);\n    }\n\n    static asyncReject(error : mixed) : ZalgoPromise<R> {\n        return new ZalgoPromise().asyncReject(error);\n    }\n\n    static all<X : Array<mixed>>(promises : X) : ZalgoPromise<$TupleMap<X, <Y>(ZalgoPromise<Y> | Y) => Y>> { // eslint-disable-line no-undef\n\n        let promise = new ZalgoPromise();\n        let count = promises.length;\n        let results = [];\n\n        if (!count) {\n            promise.resolve(results);\n            return promise;\n        }\n\n        const chain = <T>(i : number, firstPromise : ZalgoPromise<T>, secondPromise : ZalgoPromise<T>) => {\n            return firstPromise.then(res => {\n                results[i] = res;\n                count -= 1;\n                if (count === 0) {\n                    promise.resolve(results);\n                }\n            }, err => {\n                secondPromise.reject(err);\n            });\n        };\n\n        for (let i = 0; i < promises.length; i++) {\n            let prom = promises[i];\n\n            if (prom instanceof ZalgoPromise) {\n                if (prom.resolved) {\n                    results[i] = prom.value;\n                    count -= 1;\n                    continue;\n                }\n            } else if (!isPromise(prom)) {\n                results[i] = prom;\n                count -= 1;\n                continue;\n            }\n\n            chain(i, ZalgoPromise.resolve(prom), promise);\n        }\n\n        if (count === 0) {\n            promise.resolve(results);\n        }\n\n        return promise;\n    }\n\n    static hash<O : Object>(promises : O) : ZalgoPromise<$ObjMap<O, <Y>(ZalgoPromise<Y> | Y) => Y>> { // eslint-disable-line no-undef\n        let result = {};\n        \n        return ZalgoPromise.all(Object.keys(promises).map(key => {\n            return ZalgoPromise.resolve(promises[key]).then(value => {\n                result[key] = value;\n            });\n        })).then(() => {\n            return result;\n        });\n    }\n\n    static map<T, X>(items : Array<T>, method : (T) => (ZalgoPromise<X> | X)) : ZalgoPromise<Array<X>> {\n        // $FlowFixMe\n        return ZalgoPromise.all(items.map(method));\n    }\n\n    static onPossiblyUnhandledException(handler : (err : mixed) => void) : { cancel : () => void } {\n        return onPossiblyUnhandledException(handler);\n    }\n\n    static try<X : mixed, Y : mixed, C : mixed, A : Array<mixed>>(method : (...args : A) => (ZalgoPromise<X> | Y), context : ?C, args : ?A) : ZalgoPromise<X | Y> {\n\n        if (method && typeof method !== 'function' && !method.call) {\n            throw new Error('Promise.try expected a function');\n        }\n\n        let result;\n\n        startActive();\n        \n        try {\n            // $FlowFixMe\n            result = method.apply(context, args || []);\n        } catch (err) {\n            endActive();\n            return ZalgoPromise.reject(err);\n        }\n\n        endActive();\n\n        return ZalgoPromise.resolve(result);\n    }\n\n    static delay(delay : number) : ZalgoPromise<void> {\n        return new ZalgoPromise(resolve => {\n            setTimeout(resolve, delay);\n        });\n    }\n\n    static isPromise(value : mixed) : boolean {\n\n        if (value && value instanceof ZalgoPromise) {\n            return true;\n        }\n\n        return isPromise(value);\n    }\n\n    static flush() : ZalgoPromise<void> {\n        return awaitActive(ZalgoPromise);\n    }\n}\n","/* @flow */\n\nexport function isRegex(item : mixed) : boolean {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n","/* @flow */\n\nexport const PROTOCOL = {\n    MOCK:  ('mock:' : 'mock:'),\n    FILE:  ('file:' : 'file:'),\n    ABOUT: ('about:' : 'about:')\n};\n\nexport const WILDCARD = '*';\n\nexport const WINDOW_TYPE = {\n    IFRAME: ('iframe' : 'iframe'),\n    POPUP:  ('popup' : 'popup')\n};\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { isRegex, noop } from './util';\nimport type { CrossDomainWindowType, SameDomainWindowType, DomainMatcher } from './types';\nimport { PROTOCOL, WILDCARD } from './constants';\n\nlet IE_WIN_ACCESS_ERROR = 'Call was rejected by callee.\\r\\n';\n\nexport function isFileProtocol(win : SameDomainWindowType = window) : boolean {\n    return win.location.protocol === PROTOCOL.FILE;\n}\n\nexport function isAboutProtocol(win : SameDomainWindowType = window) : boolean {\n    return win.location.protocol === PROTOCOL.ABOUT;\n}\n\nexport function getParent(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        if (win.parent && win.parent !== win) {\n            return win.parent;\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function getOpener(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    if (!win) {\n        return;\n    }\n\n    // Make sure we're not actually an iframe which has had window.open() called on us\n    if (getParent(win)) {\n        return;\n    }\n\n    try {\n        return win.opener;\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function canReadFromWindow(win : CrossDomainWindowType | SameDomainWindowType) : boolean {\n    try {\n        // $FlowFixMe\n        noop(win && win.location && win.location.href);\n        return true;\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function getActualDomain(win? : SameDomainWindowType = window) : string {\n\n    let location = win.location;\n\n    if (!location) {\n        throw new Error(`Can not read window location`);\n    }\n\n    let protocol = location.protocol;\n\n    if (!protocol) {\n        throw new Error(`Can not read window protocol`);\n    }\n\n    if (protocol === PROTOCOL.FILE) {\n        return `${ PROTOCOL.FILE }//`;\n    }\n\n    if (protocol === PROTOCOL.ABOUT) {\n\n        let parent = getParent(win);\n        if (parent && canReadFromWindow(parent)) {\n            // $FlowFixMe\n            return getActualDomain(parent);\n        }\n\n        return `${ PROTOCOL.ABOUT }//`;\n    }\n\n    let host = location.host;\n\n    if (!host) {\n        throw new Error(`Can not read window host`);\n    }\n\n    return `${ protocol }//${ host }`;\n}\n\nexport function getDomain(win? : SameDomainWindowType = window) : string {\n\n    let domain = getActualDomain(win);\n\n    if (domain && win.mockDomain && win.mockDomain.indexOf(PROTOCOL.MOCK) === 0) {\n        return win.mockDomain;\n    }\n\n    return domain;\n}\n\nexport function isBlankDomain(win : CrossDomainWindowType) : boolean {\n    try {\n        // $FlowFixMe\n        if (!win.location.href) {\n            return true;\n        }\n\n        if (win.location.href === 'about:blank') {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function isActuallySameDomain(win : CrossDomainWindowType) : boolean {\n\n    try {\n        if (win === window) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        let desc = Object.getOwnPropertyDescriptor(win, 'location');\n\n        if (desc && desc.enumerable === false) {\n            return false;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        // $FlowFixMe\n        if (isAboutProtocol(win) && canReadFromWindow(win)) {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        // $FlowFixMe\n        if (getActualDomain(win) === getActualDomain(window)) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function isSameDomain(win : CrossDomainWindowType | SameDomainWindowType) : boolean {\n\n    if (!isActuallySameDomain(win)) {\n        return false;\n    }\n\n    try {\n\n        if (win === window) {\n            return true;\n        }\n\n        // $FlowFixMe\n        if (isAboutProtocol(win) && canReadFromWindow(win)) {\n            return true;\n        }\n\n        // $FlowFixMe\n        if (getDomain(window) === getDomain(win)) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\n\nexport function assertSameDomain(win : CrossDomainWindowType | SameDomainWindowType) : SameDomainWindowType {\n    if (!isSameDomain(win)) {\n        throw new Error(`Expected window to be same domain`);\n    }\n\n    // $FlowFixMe\n    return win;\n}\n\nexport function getParents(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    try {\n\n        while (win.parent !== win) {\n            result.push(win.parent);\n            win = win.parent;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return result;\n}\n\nexport function isAncestorParent(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    if (!parent || !child) {\n        return false;\n    }\n\n    let childParent = getParent(child);\n\n    if (childParent) {\n        return childParent === parent;\n    }\n\n    if (getParents(child).indexOf(parent) !== -1) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getFrames(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    let frames;\n\n    try {\n        frames = win.frames;\n    } catch (err) {\n        frames = win;\n    }\n\n    let len;\n\n    try {\n        len = frames.length;\n    } catch (err) {\n        // pass\n    }\n\n    if (len === 0) {\n        return result;\n    }\n\n    if (len) {\n        for (let i = 0; i < len; i++) {\n\n            let frame;\n\n            try {\n                frame = frames[i];\n            } catch (err) {\n                continue;\n            }\n\n            result.push(frame);\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < 100; i++) {\n        let frame;\n\n        try {\n            frame = frames[i];\n        } catch (err) {\n            return result;\n        }\n\n        if (!frame) {\n            return result;\n        }\n\n        result.push(frame);\n    }\n\n    return result;\n}\n\n\nexport function getAllChildFrames(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    for (let frame of getFrames(win)) {\n        result.push(frame);\n\n        for (let childFrame of getAllChildFrames(frame)) {\n            result.push(childFrame);\n        }\n    }\n\n    return result;\n}\n\nexport function getTop(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    try {\n        if (win.top) {\n            return win.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    if (getParent(win) === win) {\n        return win;\n    }\n\n    try {\n        if (isAncestorParent(window, win) && window.top) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (isAncestorParent(win, window) && window.top) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    for (let frame of getAllChildFrames(win)) {\n        try {\n            if (frame.top) {\n                return frame.top;\n            }\n        } catch (err) {\n            // pass\n        }\n\n        if (getParent(frame) === frame) {\n            return frame;\n        }\n    }\n}\n\nexport function getNextOpener(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n    return getOpener(getTop(win) || win);\n}\n\nexport function getUltimateTop(win? : CrossDomainWindowType = window) : CrossDomainWindowType {\n    let opener = getNextOpener(win);\n\n    if (opener) {\n        return getUltimateTop(opener);\n    }\n\n    return top;\n}\n\nexport function getAllFramesInWindow(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n    let top = getTop(win);\n\n    if (!top) {\n        throw new Error(`Can not determine top window`);\n    }\n\n    return [ ...getAllChildFrames(top), top ];\n}\n\nexport function getAllWindows(win? : CrossDomainWindowType = window) : $ReadOnlyArray<CrossDomainWindowType> {\n    let frames = getAllFramesInWindow(win);\n    let opener = getNextOpener(win);\n\n    if (opener) {\n        return [ ...getAllWindows(opener), ...frames ];\n    } else {\n        return frames;\n    }\n}\n\nexport function isTop(win : CrossDomainWindowType) : boolean {\n    return win === getTop(win);\n}\n\nexport function isFrameWindowClosed(frame : HTMLIFrameElement) : boolean {\n\n    if (!frame.contentWindow) {\n        return true;\n    }\n\n    if (!frame.parentNode) {\n        return true;\n    }\n\n    let doc = frame.ownerDocument;\n\n    if (doc && doc.documentElement && !doc.documentElement.contains(frame)) {\n        return true;\n    }\n\n    return false;\n}\n\nfunction safeIndexOf<T>(collection : Array<T>, item : T) : number {\n    for (let i = 0; i < collection.length; i++) {\n\n        try {\n            if (collection[i] === item) {\n                return i;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    return -1;\n}\n\nlet iframeWindows = [];\nlet iframeFrames = [];\n\nexport function isWindowClosed(win : CrossDomainWindowType, allowMock : boolean = true) : boolean {\n\n    try {\n        if (win === window) {\n            return false;\n        }\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (!win) {\n            return true;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (win.closed) {\n            return true;\n        }\n\n    } catch (err) {\n\n        // I love you so much IE\n\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return false;\n        }\n\n        return true;\n    }\n\n\n    if (allowMock && isSameDomain(win)) {\n        try {\n            // $FlowFixMe\n            if (win.mockclosed) {\n                return true;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    // Mobile safari\n\n    try {\n        if (!win.parent || !win.top) {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    // Yes, this actually happens in IE. win === win errors out when the window\n    // is from an iframe, and the iframe was removed from the page.\n\n    try {\n        noop(win === win); // eslint-disable-line no-self-compare\n    } catch (err) {\n        return true;\n    }\n\n    // IE orphaned frame\n\n    let iframeIndex = safeIndexOf(iframeWindows, win);\n\n    if (iframeIndex !== -1) {\n        let frame = iframeFrames[iframeIndex];\n\n        if (frame && isFrameWindowClosed(frame)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction cleanIframes() {\n    for (let i = 0; i < iframeWindows.length; i++) {\n        let closed = false;\n\n        try {\n            closed = iframeWindows[i].closed;\n        } catch (err) {\n            // pass\n        }\n\n        if (closed) {\n            iframeFrames.splice(i, 1);\n            iframeWindows.splice(i, 1);\n        }\n    }\n}\n\nexport function linkFrameWindow(frame : HTMLIFrameElement) {\n\n    cleanIframes();\n\n    if (frame && frame.contentWindow) {\n        try {\n            iframeWindows.push(frame.contentWindow);\n            iframeFrames.push(frame);\n        } catch (err) {\n            // pass\n        }\n    }\n}\n\nexport function getUserAgent(win : ?SameDomainWindowType) : string {\n    win = win || window;\n    return win.navigator.mockUserAgent || win.navigator.userAgent;\n}\n\n\nexport function getFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let winFrames = getFrames(win);\n\n    for (let childFrame of winFrames) {\n        try {\n            // $FlowFixMe\n            if (isSameDomain(childFrame) && childFrame.name === name && winFrames.indexOf(childFrame) !== -1) {\n                return childFrame;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    try {\n        // $FlowFixMe\n        if (winFrames.indexOf(win.frames[name]) !== -1) {\n            // $FlowFixMe\n            return win.frames[name];\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (winFrames.indexOf(win[name]) !== -1) {\n            return win[name];\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function findChildFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        let namedFrame = findChildFrameByName(childFrame, name);\n\n        if (namedFrame) {\n            return namedFrame;\n        }\n    }\n}\n\nexport function findFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let frame;\n\n    frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    let top = getTop(win) || win;\n\n    return findChildFrameByName(top, name);\n}\n\nexport function isParent(win : CrossDomainWindowType, frame : CrossDomainWindowType) : boolean {\n\n    let frameParent = getParent(frame);\n\n    if (frameParent) {\n        return frameParent === win;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        if (childFrame === frame) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isOpener(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    return parent === getOpener(child);\n}\n\nexport function getAncestor(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n    win = win || window;\n\n    let opener = getOpener(win);\n\n    if (opener) {\n        return opener;\n    }\n\n    let parent = getParent(win);\n\n    if (parent) {\n        return parent;\n    }\n}\n\nexport function getAncestors(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let results = [];\n\n    let ancestor = win;\n\n    while (ancestor) {\n        ancestor = getAncestor(ancestor);\n        if (ancestor) {\n            results.push(ancestor);\n        }\n    }\n\n    return results;\n}\n\n\nexport function isAncestor(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    let actualParent = getAncestor(child);\n\n    if (actualParent) {\n        if (actualParent === parent) {\n            return true;\n        }\n\n        return false;\n    }\n\n    if (child === parent) {\n        return false;\n    }\n\n    if (getTop(child) === child) {\n        return false;\n    }\n\n    for (let frame of getFrames(parent)) {\n        if (frame === child) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isPopup(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(getOpener(win));\n}\n\nexport function isIframe(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(getParent(win));\n}\n\nexport function isFullpage(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(!isIframe(win) && !isPopup(win));\n}\n\nfunction anyMatch(collection1, collection2) : boolean {\n\n    for (let item1 of collection1) {\n        for (let item2 of collection2) {\n            if (item1 === item2) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nexport function getDistanceFromTop(win : CrossDomainWindowType = window) : number {\n    let distance = 0;\n    let parent = win;\n\n    while (parent) {\n        parent = getParent(parent);\n        if (parent) {\n            distance += 1;\n        }\n    }\n\n    return distance;\n}\n\nexport function getNthParent(win : CrossDomainWindowType, n : number = 1) : ?CrossDomainWindowType {\n    let parent = win;\n\n    for (let i = 0; i < n; i++) {\n        if (!parent) {\n            return;\n        }\n\n        parent = getParent(parent);\n    }\n\n    return parent;\n}\n\nexport function getNthParentFromTop(win : CrossDomainWindowType, n : number = 1) : ?CrossDomainWindowType {\n    return getNthParent(win, getDistanceFromTop(win) - n);\n}\n\nexport function isSameTopWindow(win1 : CrossDomainWindowType, win2 : CrossDomainWindowType) : boolean {\n\n    let top1 = getTop(win1) || win1;\n    let top2 = getTop(win2) || win2;\n\n    try {\n        if (top1 && top2) {\n            if (top1 === top2) {\n                return true;\n            }\n\n            return false;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    let allFrames1 = getAllFramesInWindow(win1);\n    let allFrames2 = getAllFramesInWindow(win2);\n\n    if (anyMatch(allFrames1, allFrames2)) {\n        return true;\n    }\n\n    let opener1 = getOpener(top1);\n    let opener2 = getOpener(top2);\n\n    if (opener1 && anyMatch(getAllFramesInWindow(opener1), allFrames2)) {\n        return false;\n    }\n\n    if (opener2 && anyMatch(getAllFramesInWindow(opener2), allFrames1)) {\n        return false;\n    }\n\n    return false;\n}\n\nexport function matchDomain(pattern : DomainMatcher, origin : DomainMatcher) : boolean {\n\n    if (typeof pattern === 'string') {\n\n        if (typeof origin === 'string') {\n            return pattern === WILDCARD || origin === pattern;\n        }\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n    }\n\n    if (isRegex(pattern)) {\n\n        if (isRegex(origin)) {\n            return pattern.toString() === origin.toString();\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n\n        // $FlowFixMe\n        return Boolean(origin.match(pattern));\n    }\n\n    if (Array.isArray(pattern)) {\n\n        if (Array.isArray(origin)) {\n            return JSON.stringify(pattern) === JSON.stringify(origin);\n        }\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        return pattern.some(subpattern => matchDomain(subpattern, origin));\n    }\n\n    return false;\n}\n\nexport function stringifyDomainPattern(pattern : DomainMatcher) : string {\n    if (Array.isArray(pattern)) {\n        return `(${ pattern.join(' | ') })`;\n    } else if (isRegex(pattern)) {\n        return `RegExp(${ pattern.toString() }`;\n    } else {\n        return pattern.toString();\n    }\n}\n\nexport function getDomainFromUrl(url : string) : string {\n\n    let domain;\n\n    if (url.match(/^(https?|mock|file):\\/\\//)) {\n        domain = url;\n    } else {\n        return getDomain();\n    }\n\n    domain = domain.split('/').slice(0, 3).join('/');\n\n    return domain;\n}\n\nexport function onCloseWindow(win : CrossDomainWindowType, callback : Function, delay : number = 1000, maxtime : number = Infinity) : { cancel : () => void } {\n\n    let timeout;\n\n    let check = () => {\n\n        if (isWindowClosed(win)) {\n\n            if (timeout) {\n                clearTimeout(timeout);\n            }\n\n            return callback();\n        }\n\n        if (maxtime <= 0) {\n            clearTimeout(timeout);\n        } else {\n            maxtime -= delay;\n            timeout = setTimeout(check, delay);\n        }\n    };\n\n    check();\n\n    return {\n        cancel() {\n            if (timeout) {\n                clearTimeout(timeout);\n            }\n        }\n    };\n}\n\n// eslint-disable-next-line complexity\nexport function isWindow(obj : Object) : boolean {\n\n    try {\n        if (obj === window) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (Object.prototype.toString.call(obj) === '[object Window]') {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (window.Window && obj instanceof window.Window) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.self === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.parent === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.top === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (noop(obj === obj) === '__unlikely_value__') { // eslint-disable-line no-self-compare\n            return false;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (obj && obj.__cross_domain_utils_window_check__ === '__unlikely_value__') {\n            return false;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function isBrowser() : boolean {\n    return (typeof window !== 'undefined' && typeof window.location !== 'undefined');\n}\n\nexport function isCurrentDomain(domain : string) : boolean {\n    if (!isBrowser()) {\n        return false;\n    }\n\n    return (getDomain() === domain);\n}\n\nexport function isMockDomain(domain : string) : boolean {\n    return domain.indexOf(PROTOCOL.MOCK) === 0;\n}\n\nexport function normalizeMockUrl(url : string) : string {\n    if (!isMockDomain(getDomainFromUrl(url))) {\n        return url;\n    }\n\n    if (!__TEST__) {\n        throw new Error(`Mock urls not supported out of test mode`);\n    }\n\n    return url.replace(/^mock:\\/\\/[^/]+/, getActualDomain(window));\n}\n\nexport function closeWindow(win : CrossDomainWindowType) {\n    try {\n        win.close();\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function getFrameForWindow(win : CrossDomainWindowType) : ?HTMLElement {\n    if (isSameDomain(win)) {\n        return assertSameDomain(win).frameElement;\n    }\n\n    for (const frame of document.querySelectorAll('iframe')) {\n        if (frame && frame.contentWindow && frame.contentWindow === win) {\n            return frame;\n        }\n    }\n}\n","/* @flow */\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\nexport type CrossDomainLocationType = {|\n\n|};\n\nexport type CrossDomainWindowType = {|\n    location : string | CrossDomainLocationType,\n    self : CrossDomainWindowType,\n    closed : boolean,\n    open : (string, string, string) => CrossDomainWindowType,\n    close : () => void,\n    focus : () => void,\n    top : CrossDomainWindowType,\n    frames : Array<CrossDomainWindowType>,\n    opener ? : CrossDomainWindowType,\n    parent : CrossDomainWindowType,\n    length : number,\n    postMessage : (string, string) => void\n|};\n\nexport type SameDomainWindowType = Object & {\n    location : string | Object,\n    self : CrossDomainWindowType,\n    closed : boolean,\n    open : (string, string, string) => CrossDomainWindowType,\n    close : () => void,\n    focus : () => void,\n    XMLHttpRequest : typeof XMLHttpRequest,\n    document : Document,\n    navigator : {\n        userAgent : string,\n        mockUserAgent? : string\n    }\n};\n\nexport type DomainMatcher = string | Array<string> | $ReadOnlyArray<string> | RegExp;\n","/* @flow */\n\nexport * from './utils';\nexport * from './types';\nexport * from './constants';\n","/* @flow */\n\nexport function hasNativeWeakMap() : boolean {\n\n    if (typeof WeakMap === 'undefined') {\n        return false;\n    }\n\n    if (typeof Object.freeze === 'undefined') {\n        return false;\n    }\n\n    try {\n\n        let testWeakMap = new WeakMap();\n        let testKey = {};\n        let testValue = '__testvalue__';\n\n        Object.freeze(testKey);\n\n        testWeakMap.set(testKey, testValue);\n\n        if (testWeakMap.get(testKey) === testValue) {\n            return true;\n        }\n\n        return false;\n\n    } catch (err) {\n\n        return false;\n    }\n}\n","/* @flow */\n\nexport function safeIndexOf<T>(collection : Array<T>, item : T) : number {\n    for (let i = 0; i < collection.length; i++) {\n\n        try {\n            if (collection[i] === item) {\n                return i;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    return -1;\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n","/* @flow */\n\nimport { isWindow, isWindowClosed } from 'cross-domain-utils/src';\n\nimport { hasNativeWeakMap } from './native';\nimport { noop, safeIndexOf } from './util';\n\nexport class CrossDomainSafeWeakMap<K : Object, V : mixed> {\n\n    name : string\n    weakmap : ?WeakMap<K, V>\n    keys : Array<K>\n    values : Array<V>\n\n    constructor() {\n        // eslint-disable-next-line no-bitwise\n        this.name = `__weakmap_${ Math.random() * 1e9 >>> 0 }__`;\n\n        if (hasNativeWeakMap()) {\n            try {\n                this.weakmap = new WeakMap();\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this.keys  = [];\n        this.values = [];\n    }\n\n    _cleanupClosedWindows() {\n\n        let weakmap = this.weakmap;\n        let keys = this.keys;\n\n        for (let i = 0; i < keys.length; i++) {\n            let value = keys[i];\n\n            if (isWindow(value) && isWindowClosed(value)) {\n\n                if (weakmap) {\n                    try {\n                        weakmap.delete(value);\n                    } catch (err) {\n                        // pass\n                    }\n                }\n\n                keys.splice(i, 1);\n                this.values.splice(i, 1);\n\n                i -= 1;\n            }\n        }\n    }\n\n    isSafeToReadWrite(key : K) : boolean {\n\n        if (isWindow(key)) {\n            return false;\n        }\n\n        try {\n            noop(key && key.self);\n            noop(key && key[this.name]);\n        } catch (err) {\n            return false;\n        }\n\n        return true;\n    }\n\n    set(key : K, value : V) {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                weakmap.set(key, value);\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let name = this.name;\n                let entry = key[name];\n\n                if (entry && entry[0] === key) {\n                    entry[1] = value;\n                } else {\n                    Object.defineProperty(key, name, {\n                        value:    [ key, value ],\n                        writable: true\n                    });\n                }\n\n                return;\n\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let values = this.values;\n        let index = safeIndexOf(keys, key);\n\n        if (index === -1) {\n            keys.push(key);\n            values.push(value);\n        } else {\n            values[index] = value;\n        }\n    }\n\n    get(key : K) : V | void {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                if (weakmap.has(key)) {\n                    return weakmap.get(key);\n                }\n                \n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    return entry[1];\n                }\n\n                return;\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let index = safeIndexOf(keys, key);\n\n        if (index === -1) {\n            return;\n        }\n\n        return this.values[index];\n    }\n\n    delete(key : K) {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                weakmap.delete(key);\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    entry[0] = entry[1] = undefined;\n                }\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let index = safeIndexOf(keys, key);\n\n        if (index !== -1) {\n            keys.splice(index, 1);\n            this.values.splice(index, 1);\n        }\n    }\n\n    has(key : K) : boolean {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                if (weakmap.has(key)) {\n                    return true;\n                }\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    return true;\n                }\n\n                return false;\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let index = safeIndexOf(this.keys, key);\n        return index !== -1;\n    }\n\n    getOrSet(key : K, getter : () => V) : V {\n        if (this.has(key)) {\n            // $FlowFixMe\n            return this.get(key);\n        }\n\n        let value = getter();\n        this.set(key, value);\n        return value;\n    }\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\n\nimport type { CancelableType } from './types';\n\nexport function getFunctionName <T : Function>(fn : T) : string {\n    return fn.name || fn.__name__ || fn.displayName || 'anonymous';\n}\n\nexport function setFunctionName <T : Function>(fn : T, name : string) : T {\n    try {\n        delete fn.name;\n        fn.name = name;\n    } catch (err) {\n        // pass\n    }\n\n    fn.__name__ = fn.displayName = name;\n    return fn;\n}\n\nexport function base64encode(str : string) : string {\n    if (typeof btoa === 'function') {\n        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (m, p1) => {\n            return String.fromCharCode(parseInt(p1, 16));\n        }));\n    }\n\n    if (typeof Buffer !== 'undefined') {\n        return Buffer.from(str, 'utf8').toString('base64');\n    }\n\n    throw new Error(`Can not find window.btoa or Buffer`);\n}\n\nexport function base64decode(str : string) : string {\n    if (typeof atob === 'function') {\n        return decodeURIComponent(Array.prototype.map.call(atob(str), c => {\n            // eslint-disable-next-line prefer-template\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n    }\n\n    if (typeof Buffer !== 'undefined') {\n        return Buffer.from(str, 'base64').toString('utf8');\n    }\n\n    throw new Error(`Can not find window.atob or Buffer`);\n}\n\nexport function uniqueID() : string {\n\n    let chars = '0123456789abcdef';\n\n    let randomID = 'xxxxxxxxxx'.replace(/./g, () => {\n        return chars.charAt(Math.floor(Math.random() * chars.length));\n    });\n\n    let timeID = base64encode(\n        new Date().toISOString().slice(11, 19).replace('T', '.')\n    ).replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n\n    return `${ randomID }_${ timeID }`;\n}\n\nexport function getGlobal() : Object {\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    if (typeof __GLOBAL__ !== 'undefined') {\n        return __GLOBAL__;\n    }\n    throw new Error(`No global found`);\n}\n\nlet objectIDs;\n\nexport function getObjectID(obj : Object) : string {\n\n    objectIDs = objectIDs || new WeakMap();\n\n    if (obj === null || obj === undefined || (typeof obj !== 'object' && typeof obj !== 'function')) {\n        throw new Error(`Invalid object`);\n    }\n\n    let uid = objectIDs.get(obj);\n\n    if (!uid) {\n        uid = `${ typeof obj }:${ uniqueID() }`;\n        objectIDs.set(obj, uid);\n    }\n\n    return uid;\n}\n\nfunction serializeArgs<T>(args : Array<T>) : string {\n    try {\n        return JSON.stringify(Array.prototype.slice.call(args), (subkey, val) => {\n            if (typeof val === 'function') {\n                return `memoize[${ getObjectID(val) }]`;\n            }\n            return val;\n        });\n    } catch (err) {\n        throw new Error(`Arguments not serializable -- can not be used to memoize`);\n    }\n}\nexport function memoize<A, R, F : (...args : Array<A>) => R, X : { (...args : Array<A>) : R, displayName : string, reset : () => void }>(method : F, options : { time? : number, thisNamespace? : boolean } = {}) : X {\n    let cacheMap = new WeakMap();\n\n    // $FlowFixMe\n    let memoizedFunction : X = function memoizedFunction(...args : Array<A>) : R {\n        let cache = cacheMap.getOrSet(options.thisNamespace ? this : method, () => ({}));\n\n        let key : string = serializeArgs(args);\n\n        let cacheTime = options.time;\n        if (cache[key] && cacheTime && (Date.now() - cache[key].time) < cacheTime) {\n            delete cache[key];\n        }\n\n        if (cache[key]) {\n            return cache[key].value;\n        }\n\n        let time  = Date.now();\n        let value = method.apply(this, arguments);\n\n        cache[key] = { time, value };\n\n        return cache[key].value;\n    };\n\n    memoizedFunction.reset = () => {\n        cacheMap.delete(options.thisNamespace ? this : method);\n    };\n\n    return setFunctionName(memoizedFunction, `${ getFunctionName(method) }::memoized`);\n}\n\nexport function promiseIdentity<T : mixed>(item : ZalgoPromise<T> | T) : ZalgoPromise<T> {\n    // $FlowFixMe\n    return ZalgoPromise.resolve(item);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function memoizePromise<R>(method : (...args : Array<any>) => ZalgoPromise<R>) : ((...args : Array<any>) => ZalgoPromise<R>) {\n    let cache = {};\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    function memoizedPromiseFunction(...args : Array<any>) : ZalgoPromise<R> {\n        let key : string = serializeArgs(args);\n\n        if (cache.hasOwnProperty(key)) {\n            return cache[key];\n        }\n\n        cache[key] = ZalgoPromise.try(() => method.apply(this, arguments))\n            .finally(() => {\n                delete cache[key];\n            });\n\n        return cache[key];\n    }\n\n    memoizedPromiseFunction.reset = () => {\n        cache = {};\n    };\n\n    return setFunctionName(memoizedPromiseFunction, `${ getFunctionName(method) }::promiseMemoized`);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function promisify<R>(method : (...args : Array<any>) => R, options : { name? : string } = {}) : ((...args : Array<any>) => ZalgoPromise<R>) {\n    function promisifiedFunction() : ZalgoPromise<R> {\n        return ZalgoPromise.try(method, this, arguments);\n    }\n\n    if (options.name) {\n        promisifiedFunction.displayName = `${ options.name }:promisified`;\n    }\n\n    return setFunctionName(promisifiedFunction, `${ getFunctionName(method) }::promisified`);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function inlineMemoize<R>(method : (...args : Array<any>) => R, logic : (...args : Array<any>) => R, args : Array<any> = []) : R {\n    // $FlowFixMe\n    let cache = method.__inline_memoize_cache__ = method.__inline_memoize_cache__ || {};\n    let key = serializeArgs(args);\n\n    if (cache.hasOwnProperty(key)) {\n        return cache[key];\n    }\n    \n    let result = cache[key] = logic(...args);\n\n    return result;\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n\nexport function once(method : Function) : Function {\n    let called = false;\n\n    const onceFunction = function() : mixed {\n        if (!called) {\n            called = true;\n            return method.apply(this, arguments);\n        }\n    };\n\n    return setFunctionName(onceFunction, `${ getFunctionName(method) }::once`);\n}\n\nexport function hashStr(str : string) : number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash += str[i].charCodeAt(0) * Math.pow((i % 10) + 1, 5);\n    }\n    return Math.floor(Math.pow(Math.sqrt(hash), 5));\n}\n\nexport function strHashStr(str : string) : string {\n    let hash = '';\n\n    for (let i = 0; i < str.length; i++) {\n        let total = (str[i].charCodeAt(0) * i);\n\n        if (str[i + 1]) {\n            total += (str[i + 1].charCodeAt(0) * (i - 1));\n        }\n\n        hash += String.fromCharCode(97 + (Math.abs(total) % 26));\n    }\n\n    return hash;\n}\n\nexport function match(str : string, pattern : RegExp) : ?string {\n    let regmatch = str.match(pattern);\n    if (regmatch) {\n        return regmatch[1];\n    }\n}\n\nexport function awaitKey<T: mixed>(obj : Object, key : string) : ZalgoPromise<T> {\n    return new ZalgoPromise(resolve => {\n\n        let value = obj[key];\n\n        if (value) {\n            return resolve(value);\n        }\n\n        delete obj[key];\n\n        Object.defineProperty(obj, key, {\n\n            configurable: true,\n\n            set(item) {\n                value = item;\n\n                if (value) {\n                    resolve(value);\n                }\n            },\n\n            get() : mixed {\n                return value;\n            }\n        });\n    });\n}\n\nexport function stringifyError(err : mixed, level : number = 1) : string {\n\n    if (level >= 3) {\n        return 'stringifyError stack overflow';\n    }\n\n    try {\n        if (!err) {\n            return `<unknown error: ${ Object.prototype.toString.call(err) }>`;\n        }\n\n        if (typeof err === 'string') {\n            return err;\n        }\n\n        if (err instanceof Error) {\n            let stack = err && err.stack;\n            let message = err && err.message;\n\n            if (stack && message) {\n                if (stack.indexOf(message) !== -1) {\n                    return stack;\n                } else {\n                    return `${ message }\\n${ stack }`;\n                }\n            } else if (stack) {\n                return stack;\n            } else if (message) {\n                return message;\n            }\n        }\n\n        if (err && err.toString && typeof err.toString === 'function') {\n            // $FlowFixMe\n            return err.toString();\n        }\n\n        return Object.prototype.toString.call(err);\n\n    } catch (newErr) { // eslint-disable-line unicorn/catch-error-name\n        return `Error while stringifying error: ${ stringifyError(newErr, level + 1) }`;\n    }\n}\n\nexport function stringifyErrorMessage(err : mixed) : string {\n\n    let defaultMessage = `<unknown error: ${ Object.prototype.toString.call(err) }>`;\n\n    if (!err) {\n        return defaultMessage;\n    }\n\n    if (err instanceof Error) {\n        return err.message || defaultMessage;\n    }\n\n    if (typeof err.message === 'string') {\n        return err.message || defaultMessage;\n    }\n\n    return defaultMessage;\n}\n\nexport function stringify(item : mixed) : string {\n    if (typeof item === 'string') {\n        return item;\n    }\n\n    if (item && item.toString && typeof item.toString === 'function') {\n        // $FlowFixMe\n        return item.toString();\n    }\n\n    return Object.prototype.toString.call(item);\n}\n\nexport function domainMatches(hostname : string, domain : string) : boolean {\n    hostname = hostname.split('://')[1];\n    let index = hostname.indexOf(domain);\n    return (index !== -1 && hostname.slice(index) === domain);\n}\n\nexport function patchMethod(obj : Object, name : string, handler : Function) {\n    let original = obj[name];\n\n    obj[name] = function patchedMethod() : mixed {\n        return handler({\n            context:      this,\n            args:         Array.prototype.slice.call(arguments),\n            original,\n            callOriginal: () => original.apply(this, arguments)\n        });\n    };\n}\n\nexport function extend<T : Object | Function>(obj : T, source : Object) : T {\n    if (!source) {\n        return obj;\n    }\n\n    if (Object.assign) {\n        return Object.assign(obj, source);\n    }\n\n    for (let key in source) {\n        if (source.hasOwnProperty(key)) {\n            obj[key] = source[key];\n        }\n    }\n\n    return obj;\n}\n\nexport function values<T>(obj : { [string] : T }) : Array<T> {\n    let result = [];\n    for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            result.push(obj[key]);\n        }\n    }\n    return result;\n}\n\nexport function perc(pixels : number, percentage : number) : number {\n    return Math.round((pixels * percentage) / 100);\n}\n\nexport function min(...args : Array<number>) : number {\n    return Math.min(...args);\n}\n\nexport function max(...args : Array<number>) : number {\n    return Math.max(...args);\n}\n\nexport function regexMap<T>(str : string, regexp : RegExp, handler : () => T) : Array<T> {\n    let results = [];\n\n    // $FlowFixMe\n    str.replace(regexp, function regexMapMatcher(item) {\n        results.push(handler ? handler.apply(null, arguments) : item);\n    });\n\n    // $FlowFixMe\n    return results;\n}\n\nexport function svgToBase64(svg : string) : string {\n    return `data:image/svg+xml;base64,${ base64encode(svg) }`;\n}\n\nexport function objFilter<T, R>(obj : { [string] : T }, filter? : (T, ?string) => mixed = Boolean) : { [string] : R } {\n    let result = {};\n\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || !filter(obj[key], key)) {\n            continue;\n        }\n\n        result[key] = obj[key];\n    }\n\n    return result;\n}\n\nexport function identity <T>(item : T) : T {\n    return item;\n}\n\nexport function regexTokenize(text : string, regexp : RegExp) : Array<string> {\n    let result = [];\n    text.replace(regexp, token => {\n        result.push(token);\n        return '';\n    });\n    return result;\n}\n\nexport function promiseDebounce<T>(method : () => ZalgoPromise<T> | T, delay : number = 50) : () => ZalgoPromise<T> {\n\n    let promise;\n    let timeout;\n\n    const promiseDebounced = function() : ZalgoPromise<T> {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n\n        let localPromise = promise = promise || new ZalgoPromise();\n\n        timeout = setTimeout(() => {\n            promise = null;\n            timeout = null;\n\n            ZalgoPromise.try(method).then(\n                result => { localPromise.resolve(result); },\n                err => { localPromise.reject(err); }\n            );\n        }, delay);\n\n        return localPromise;\n    };\n\n    return setFunctionName(promiseDebounced, `${ getFunctionName(method) }::promiseDebounced`);\n}\n\nexport function safeInterval(method : Function, time : number) : { cancel : () => void } {\n\n    let timeout;\n\n    function loop() {\n        timeout = setTimeout(() => {\n            method();\n            loop();\n        }, time);\n    }\n\n    loop();\n\n    return {\n        cancel() {\n            clearTimeout(timeout);\n        }\n    };\n}\n\nexport function isInteger(str : string) : boolean {\n    return Boolean(str.match(/^[0-9]+$/));\n}\n\nexport function isFloat(str : string) : boolean {\n    return Boolean(str.match(/^[0-9]+\\.[0-9]+$/));\n}\n\nexport function serializePrimitive(value : string | number | boolean) : string {\n    return value.toString();\n}\n\nexport function deserializePrimitive(value : string) : string | number | boolean {\n    if (value === 'true') {\n        return true;\n    } else if (value === 'false') {\n        return false;\n    } else if (isInteger(value)) {\n        return parseInt(value, 10);\n    } else if (isFloat(value)) {\n        return parseFloat(value);\n    } else {\n        return value;\n    }\n}\n\nexport function dotify(obj : Object, prefix : string = '', newobj : Object = {}) : { [string] : string } {\n    prefix = prefix ? `${ prefix }.` : prefix;\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || obj[key] === undefined || obj[key] === null || typeof obj[key] === 'function') {\n            continue;\n        } else if (obj[key] && Array.isArray(obj[key]) && obj[key].length && obj[key].every(val => typeof val !== 'object')) {\n            newobj[`${ prefix }${ key }[]`] = obj[key].join(',');\n        } else if (obj[key] && typeof obj[key] === 'object') {\n            newobj = dotify(obj[key], `${ prefix }${ key }`, newobj);\n        } else {\n            newobj[`${ prefix }${ key }`] = serializePrimitive(obj[key]);\n        }\n    }\n    return newobj;\n}\n\nexport function undotify(obj : { [string] : string }) : Object {\n    \n    let result = {};\n\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || typeof obj[key] !== 'string') {\n            continue;\n        }\n\n        let value = obj[key];\n\n        if (key.match(/^.+\\[\\]$/)) {\n            key = key.slice(0, key.length - 2);\n            value = value.split(',').map(deserializePrimitive);\n        } else {\n            value = deserializePrimitive(value);\n        }\n\n        let keyResult = result;\n        let parts = key.split('.');\n        for (let i = 0; i < parts.length; i++) {\n            let part = parts[i];\n            let isLast = (i + 1 === parts.length);\n            let isIndex = !isLast && isInteger(parts[i + 1]);\n\n            if (part === 'constructor' || part === 'prototype' || part === '__proto__') {\n                throw new Error(`Disallowed key: ${ part }`);\n            }\n\n            if (isLast) {\n                // $FlowFixMe\n                keyResult[part] = value;\n            } else {\n                // $FlowFixMe\n                keyResult = keyResult[part] = keyResult[part] || (isIndex ? [] : {});\n            }\n        }\n    }\n\n    return result;\n}\n\nexport type EventEmitterType = {\n    on : (eventName : string, handler : Function) => CancelableType,\n    once : (eventName : string, handler : Function) => CancelableType,\n    trigger : (eventName : string, ...args : $ReadOnlyArray<mixed>) => ZalgoPromise<void>,\n    triggerOnce : (eventName : string, ...args : $ReadOnlyArray<mixed>) => ZalgoPromise<void>,\n    reset : () => void\n};\n\nexport function eventEmitter() : EventEmitterType {\n    let triggered = {};\n    let handlers = {};\n\n    return {\n\n        on(eventName : string, handler : Function) : CancelableType {\n            let handlerList = handlers[eventName] = handlers[eventName] || [];\n\n            handlerList.push(handler);\n\n            let cancelled = false;\n\n            return {\n                cancel() {\n                    if (!cancelled) {\n                        cancelled = true;\n                        handlerList.splice(handlerList.indexOf(handler), 1);\n                    }\n\n                }\n            };\n        },\n\n        once(eventName : string, handler : Function) : CancelableType {\n\n            let listener = this.on(eventName, () => {\n                listener.cancel();\n                handler();\n            });\n\n            return listener;\n        },\n\n        trigger(eventName : string, ...args : $ReadOnlyArray<mixed>) : ZalgoPromise<void> {\n\n            let handlerList = handlers[eventName];\n            let promises = [];\n\n            if (handlerList) {\n                for (let handler of handlerList) {\n                    promises.push(ZalgoPromise.try(() => handler(...args)));\n                }\n            }\n\n            return ZalgoPromise.all(promises).then(noop);\n        },\n\n        triggerOnce(eventName : string, ...args : $ReadOnlyArray<mixed>) : ZalgoPromise<void> {\n\n            if (triggered[eventName]) {\n                return ZalgoPromise.resolve();\n            }\n\n            triggered[eventName] = true;\n            return this.trigger(eventName, ...args);\n        },\n\n        reset() {\n            handlers = {};\n        }\n    };\n}\n\nexport function camelToDasherize(string : string) : string {\n    return string.replace(/([A-Z])/g, (g) => {\n        return `-${ g.toLowerCase() }`;\n    });\n}\n\nexport function dasherizeToCamel(string : string) : string {\n    return string.replace(/-([a-z])/g, (g) => {\n        return g[1].toUpperCase();\n    });\n}\n\nexport function capitalizeFirstLetter(string : string) : string {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}\n\nexport function get(item : Object, path : string, def : mixed) : mixed {\n\n    if (!path) {\n        return def;\n    }\n\n    let pathParts = path.split('.');\n\n    // Loop through each section of our key path\n\n    for (let i = 0; i < pathParts.length; i++) {\n\n        // If we have an object, we can get the key\n        if (typeof item === 'object' && item !== null) {\n            item = item[pathParts[i]];\n\n        // Otherwise, we should return the default (undefined if not provided)\n        } else {\n            return def;\n        }\n    }\n\n    // If our final result is undefined, we should return the default\n\n    return item === undefined ? def : item;\n}\n\nexport function safeTimeout(method : Function, time : number) {\n\n    let interval = safeInterval(() => {\n        time -= 100;\n        if (time <= 0) {\n            interval.cancel();\n            method();\n        }\n    }, 100);\n}\n\nexport function defineLazyProp<T>(obj : Object | Array<mixed>, key : string | number, getter : () => T) {\n    if (Array.isArray(obj)) {\n        if (typeof key !== 'number') {\n            throw new TypeError(`Array key must be number`);\n        }\n    } else if (typeof obj === 'object' && obj !== null) {\n        if (typeof key !== 'string') {\n            throw new TypeError(`Object key must be string`);\n        }\n    }\n    \n    Object.defineProperty(obj, key, {\n        configurable: true,\n        enumerable:   true,\n        get:          () => {\n            // $FlowFixMe\n            delete obj[key];\n            let value = getter();\n            // $FlowFixMe\n            obj[key] = value;\n            return value;\n        },\n        set: (value : T) => {\n            // $FlowFixMe\n            delete obj[key];\n            // $FlowFixMe\n            obj[key] = value;\n        }\n    });\n}\n\nexport function arrayFrom<T>(item : Iterable<T>) : Array<T> { // eslint-disable-line no-undef\n    return Array.prototype.slice.call(item);\n}\n\nexport function isObject(item : mixed) : boolean {\n    return (typeof item === 'object' && item !== null);\n}\n\nexport function isObjectObject(obj : mixed) : boolean {\n    return isObject(obj) && Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nexport function isPlainObject(obj : mixed) : boolean {\n    if (!isObjectObject(obj)) {\n        return false;\n    }\n\n    // $FlowFixMe\n    let constructor = obj.constructor;\n\n    if (typeof constructor !== 'function') {\n        return false;\n    }\n\n    let prototype = constructor.prototype;\n\n    if (!isObjectObject(prototype)) {\n        return false;\n    }\n\n    if (!prototype.hasOwnProperty('isPrototypeOf')) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function replaceObject<T : Array<mixed> | Object> (item : T, replacer : (mixed, string | number, string) => mixed, fullKey : string = '') : T {\n\n    if (Array.isArray(item)) {\n        let length = item.length;\n        let result : Array<mixed> = [];\n\n        for (let i = 0; i < length; i++) {\n\n            \n            defineLazyProp(result, i, () => {\n                let itemKey = fullKey ? `${ fullKey }.${ i }` : `${ i }`;\n                let el = item[i];\n\n                let child = replacer(el, i, itemKey);\n\n                if (isPlainObject(child) || Array.isArray(child)) {\n                    // $FlowFixMe\n                    child = replaceObject(child, replacer, itemKey);\n                }\n\n                return child;\n            });\n        }\n\n        // $FlowFixMe\n        return result;\n    } else if (isPlainObject(item)) {\n        let result = {};\n\n        for (let key in item) {\n            if (!item.hasOwnProperty(key)) {\n                continue;\n            }\n\n            defineLazyProp(result, key, () => {\n                let itemKey = fullKey ? `${ fullKey }.${ key }` : `${ key }`;\n                // $FlowFixMe\n                let el = item[key];\n\n                let child = replacer(el, key, itemKey);\n\n                if (isPlainObject(child) || Array.isArray(child)) {\n                    // $FlowFixMe\n                    child = replaceObject(child, replacer, itemKey);\n                }\n\n                return child;\n            });\n        }\n\n        // $FlowFixMe\n        return result;\n    } else {\n        throw new Error(`Pass an object or array`);\n    }\n}\n\n\nexport function copyProp(source : Object, target : Object, name : string, def : mixed) {\n    if (source.hasOwnProperty(name)) {\n        let descriptor = Object.getOwnPropertyDescriptor(source, name);\n        // $FlowFixMe\n        Object.defineProperty(target, name, descriptor);\n\n    } else {\n        target[name] = def;\n    }\n}\n\ntype RegexResultType = {\n    text : string,\n    groups : Array<string>,\n    start : number,\n    end : number,\n    length : number,\n    replace : (text : string) => string\n};\n\nexport function regex(pattern : string | RegExp, string : string, start : number = 0) : ?RegexResultType {\n\n    if (typeof pattern === 'string') {\n        // eslint-disable-next-line security/detect-non-literal-regexp\n        pattern = new RegExp(pattern);\n    }\n\n    let result = string.slice(start).match(pattern);\n\n    if (!result) {\n        return;\n    }\n\n    // $FlowFixMe\n    let index : number = result.index;\n    let regmatch = result[0];\n\n    return {\n        text:   regmatch,\n        groups: result.slice(1),\n        start:  start + index,\n        end:    start + index + regmatch.length,\n        length: regmatch.length,\n\n        replace(text : string) : string {\n\n            if (!regmatch) {\n                return '';\n            }\n\n            return `${ regmatch.slice(0, start + index) }${ text }${ regmatch.slice(index + regmatch.length) }`;\n        }\n    };\n}\n\nexport function regexAll(pattern : string | RegExp, string : string) : Array<RegexResultType> {\n\n    let matches = [];\n    let start = 0;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        let regmatch = regex(pattern, string, start);\n\n        if (!regmatch) {\n            break;\n        }\n\n        matches.push(regmatch);\n        start = match.end;\n    }\n\n    return matches;\n}\n\nexport function isDefined(value : ?mixed) : boolean {\n    return value !== null && value !== undefined;\n}\n\nexport function cycle(method : Function) : ZalgoPromise<void> {\n    return ZalgoPromise.try(method).then(() => cycle(method));\n}\n\nexport function debounce<T>(method : (...args : Array<mixed>) => T, time : number = 100) : (...args : Array<mixed>) => void {\n\n    let timeout;\n\n    const debounceWrapper = function() {\n        clearTimeout(timeout);\n\n        timeout = setTimeout(() => {\n            return method.apply(this, arguments);\n        }, time);\n    };\n\n    return setFunctionName(debounceWrapper, `${ getFunctionName(method) }::debounced`);\n}\n\nexport function isRegex(item : mixed) : boolean {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\ntype FunctionProxy<T : Function> = (method : T) => T;\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport let weakMapMemoize : FunctionProxy<*> = <R : mixed>(method : (arg : any) => R) : ((...args : Array<any>) => R) => {\n\n    let weakmap = new WeakMap();\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    return function weakmapMemoized(arg : any) : R {\n        return weakmap.getOrSet(arg, () => method.call(this, arg));\n    };\n};\n\ntype FunctionPromiseProxy<R : mixed, T : (...args : $ReadOnlyArray<mixed>) => ZalgoPromise<R>> = (T) => T;\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport let weakMapMemoizePromise : FunctionPromiseProxy<*, *> = <R : mixed>(method : (arg : any) => ZalgoPromise<R>) : ((...args : Array<any>) => ZalgoPromise<R>) => {\n\n    let weakmap = new WeakMap();\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    return function weakmapMemoizedPromise(arg : any) : ZalgoPromise<R> {\n        return weakmap.getOrSet(arg, () =>\n            method.call(this, arg).finally(() => {\n                weakmap.delete(arg);\n            })\n        );\n    };\n};\n\nexport function getOrSet<O : Object, T : mixed>(obj : O, key : string, getter : () => T) : T {\n    if (obj.hasOwnProperty(key)) {\n        return obj[key];\n    }\n\n    const val = getter();\n    obj[key] = val;\n    return val;\n}\n\nexport type CleanupType = {|\n    set : <T : mixed>(string, T) => T, // eslint-disable-line no-undef\n    register : (Function) => void,\n    all : () => ZalgoPromise<void>\n|};\n\nexport function cleanup(obj : Object) : CleanupType {\n\n    const tasks = [];\n    let cleaned = false;\n\n    return {\n        set<T : mixed>(name : string, item : T) : T {\n            if (!cleaned) {\n                obj[name] = item;\n                this.register(() => {\n                    delete obj[name];\n                });\n            }\n            return item;\n        },\n\n        register(method : Function) {\n            if (cleaned) {\n                method();\n            } else {\n                tasks.push(once(method));\n            }\n        },\n\n        all() : ZalgoPromise<void> {\n            const results = [];\n            cleaned = true;\n\n            while (tasks.length) {\n                const task = tasks.pop();\n                results.push(task());\n            }\n\n            return ZalgoPromise.all(results).then(noop);\n        }\n    };\n}\n\nexport function tryCatch<T>(fn : () => T) : {| result : T, error : void |} | {| result : void, error : mixed |} {\n    let result;\n    let error;\n\n    try {\n        result = fn();\n    } catch (err) {\n        error = err;\n    }\n    \n    // $FlowFixMe\n    return { result, error };\n}\n\nexport function removeFromArray<X, T : Array<X>>(arr : T, item : X) {\n    const index = arr.indexOf(item);\n    if (index !== -1) {\n        arr.splice(index, 1);\n    }\n}\n\nexport function assertExists<T>(name : string, thing : void | null | T) : T {\n    if (thing === null || typeof thing === 'undefined') {\n        throw new Error(`Expected ${ name } to be present`);\n    }\n                            \n    return thing;\n}\n                            \nexport function unique(arr : $ReadOnlyArray<string>) : $ReadOnlyArray<string> {\n    const result = {};\n    for (const item of arr) {\n        // eslint-disable-next-line const-immutable/no-mutation\n        result[item] = true;\n    }\n    return Object.keys(result);\n}\n","/* @flow */\n\nexport const KEY_CODES = {\n    ENTER: 13\n};\n","/* @flow */\n/* eslint max-lines: off */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { linkFrameWindow, isWindowClosed,\n    type SameDomainWindowType, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\n\nimport { inlineMemoize, noop, stringify, capitalizeFirstLetter,\n    once, extend, safeInterval, uniqueID, arrayFrom } from './util';\nimport { isDevice } from './device';\nimport { KEY_CODES } from './constants';\nimport type { CancelableType } from './types';\n\ntype ElementRefType = string | HTMLElement;\n\nexport function isDocumentReady() : boolean {\n    return Boolean(document.body) && document.readyState === 'complete';\n}\n\nexport function urlEncode(str : string) : string {\n    return str.replace(/\\?/g, '%3F').replace(/&/g, '%26').replace(/#/g, '%23').replace(/\\+/g, '%2B');\n}\n\nexport function waitForWindowReady() : ZalgoPromise<void> {\n    return inlineMemoize(waitForWindowReady, () : ZalgoPromise<void> => {\n        return new ZalgoPromise(resolve => {\n            if (isDocumentReady()) {\n                resolve();\n            }\n\n            window.addEventListener('load', () => resolve());\n        });\n    });\n}\n\nexport function waitForDocumentReady() : ZalgoPromise<void> {\n    return inlineMemoize(waitForDocumentReady, () : ZalgoPromise<void> => {\n        return new ZalgoPromise(resolve => {\n\n            if (isDocumentReady()) {\n                return resolve();\n            }\n\n            let interval = setInterval(() => {\n                if (isDocumentReady()) {\n                    clearInterval(interval);\n                    return resolve();\n                }\n            }, 10);\n        });\n    });\n}\n\nexport function waitForDocumentBody() : ZalgoPromise<HTMLBodyElement> {\n    return waitForDocumentReady().then(() => {\n        if (document.body) {\n            return document.body;\n        }\n\n        throw new Error('Document ready but document.body not present');\n    });\n}\n\nexport function parseQuery(queryString : string) : Object {\n    return inlineMemoize(parseQuery, () : Object => {\n        let params = {};\n\n        if (!queryString) {\n            return params;\n        }\n\n        if (queryString.indexOf('=') === -1) {\n            return params;\n        }\n\n        for (let pair of queryString.split('&')) {\n            pair = pair.split('=');\n\n            if (pair[0] && pair[1]) {\n                params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n            }\n        }\n\n        return params;\n    }, [ queryString ]);\n}\n\n\nexport function getQueryParam(name : string) : string {\n    return parseQuery(window.location.search.slice(1))[name];\n}\n\nexport function urlWillRedirectPage(url : string) : boolean {\n\n    if (url.indexOf('#') === -1) {\n        return true;\n    }\n\n    if (url.indexOf('#') === 0) {\n        return false;\n    }\n\n    if (url.split('#')[0] === window.location.href.split('#')[0]) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function formatQuery(obj : { [ string ] : string } = {}) : string {\n\n    return Object.keys(obj).filter(key => {\n        return typeof obj[key] === 'string';\n    }).map(key => {\n        return `${ urlEncode(key) }=${ urlEncode(obj[key]) }`;\n    }).join('&');\n}\n\nexport function extendQuery(originalQuery : string, props : { [ string ] : string } = {}) : string {\n\n    if (!props || !Object.keys(props).length) {\n        return originalQuery;\n    }\n\n    return formatQuery({\n        ...parseQuery(originalQuery),\n        ...props\n    });\n}\n\nexport function extendUrl(url : string, options : { query? : { [string] : string }, hash? : { [string] : string } } = {}) : string {\n\n    let query = options.query || {};\n    let hash = options.hash || {};\n\n    let originalUrl;\n    let originalQuery;\n    let originalHash;\n\n    [ originalUrl, originalHash ] = url.split('#');\n    [ originalUrl, originalQuery ] = originalUrl.split('?');\n\n    let queryString = extendQuery(originalQuery, query);\n    let hashString = extendQuery(originalHash, hash);\n\n    if (queryString) {\n        originalUrl = `${ originalUrl }?${ queryString }`;\n    }\n\n    if (hashString) {\n        originalUrl = `${ originalUrl }#${ hashString }`;\n    }\n\n    return originalUrl;\n}\n\nexport function redirect(url : string, win : CrossDomainWindowType = window) : ZalgoPromise<void> {\n    return new ZalgoPromise(resolve => {\n        win.location = url;\n        if (!urlWillRedirectPage(url)) {\n            resolve();\n        }\n    });\n}\n\nexport function hasMetaViewPort() : boolean {\n    let meta = document.querySelector('meta[name=viewport]');\n\n    if (isDevice() && window.screen.width < 660 && !meta) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function isElementVisible(el : HTMLElement) : boolean {\n    return Boolean(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n}\n\nexport function enablePerformance() : boolean {\n    return inlineMemoize(enablePerformance, () : boolean => {\n        /* eslint-disable compat/compat */\n        return Boolean(\n            window.performance &&\n            performance.now &&\n            performance.timing &&\n            performance.timing.connectEnd &&\n            performance.timing.navigationStart &&\n            (Math.abs(performance.now() - Date.now()) > 1000) &&\n            (performance.now() - (performance.timing.connectEnd - performance.timing.navigationStart)) > 0\n        );\n        /* eslint-enable compat/compat */\n    });\n}\n\nexport function getPageRenderTime() : ZalgoPromise<?number> {\n    return waitForDocumentReady().then(() => {\n\n        if (!enablePerformance()) {\n            return;\n        }\n\n        let timing = window.performance.timing;\n\n        if (timing.connectEnd && timing.domInteractive) {\n            return timing.domInteractive - timing.connectEnd;\n        }\n    });\n}\n\nexport function htmlEncode(html : string = '') : string {\n    return html.toString()\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#39;')\n        .replace(/\\//g, '&#x2F;');\n}\n\nexport function isBrowser() : boolean {\n    return (typeof window !== 'undefined');\n}\n\nexport function querySelectorAll(selector : string, doc : HTMLElement = window.document) : Array<HTMLElement> {\n    return Array.prototype.slice.call(doc.querySelectorAll(selector));\n}\n\nexport function onClick(element : HTMLElement, handler : (Event) => void) {\n    element.addEventListener('touchstart', noop);\n    element.addEventListener('click', handler);\n    element.addEventListener('keypress', (event : Event) => {\n        // $FlowFixMe\n        if (event.keyCode === KEY_CODES.ENTER) {\n            return handler(event);\n        }\n    });\n}\n\nexport function getScript({ host = window.location.host, path } : { host? : string, path : string }) : ?HTMLScriptElement {\n    return inlineMemoize(getScript, () : ?HTMLScriptElement => {\n\n        let url = `${ host }${ path }`;\n        let scripts = Array.prototype.slice.call(document.getElementsByTagName('script'));\n\n        for (let script of scripts) {\n            if (!script.src) {\n                continue;\n            }\n\n            let src = script.src.replace(/^https?:\\/\\//, '').split('?')[0];\n\n            if (src === url) {\n                return script;\n            }\n        }\n    }, [ path ]);\n}\n\nexport function isLocalStorageEnabled() : boolean {\n    return inlineMemoize(isLocalStorageEnabled, () => {\n        try {\n            if (typeof window === 'undefined') {\n                return false;\n            }\n\n            if (window.localStorage) {\n                let value = Math.random().toString();\n                window.localStorage.setItem('__test__localStorage__', value);\n                let result = window.localStorage.getItem('__test__localStorage__');\n                window.localStorage.removeItem('__test__localStorage__');\n                if (value === result) {\n                    return true;\n                }\n            }\n        } catch (err) {\n            // pass\n        }\n        return false;\n    });\n}\n\nexport function getBrowserLocales() : Array<{ country? : string, lang : string }> {\n    let nav = window.navigator;\n\n    let locales = nav.languages\n        ? Array.prototype.slice.apply(nav.languages)\n        : [];\n\n    if (nav.language) {\n        locales.push(nav.language);\n    }\n\n    if (nav.userLanguage) {\n        locales.push(nav.userLanguage);\n    }\n\n    return locales.map(locale => {\n\n        if (locale && locale.match(/^[a-z]{2}[-_][A-Z]{2}$/)) {\n            let [ lang, country ] = locale.split(/[-_]/);\n            return { country, lang };\n        }\n\n        if (locale && locale.match(/^[a-z]{2}$/)) {\n            return { lang: locale };\n        }\n\n        return null;\n\n    }).filter(Boolean);\n}\n\n\nexport function appendChild(container : HTMLElement, child : HTMLElement | Text) {\n    container.appendChild(child);\n}\n\nexport function isElement(element : mixed) : boolean {\n\n    if (element instanceof window.Element) {\n        return true;\n    }\n\n    if (element !== null && typeof element === 'object' && element.nodeType === 1 && typeof element.style === 'object' && typeof element.ownerDocument === 'object') {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getElementSafe(id : ElementRefType, doc : Document | HTMLElement = document) : ?HTMLElement {\n\n    if (isElement(id)) {\n        // $FlowFixMe\n        return id;\n    }\n\n    if (typeof id === 'string') {\n        return doc.querySelector(id);\n    }\n}\n\nexport function getElement(id : ElementRefType, doc : Document | HTMLElement = document) : HTMLElement {\n\n    let element = getElementSafe(id, doc);\n\n    if (element) {\n        return element;\n    }\n\n    throw new Error(`Can not find element: ${ stringify(id) }`);\n}\n\nexport function elementReady(id : ElementRefType) : ZalgoPromise<window.HTMLElement> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        let name = stringify(id);\n        let el = getElementSafe(id);\n\n        if (el) {\n            return resolve(el);\n        }\n\n        if (isDocumentReady()) {\n            return reject(new Error(`Document is ready and element ${ name } does not exist`));\n        }\n\n        let interval = setInterval(() => {\n\n            el = getElementSafe(id);\n\n            if (el) {\n                clearInterval(interval);\n                return resolve(el);\n            }\n\n            if (isDocumentReady()) {\n                clearInterval(interval);\n                return reject(new Error(`Document is ready and element ${ name } does not exist`));\n            }\n        }, 10);\n    });\n}\n\nexport function PopupOpenError(message : string) {\n    this.message = message;\n}\n\nPopupOpenError.prototype = Object.create(Error.prototype);\n\ntype PopupOptions = {|\n    name? : string,\n    width? : number,\n    height? : number,\n    top? : number,\n    left? : number,\n    status? : 0 | 1,\n    resizable? : 0 | 1,\n    toolbar? : 0 | 1,\n    menubar? : 0 | 1,\n    scrollbars? : 0 | 1\n|};\n\nexport function popup(url : string, options? : PopupOptions) : CrossDomainWindowType {\n\n    // $FlowFixMe\n    options = options || {};\n\n    let { width, height } = options;\n\n    let top = 0;\n    let left = 0;\n\n    if (width) {\n        if (window.outerWidth) {\n            left = Math.round((window.outerWidth - width) / 2) + window.screenX;\n        } else if (window.screen.width) {\n            left = Math.round((window.screen.width - width) / 2);\n        }\n    }\n\n    if (height) {\n        if (window.outerHeight) {\n            top = Math.round((window.outerHeight - height) / 2) + window.screenY;\n        } else if (window.screen.height) {\n            top = Math.round((window.screen.height - height) / 2);\n        }\n    }\n\n    if (width && height) {\n        options = {\n            top,\n            left,\n            width,\n            height,\n            status:     1,\n            toolbar:    0,\n            menubar:    0,\n            resizable:  1,\n            scrollbars: 1,\n            ...options\n        };\n    }\n\n    let name = options.name || '';\n    delete options.name;\n\n    // eslint-disable-next-line array-callback-return\n    let params = Object.keys(options).map(key => {\n        // $FlowFixMe\n        if (options[key] !== null && options[key] !== undefined) {\n            return `${ key }=${ stringify(options[key]) }`;\n        }\n    }).filter(Boolean).join(',');\n\n    let win;\n\n    try {\n        win = window.open(url, name, params, true);\n    } catch (err) {\n        throw new PopupOpenError(`Can not open popup window - ${ err.stack || err.message }`);\n    }\n\n    if (isWindowClosed(win)) {\n        let err = new PopupOpenError(`Can not open popup window - blocked`);\n        throw err;\n    }\n\n    window.addEventListener('unload', () => win.close());\n\n    return win;\n}\n\n\nexport function writeToWindow(win : SameDomainWindowType, html : string) {\n    try {\n        win.document.open();\n        win.document.write(html);\n        win.document.close();\n    } catch (err) {\n        try {\n            win.location = `javascript: document.open(); document.write(${ JSON.stringify(html) }); document.close();`;\n        } catch (err2) {\n            // pass\n        }\n    }\n}\n\nexport function writeElementToWindow(win : SameDomainWindowType, el : HTMLElement) {\n\n    let tag = el.tagName.toLowerCase();\n\n    if (tag !== 'html') {\n        throw new Error(`Expected element to be html, got ${ tag }`);\n    }\n\n    let documentElement = win.document.documentElement;\n\n    for (const child of arrayFrom(documentElement.children)) {\n        documentElement.removeChild(child);\n    }\n\n    for (const child of arrayFrom(el.children)) {\n        documentElement.appendChild(child);\n    }\n}\n\nexport function setStyle(el : HTMLElement, styleText : string, doc : Document = window.document) {\n    // $FlowFixMe\n    if (el.styleSheet) {\n        // $FlowFixMe\n        el.styleSheet.cssText = styleText;\n    } else {\n        el.appendChild(doc.createTextNode(styleText));\n    }\n}\n\nexport type ElementOptionsType = {\n    style? : { [ string ] : string },\n    id? : string,\n    class? : ?Array<string>,\n    attributes? : { [ string ] : string },\n    styleSheet? : ?string,\n    html? : ?string\n};\n\nlet awaitFrameLoadPromises : WeakMap<HTMLIFrameElement, ZalgoPromise<HTMLIFrameElement>>;\n\nexport function awaitFrameLoad(frame : HTMLIFrameElement) : ZalgoPromise<HTMLIFrameElement> {\n    awaitFrameLoadPromises = awaitFrameLoadPromises || new WeakMap();\n\n    if (awaitFrameLoadPromises.has(frame)) {\n        let promise = awaitFrameLoadPromises.get(frame);\n        if (promise) {\n            return promise;\n        }\n    }\n\n    let promise = new ZalgoPromise((resolve, reject) => {\n        frame.addEventListener('load', () => {\n            linkFrameWindow(frame);\n            resolve(frame);\n        });\n\n        frame.addEventListener('error', (err : Event) => {\n            if (frame.contentWindow) {\n                resolve(frame);\n            } else {\n                reject(err);\n            }\n        });\n    });\n\n    awaitFrameLoadPromises.set(frame, promise);\n\n    return promise;\n}\n\nexport function awaitFrameWindow(frame : HTMLIFrameElement) : ZalgoPromise<CrossDomainWindowType> {\n    return awaitFrameLoad(frame).then(loadedFrame => {\n\n        if (!loadedFrame.contentWindow) {\n            throw new Error(`Could not find window in iframe`);\n        }\n\n        return loadedFrame.contentWindow;\n    });\n}\n\nexport function createElement(tag : string = 'div', options : ElementOptionsType = {}, container : ?HTMLElement) : HTMLElement {\n\n    tag = tag.toLowerCase();\n    let element = document.createElement(tag);\n\n    if (options.style) {\n        extend(element.style, options.style);\n    }\n\n    if (options.class) {\n        element.className = options.class.join(' ');\n    }\n\n    if (options.id) {\n        element.setAttribute('id', options.id);\n    }\n\n    if (options.attributes) {\n        for (let key of Object.keys(options.attributes)) {\n            element.setAttribute(key, options.attributes[key]);\n        }\n    }\n\n    if (options.styleSheet) {\n        setStyle(element, options.styleSheet);\n    }\n\n    if (container) {\n        appendChild(container, element);\n    }\n\n    if (options.html) {\n        if (tag === 'iframe') {\n            // $FlowFixMe\n            if (!container || !element.contentWindow) {\n                throw new Error(`Iframe html can not be written unless container provided and iframe in DOM`);\n            }\n\n            // $FlowFixMe\n            writeToWindow(element.contentWindow, options.html);\n\n        } else {\n            element.innerHTML = options.html;\n        }\n    }\n\n    return element;\n}\n\n\nexport type IframeElementOptionsType = {\n    style? : { [ string ] : string },\n    class? : ?Array<string>,\n    attributes? : { [ string ] : string },\n    styleSheet? : ?string,\n    html? : ?string,\n    url? : ?string\n};\n\nexport function iframe(options : IframeElementOptionsType = {}, container : ?HTMLElement) : HTMLIFrameElement {\n\n    let attributes = options.attributes || {};\n    let style = options.style || {};\n\n    let frame = createElement('iframe', {\n        attributes: {\n            allowTransparency: 'true',\n            ...attributes\n        },\n        style: {\n            backgroundColor: 'transparent',\n            border:          'none',\n            ...style\n        },\n        html:  options.html,\n        class: options.class\n    });\n\n    const isIE = window.navigator.userAgent.match(/MSIE|Edge/i);\n    \n    if (!frame.hasAttribute('id')) {\n        frame.setAttribute('id', uniqueID());\n    }\n\n    // $FlowFixMe\n    awaitFrameLoad(frame);\n\n    if (container) {\n        let el = getElement(container);\n        el.appendChild(frame);\n    }\n\n    if (options.url || isIE) {\n        frame.setAttribute('src', options.url || 'about:blank');\n    }\n\n    // $FlowFixMe\n    return frame;\n}\n\nexport function addEventListener(obj : HTMLElement, event : string, handler : (event : Event) => void) : CancelableType {\n    obj.addEventListener(event, handler);\n    return {\n        cancel() {\n            obj.removeEventListener(event, handler);\n        }\n    };\n}\n\nexport function bindEvents(element : HTMLElement, eventNames : Array<string>, handler : (event : Event) => void) : CancelableType {\n\n    handler = once(handler);\n\n    for (let eventName of eventNames) {\n        element.addEventListener(eventName, handler);\n    }\n\n    return {\n        cancel: once(() => {\n            for (let eventName of eventNames) {\n                element.removeEventListener(eventName, handler);\n            }\n        })\n    };\n}\n\nconst VENDOR_PREFIXES = [ 'webkit', 'moz', 'ms', 'o' ];\n\nexport function setVendorCSS(element : HTMLElement, name : string, value : string) {\n\n    // $FlowFixMe\n    element.style[name] = value;\n\n    let capitalizedName = capitalizeFirstLetter(name);\n\n    for (let prefix of VENDOR_PREFIXES) {\n        // $FlowFixMe\n        element.style[`${ prefix }${ capitalizedName }`] = value;\n    }\n}\n\nconst ANIMATION_START_EVENTS = [ 'animationstart', 'webkitAnimationStart', 'oAnimationStart', 'MSAnimationStart' ];\nconst ANIMATION_END_EVENTS   = [ 'animationend', 'webkitAnimationEnd', 'oAnimationEnd', 'MSAnimationEnd' ];\n\nexport function animate(element : ElementRefType, name : string, clean : (Function) => void, timeout : number = 1000) : ZalgoPromise<void> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        let el = getElement(element);\n\n        if (!el) {\n            return resolve();\n        }\n\n        let hasStarted = false;\n\n        let startTimeout;\n        let endTimeout;\n        let startEvent;\n        let endEvent;\n\n        function cleanUp() {\n            clearTimeout(startTimeout);\n            clearTimeout(endTimeout);\n            startEvent.cancel();\n            endEvent.cancel();\n        }\n\n        startEvent = bindEvents(el, ANIMATION_START_EVENTS, event => {\n\n            // $FlowFixMe\n            if (event.target !== el || event.animationName !== name) {\n                return;\n            }\n\n            clearTimeout(startTimeout);\n\n            event.stopPropagation();\n\n            startEvent.cancel();\n            hasStarted = true;\n\n            endTimeout = setTimeout(() => {\n                cleanUp();\n                resolve();\n            }, timeout);\n        });\n\n        endEvent = bindEvents(el, ANIMATION_END_EVENTS, event => {\n\n            // $FlowFixMe\n            if (event.target !== el || event.animationName !== name) {\n                return;\n            }\n\n            cleanUp();\n\n            // $FlowFixMe\n            if (typeof event.animationName === 'string' && event.animationName !== name) {\n                return reject(`Expected animation name to be ${ name }, found ${ event.animationName }`);\n            }\n\n            return resolve();\n        });\n\n        setVendorCSS(el, 'animationName', name);\n\n        startTimeout = setTimeout(() => {\n            if (!hasStarted) {\n                cleanUp();\n                return resolve();\n            }\n        }, 200);\n\n        if (clean) {\n            clean(cleanUp);\n        }\n    });\n}\n\nconst STYLE = {\n\n    DISPLAY: {\n        NONE:  'none',\n        BLOCK: 'block'\n    },\n\n    VISIBILITY: {\n        VISIBLE: 'visible',\n        HIDDEN:  'hidden'\n    },\n\n    IMPORTANT: 'important'\n};\n\nexport function makeElementVisible(element : HTMLElement) {\n    element.style.setProperty('visibility', '');\n}\n\nexport function makeElementInvisible(element : HTMLElement) {\n    element.style.setProperty('visibility', STYLE.VISIBILITY.HIDDEN, STYLE.IMPORTANT);\n}\n\n\nexport function showElement(element : HTMLElement) {\n    element.style.setProperty('display', '');\n}\n\nexport function hideElement(element : HTMLElement) {\n    element.style.setProperty('display', STYLE.DISPLAY.NONE, STYLE.IMPORTANT);\n}\n\nexport function destroyElement(element : HTMLElement) {\n    if (element && element.parentNode) {\n        element.parentNode.removeChild(element);\n    }\n}\n\nexport function showAndAnimate(element : HTMLElement, name : string, clean : (Function) => void) : ZalgoPromise<void> {\n    let animation = animate(element, name, clean);\n    showElement(element);\n    return animation;\n}\n\nexport function animateAndHide(element : HTMLElement, name : string, clean : (Function) => void) : ZalgoPromise<void> {\n    return animate(element, name, clean).then(() => {\n        hideElement(element);\n    });\n}\n\nexport function addClass(element : HTMLElement, name : string) {\n    element.classList.add(name);\n}\n\nexport function removeClass(element : HTMLElement, name : string) {\n    element.classList.remove(name);\n}\n\nexport function isElementClosed(el : HTMLElement) : boolean {\n    if (!el || !el.parentNode) {\n        return true;\n    }\n    return false;\n}\n\nexport function watchElementForClose(element : HTMLElement, handler : () => mixed) : CancelableType {\n    handler = once(handler);\n\n    let interval;\n\n    if (isElementClosed(element)) {\n        handler();\n    } else {\n        interval = safeInterval(() => {\n            if (isElementClosed(element)) {\n                interval.cancel();\n                handler();\n            }\n        }, 50);\n    }\n\n    return {\n        cancel() {\n            if (interval) {\n                interval.cancel();\n            }\n        }\n    };\n}\n\nexport function fixScripts(el : HTMLElement, doc : Document = window.document) {\n    for (let script of querySelectorAll('script', el)) {\n        let parentNode = script.parentNode;\n\n        if (!parentNode) {\n            continue;\n        }\n\n        let newScript = doc.createElement('script');\n        newScript.text = script.textContent;\n        parentNode.replaceChild(newScript, script);\n    }\n}\n\ntype OnResizeOptions = {|\n    width? : boolean,\n    height? : boolean,\n    interval? : number,\n    win? : SameDomainWindowType\n|};\n\nexport function onResize(el : HTMLElement, handler : ({ width : number, height : number }) => void, { width = true, height = true, interval = 100, win = window } : OnResizeOptions = {}) : {} {\n    let currentWidth = el.offsetWidth;\n    let currentHeight = el.offsetHeight;\n\n    handler({ width: currentWidth, height: currentHeight });\n\n    let check = () => {\n        let newWidth = el.offsetWidth;\n        let newHeight = el.offsetHeight;\n\n        if ((width && newWidth !== currentWidth) || (height && newHeight !== currentHeight)) {\n            handler({ width: newWidth, height: newHeight });\n        }\n\n        currentWidth = newWidth;\n        currentHeight = newHeight;\n    };\n\n    let observer;\n    let timeout;\n\n    if (typeof win.ResizeObserver !== 'undefined') {\n        observer = new win.ResizeObserver(check);\n        observer.observe(el);\n\n    } else if (typeof win.MutationObserver !== 'undefined') {\n        observer = new win.MutationObserver(check);\n        observer.observe(el, {\n            attributes:    true,\n            childList:     true,\n            subtree:       true,\n            characterData: false\n        });\n        win.addEventListener('resize', check);\n    } else {\n        let loop = () => {\n            check();\n            timeout = setTimeout(loop, interval);\n        };\n        loop();\n    }\n\n    return {\n        cancel: () => {\n            observer.disconnect();\n            window.removeEventListener('resize', check);\n            clearTimeout(timeout);\n        }\n    };\n}\n\nexport function getResourceLoadTime(url : string) : ?number {\n\n    if (!enablePerformance()) {\n        return;\n    }\n\n    if (!window.performance || typeof window.performance.getEntries !== 'function') {\n        return;\n    }\n\n    const entries = window.performance.getEntries();\n\n    for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n\n        if (entry && entry.name && entry.name.indexOf(url) === 0 && typeof entry.duration === 'number') {\n            return Math.floor(entry.duration);\n        }\n    }\n}\n","/* @flow */\n\nimport { uniqueID, getGlobal, inlineMemoize } from './util';\nimport { isLocalStorageEnabled } from './dom';\n\ntype Getter<T> = <T>(handler : (Object) => T) => T;\n\nexport type Storage = {\n    getState : Getter<*>,\n    getID : () => string,\n    getSessionState : Getter<*>,\n    getSessionID : () => string\n};\n\nconst DEFAULT_SESSION_STORAGE = 20 * 60 * 1000;\n\nexport function getStorage({ name, lifetime = DEFAULT_SESSION_STORAGE } : { name : string, lifetime? : number }) : Storage {\n    return inlineMemoize(getStorage, () => {\n        const STORAGE_KEY = `__${ name }_storage__`;\n\n        let accessedStorage;\n\n        function getState<T>(handler : (storage : Object) => T) : T {\n\n            let localStorageEnabled = isLocalStorageEnabled();\n            let storage;\n\n            if (accessedStorage) {\n                storage = accessedStorage;\n            }\n\n            if (!storage && localStorageEnabled) {\n                let rawStorage = window.localStorage.getItem(STORAGE_KEY);\n\n                if (rawStorage) {\n                    storage = JSON.parse(rawStorage);\n                }\n            }\n\n            if (!storage) {\n                storage = getGlobal()[STORAGE_KEY];\n            }\n\n            if (!storage) {\n                storage = {\n                    id: uniqueID()\n                };\n            }\n\n            if (!storage.id) {\n                storage.id = uniqueID();\n            }\n\n            accessedStorage = storage;\n\n            let result = handler(storage);\n\n            if (localStorageEnabled) {\n                window.localStorage.setItem(STORAGE_KEY, JSON.stringify(storage));\n            } else {\n                getGlobal()[STORAGE_KEY] = storage;\n            }\n\n            accessedStorage = null;\n\n            return result;\n        }\n\n        function getID() : string {\n            return getState(storage => storage.id);\n        }\n\n        function getSession<T>(handler : (state : Object) => T) : T {\n            return getState(storage => {\n\n                let session = storage.__session__;\n                let now = Date.now();\n\n                if (session && ((now - session.created) > lifetime)) {\n                    session = null;\n                }\n\n                if (!session) {\n                    session = {\n                        guid:    uniqueID(),\n                        created: now\n                    };\n                }\n\n                storage.__session__ = session;\n\n                return handler(session);\n            });\n        }\n\n        function getSessionState<T>(handler : (state : Object) => T) : T {\n            return getSession(session => {\n                session.state = session.state || {};\n                return handler(session.state);\n            });\n        }\n\n        function getSessionID() : string {\n            return getSession(session => session.guid);\n        }\n\n        return {\n            getState,\n            getID,\n            getSessionState,\n            getSessionID\n        };\n    }, [ { name, lifetime } ]);\n}\n","/* @flow */\n\nimport { noop } from './util';\nimport { getStorage } from './storage';\n\nfunction getBelterExperimentStorage() : Object {\n    return getStorage({ name: 'belter_experiment' });\n}\n\nfunction isEventUnique(name : string) : boolean {\n    return getBelterExperimentStorage().getSessionState(state => {\n        state.loggedBeacons = state.loggedBeacons || [];\n\n        if (state.loggedBeacons.indexOf(name) === -1) {\n            state.loggedBeacons.push(name);\n            return true;\n        }\n\n        return false;\n    });\n}\n\nexport type Experiment = {\n    isEnabled : () => boolean,\n    isDisabled : () => boolean,\n    getTreatment : () => string,\n    log : (string, payload? : { [string] : ?string }) => Experiment,\n    logStart : (payload? : { [string] : ?string }) => Experiment,\n    logComplete : (payload? : { [string] : ?string }) => Experiment\n};\n\nfunction getThrottlePercentile(name : string) : number {\n    return getBelterExperimentStorage().getState(state => {\n        state.throttlePercentiles = state.throttlePercentiles || {};\n        state.throttlePercentiles[name] = state.throttlePercentiles[name] || Math.floor(Math.random() * 100);\n        return state.throttlePercentiles[name];\n    });\n}\n\nconst THROTTLE_GROUP = {\n    TEST:     'test',\n    CONTROL:  'control',\n    THROTTLE: 'throttle'\n};\n\ntype ExperimentOptions = {\n    name : string,\n    sample? : number,\n    logTreatment? : ({ name : string, treatment : string, payload : { [string] : ?string } }) => void,\n    logCheckpoint? : ({ name : string, treatment : string, checkpoint : string, payload : { [string] : ?string } }) => void\n};\n\nexport function experiment({ name, sample = 50, logTreatment = noop, logCheckpoint = noop } : ExperimentOptions) : Experiment {\n\n    let throttle = getThrottlePercentile(name);\n\n    let group;\n\n    if (throttle < sample) {\n        group = THROTTLE_GROUP.TEST;\n    } else if ((sample >= 50) || ((sample <= throttle) && (throttle < (sample * 2)))) {\n        group = THROTTLE_GROUP.CONTROL;\n    } else {\n        group = THROTTLE_GROUP.THROTTLE;\n    }\n\n    let treatment = `${ name }_${ group }`;\n\n    let started = false;\n    let forced = false;\n\n    try {\n        if (window.localStorage && window.localStorage.getItem(name)) {\n            forced = true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    return {\n\n        isEnabled() : boolean {\n            return (group === THROTTLE_GROUP.TEST) || forced;\n        },\n\n        isDisabled() : boolean {\n            return (group !== THROTTLE_GROUP.TEST) && !forced;\n        },\n\n        getTreatment() : string {\n            return treatment;\n        },\n\n        log(checkpoint : string, payload? : { [string] : ?string } = {}) : Experiment {\n            if (!started) {\n                return this;\n            }\n\n            if (isEventUnique(`${ name }_${ treatment }_${ JSON.stringify(payload) }`)) {\n                logTreatment({ name, treatment, payload });\n            }\n\n            if (isEventUnique(`${ name }_${ treatment }_${ checkpoint }_${ JSON.stringify(payload) }`)) {\n                logCheckpoint({ name, treatment, checkpoint, payload });\n            }\n\n            return this;\n        },\n\n        logStart(payload? : { [string] : ?string } = {}) : Experiment {\n            started = true;\n            return this.log(`start`, payload);\n        },\n\n        logComplete(payload? : { [string] : ?string } = {}) : Experiment {\n            return this.log(`complete`, payload);\n        }\n    };\n}\n","/* @flow */\n\nimport { getGlobal } from './util';\n\nexport function getGlobalNameSpace<T : Object>({ name, version = 'latest' } : { name : string, version? : string }) : { get : (string, defValue? : T) => T } {\n\n    let global = getGlobal();\n    let globalKey = `__${ name }__${ version }_global__`;\n\n    let namespace = global[globalKey] = global[globalKey] || {};\n\n    return {\n        get: (key : string, defValue? : T) : T => {\n            // $FlowFixMe\n            defValue = defValue || {};\n            let item = namespace[key] = namespace[key] || defValue;\n            return item;\n        }\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { type SameDomainWindowType } from 'cross-domain-utils/src';\n\ntype RequestOptionsType = {\n    url : string,\n    method? : string,\n    headers? : { [key : string] : string },\n    json? : $ReadOnlyArray<mixed> | Object,\n    data? : { [key : string] : string },\n    body? : string,\n    win? : SameDomainWindowType,\n    timeout? : number\n};\n\ntype ResponseType = {\n    status : number,\n    headers : { [string] : string },\n    body : Object\n};\n\nconst HEADERS = {\n    CONTENT_TYPE: 'content-type',\n    ACCEPT:       'accept'\n};\n\nlet headerBuilders = [];\n\nfunction parseHeaders(rawHeaders : string = '') : { [string] : string } {\n    let result = {};\n    for (let line of rawHeaders.trim().split('\\n')) {\n        let [ key, ...values ] = line.split(':');\n        result[key.toLowerCase()] = values.join(':').trim();\n    }\n    return result;\n}\n\nexport function request({ url, method = 'get', headers = {}, json, data, body, win = window, timeout = 0 } : RequestOptionsType) : ZalgoPromise<ResponseType> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        if ((json && data) || (json && body) || (data && json)) {\n            throw new Error(`Only options.json or options.data or options.body should be passed`);\n        }\n\n        let normalizedHeaders = {};\n\n        for (let key of Object.keys(headers)) {\n            normalizedHeaders[key.toLowerCase()] = headers[key];\n        }\n\n        if (json) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] = normalizedHeaders[HEADERS.CONTENT_TYPE] || 'application/json';\n        } else if (data || body) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] = normalizedHeaders[HEADERS.CONTENT_TYPE] || 'application/x-www-form-urlencoded; charset=utf-8';\n        }\n\n        normalizedHeaders[HEADERS.ACCEPT] = normalizedHeaders[HEADERS.ACCEPT] || 'application/json';\n\n        for (let headerBuilder of headerBuilders) {\n            let builtHeaders = headerBuilder();\n\n            for (let key of Object.keys(builtHeaders)) {\n                normalizedHeaders[key.toLowerCase()] = builtHeaders[key];\n            }\n        }\n\n        let xhr = new win.XMLHttpRequest();\n\n        xhr.addEventListener('load', function xhrLoad() : void {\n\n            let responseHeaders = parseHeaders(this.getAllResponseHeaders());\n\n            if (!this.status) {\n                return reject(new Error(`Request to ${ method.toLowerCase() } ${ url } failed: no response status code.`));\n            }\n            \n            let contentType = responseHeaders['content-type'];\n            let isJSON = contentType && (contentType.indexOf('application/json') === 0 || contentType.indexOf('text/json') === 0);\n            let responseBody = this.responseText;\n\n            try {\n                responseBody = JSON.parse(responseBody);\n            } catch (err) {\n                if (isJSON) {\n                    return reject(new Error(`Invalid json: ${ this.responseText }.`));\n                }\n            }\n\n            let res = {\n                status:  this.status,\n                headers: responseHeaders,\n                body:    responseBody\n            };\n\n            return resolve(res);\n\n        }, false);\n\n        xhr.addEventListener('error', (evt) => {\n            reject(new Error(`Request to ${ method.toLowerCase() } ${ url } failed: ${ evt.toString() }.`));\n        }, false);\n\n        xhr.open(method, url, true);\n\n        for (let key in normalizedHeaders) {\n            if (normalizedHeaders.hasOwnProperty(key)) {\n                xhr.setRequestHeader(key, normalizedHeaders[key]);\n            }\n        }\n\n        if (json) {\n            body = JSON.stringify(json);\n        } else if (data) {\n            body = Object.keys(data).map(key => {\n                return `${ encodeURIComponent(key) }=${ data ? encodeURIComponent(data[key]) : '' }`;\n            }).join('&');\n        }\n\n        xhr.timeout = timeout;\n        xhr.ontimeout = function xhrTimeout() {\n            reject(new Error(`Request to ${ method.toLowerCase() } ${ url } has timed out`));\n        };\n\n        xhr.send(body);\n    });\n}\n\nexport function addHeaderBuilder(method : () => { [string] : string }) {\n    headerBuilders.push(method);\n}\n","/* @flow */\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\ndeclare var __TEST__ : boolean;\n\nexport type JSONPrimitive = string | boolean | number;\nexport type JSONObject = { [string] : JSONPrimitive | JSONObject } | Array<JSONPrimitive | JSONObject>;\nexport type JSONType = JSONObject | JSONPrimitive;\n\nexport type CancelableType = {\n    cancel : () => void\n};\n","/* @flow */\n\nimport { memoize, promisify } from './util';\n\nexport function memoized(target : Object, name : string, descriptor : Object) {\n    descriptor.value = memoize(descriptor.value, { name, thisNamespace: true });\n}\n\nexport function promise(target : Object, name : string, descriptor : Object) {\n    descriptor.value = promisify(descriptor.value, { name });\n}\n","/* @flow */\n\nexport function isPerc(str : string) : boolean {\n    return typeof str === 'string' && (/^[0-9]+%$/).test(str);\n}\n\nexport function isPx(str : string) : boolean {\n    return typeof str === 'string' && (/^[0-9]+px$/).test(str);\n}\n\nexport function toNum(val : string | number) : number {\n\n    if (typeof val === 'number') {\n        return val;\n    }\n\n    let match = val.match(/^([0-9]+)(px|%)$/);\n\n    if (!match) {\n        throw new Error(`Could not match css value from ${ val }`);\n    }\n\n    return parseInt(match[1], 10);\n}\n\nexport function toPx(val : number | string) : string {\n    return `${ toNum(val) }px`;\n}\n\nexport function toCSS(val : number | string) : string {\n\n    if (typeof val === 'number') {\n        return toPx(val);\n    }\n\n    return isPerc(val) ? val : toPx(val);\n}\n\nexport function percOf(num : number, perc : string) : number {\n    return parseInt(num * toNum(perc)  / 100, 10);\n}\n\nexport function normalizeDimension(dim : string | number, max : number) : number {\n    if (typeof dim === 'number') {\n        return dim;\n    } else if (isPerc(dim)) {\n        return percOf(max, dim);\n    } else if (isPx(dim)) {\n        return toNum(dim);\n    } else {\n        throw new Error(`Can not normalize dimension: ${ dim }`);\n    }\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nimport { noop, tryCatch, removeFromArray } from './util';\n\ntype Prom<X> = Promise<X> | ZalgoPromise<X>; // eslint-disable-line no-restricted-globals, promise/no-native\n\ntype Handler = <T, A : $ReadOnlyArray<mixed>>(name : string, fn? : (...args : A) => T) => (...args : A) => T; // eslint-disable-line no-undef\ntype Wrapper<T> = ({ expect : Handler, avoid : Handler, expectError : Handler, error : Handler }) => (Prom<T> | void);\n\nexport function wrapPromise<T>(method : Wrapper<T>, { timeout = 5000 } : { timeout? : number } = {}) : ZalgoPromise<void> {\n    let expected : Array<string> = [];\n    let promises : Array<ZalgoPromise<*>> = [];\n\n    let timer = setTimeout(() => {\n        if (expected.length) {\n            promises.push(ZalgoPromise.asyncReject(new Error(`Expected ${ expected[0] } to be called`)));\n        }\n    }, timeout);\n\n    let expect : Handler = (name, fn = noop) => {\n        expected.push(name);\n        \n        // $FlowFixMe\n        return function expectWrapper(...args) : * {\n            removeFromArray(expected, name);\n\n            // $FlowFixMe\n            let { result, error } = tryCatch(() => fn.call(this, ...args));\n\n            if (error) {\n                promises.push(ZalgoPromise.asyncReject(error));\n                throw error;\n            }\n\n            promises.push(ZalgoPromise.resolve(result));\n            return result;\n        };\n    };\n\n    let avoid : Handler = (name : string, fn = noop) => {\n\n        // $FlowFixMe\n        return function avoidWrapper(...args) : * {\n            promises.push(ZalgoPromise.asyncReject(new Error(`Expected ${ name } to not be called`)));\n            // $FlowFixMe\n            return fn.call(this, ...args);\n        };\n    };\n\n    let expectError : Handler = (name, fn = noop) => {\n        expected.push(name);\n\n        // $FlowFixMe\n        return function expectErrorWrapper(...args) : * {\n            removeFromArray(expected, name);\n\n            // $FlowFixMe\n            let { result, error } = tryCatch(() => fn.call(this, ...args));\n\n            if (error) {\n                throw error;\n            }\n\n            promises.push(ZalgoPromise.resolve(result).then(() => {\n                throw new Error(`Expected ${ name } to throw an error`);\n            }, noop));\n            return result;\n        };\n    };\n\n    promises.push(ZalgoPromise.try(() => method({ expect, avoid, expectError, error: avoid })));\n\n    let drain = () => {\n        return ZalgoPromise.try(() => {\n            if (promises.length) {\n                return promises.pop();\n            }\n        }).then(() => {\n            if (promises.length) {\n                return drain();\n            }\n            if (expected.length) {\n                return ZalgoPromise.delay(10).then(drain);\n            }\n        });\n    };\n\n    return drain().then(() => {\n        clearTimeout(timer);\n    });\n}\n","/* @flow */\n\nexport * from './device';\nexport * from './dom';\nexport * from './experiment';\nexport * from './global';\nexport * from './storage';\nexport * from './util';\nexport * from './http';\nexport * from './types';\nexport * from './decorators';\nexport * from './css';\nexport * from './test';\n","/* @flow */\n\nexport const BRIDGE_TIMEOUT = 5000;\nexport const CHILD_WINDOW_TIMEOUT = 5000;\n\nexport const ACK_TIMEOUT = 2000;\nexport const ACK_TIMEOUT_KNOWN = 10000;\nexport const RES_TIMEOUT = __TEST__ ? 2000 : -1;\nexport const RESPONSE_CYCLE_TIME = 500;\n","/* @flow */\n\nexport const MESSAGE_TYPE = {\n    REQUEST:  ('postrobot_message_request' : 'postrobot_message_request'),\n    RESPONSE: ('postrobot_message_response' : 'postrobot_message_response'),\n    ACK:      ('postrobot_message_ack' : 'postrobot_message_ack')\n};\n\nexport const MESSAGE_ACK = {\n    SUCCESS: ('success' : 'success'),\n    ERROR:   ('error' : 'error')\n};\n\nexport const MESSAGE_NAME = {\n    METHOD:      ('postrobot_method' : 'postrobot_method'),\n    HELLO:       ('postrobot_hello' : 'postrobot_hello'),\n    OPEN_TUNNEL: ('postrobot_open_tunnel' : 'postrobot_open_tunnel')\n};\n\nexport const SEND_STRATEGY = {\n    POST_MESSAGE: ('postrobot_post_message' : 'postrobot_post_message'),\n    BRIDGE:       ('postrobot_bridge' : 'postrobot_bridge'),\n    GLOBAL:       ('postrobot_global' : 'postrobot_global')\n};\n\nexport const BRIDGE_NAME_PREFIX = '__postrobot_bridge__';\nexport const POSTROBOT_PROXY =    '__postrobot_proxy__';\n\nexport const WILDCARD = '*';\n\nexport const SERIALIZATION_TYPE = {\n    CROSS_DOMAIN_ZALGO_PROMISE: ('cross_domain_zalgo_promise' : 'cross_domain_zalgo_promise'),\n    CROSS_DOMAIN_FUNCTION:      ('cross_domain_function' : 'cross_domain_function'),\n    CROSS_DOMAIN_WINDOW:        ('cross_domain_window' : 'cross_domain_window')\n};\n","/* @flow */\n\nexport * from './config';\nexport * from './constants';\n","/* @flow */\n\nimport { type CrossDomainWindowType, type SameDomainWindowType } from 'cross-domain-utils/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\nimport { getOrSet } from 'belter/src';\n\nexport function getGlobal(win : SameDomainWindowType = window) : Object {\n    if (win !== window) {\n        return win[__POST_ROBOT__.__GLOBAL_KEY__];\n    }\n    const global : Object = win[__POST_ROBOT__.__GLOBAL_KEY__] = win[__POST_ROBOT__.__GLOBAL_KEY__] || {};\n    return global;\n}\n\nexport function deleteGlobal() {\n    delete window[__POST_ROBOT__.__GLOBAL_KEY__];\n}\n\ntype ObjectGetter = () => Object;\nconst getObj : ObjectGetter = () => ({});\n\ntype GetOrSet<T> = ((string, () => T) => T) & ((string, () => void) => void);\n\ntype GlobalStore<T> = {|\n    get : ((string, T) => T) & ((string, void) => T | void),\n    set : (string, T) => T,\n    has : (string) => boolean,\n    del : (string) => void,\n    getOrSet : GetOrSet<T>,\n    reset : () => void,\n    keys : () => $ReadOnlyArray<string>\n|};\n\nexport function globalStore<T : mixed>(key? : string = 'store', defStore? : ObjectGetter = getObj) : GlobalStore<T> {\n    return getOrSet(getGlobal(), key, () => {\n        let store = defStore();\n\n        return {\n            has: (storeKey) => {\n                return store.hasOwnProperty(storeKey);\n            },\n            get: (storeKey, defVal) => {\n                // $FlowFixMe\n                return store.hasOwnProperty(storeKey) ? store[storeKey] : defVal;\n            },\n            set: (storeKey, val) => {\n                store[storeKey] = val;\n                return val;\n            },\n            del: (storeKey) => {\n                delete store[storeKey];\n            },\n            getOrSet: (storeKey, getter) => {\n                // $FlowFixMe\n                return getOrSet(store, storeKey, getter);\n            },\n            reset: () => {\n                store = defStore();\n            },\n            keys: () => {\n                return Object.keys(store);\n            }\n        };\n    });\n}\n\nexport class WildCard {}\n\nexport function getWildcard() : WildCard {\n    const global = getGlobal();\n    global.WINDOW_WILDCARD = global.WINDOW_WILDCARD || new WildCard();\n    return global.WINDOW_WILDCARD;\n}\n\ntype WindowStore<T> = {|\n    get : ((CrossDomainWindowType | WildCard, T) => T) & ((CrossDomainWindowType | WildCard, void) => T | void),\n    set : (CrossDomainWindowType | WildCard, T) => T,\n    has : (CrossDomainWindowType | WildCard) => boolean,\n    del : (CrossDomainWindowType | WildCard) => void,\n    getOrSet : (CrossDomainWindowType | WildCard, () => T) => T\n|};\n\nexport function windowStore<T>(key? : string = 'store', defStore? : ObjectGetter = getObj) : WindowStore<T> {\n    return globalStore('windowStore').getOrSet(key, () => {\n        const winStore = new WeakMap();\n\n        const getStore = (win : CrossDomainWindowType | WildCard) : ObjectGetter => {\n            return winStore.getOrSet(win, defStore);\n        };\n    \n        return {\n            has: (win) => {\n                const store = getStore(win);\n                return store.hasOwnProperty(key);\n            },\n            get: (win, defVal) => {\n                const store = getStore(win);\n                // $FlowFixMe\n                return store.hasOwnProperty(key) ? store[key] : defVal;\n            },\n            set: (win, val) => {\n                const store = getStore(win);\n                store[key] = val;\n                return val;\n            },\n            del: (win) => {\n                const store = getStore(win);\n                delete store[key];\n            },\n            getOrSet: (win, getter) => {\n                const store = getStore(win);\n                return getOrSet(store, key, getter);\n            }\n        };\n    });\n}\n","/* @flow */\n\nimport { getAncestor, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { noop, uniqueID } from 'belter/src';\n\nimport { MESSAGE_NAME, WILDCARD } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, CancelableType } from '../types';\n\nfunction getInstanceID() : string {\n    return globalStore('instance').getOrSet('instanceID', uniqueID);\n}\n\nfunction getHelloPromise(win : CrossDomainWindowType) : ZalgoPromise<{ domain : string }> {\n    const helloPromises = windowStore('helloPromises');\n    return helloPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nfunction resolveHelloPromise(win : CrossDomainWindowType, { domain }) : ZalgoPromise<{ domain : string }> {\n    const helloPromises = windowStore('helloPromises');\n    const existingPromise = helloPromises.get(win);\n    if (existingPromise) {\n        existingPromise.resolve({ domain });\n    }\n    const newPromise = ZalgoPromise.resolve({ domain });\n    helloPromises.set(win, newPromise);\n    return newPromise;\n}\n\nfunction listenForHello({ on } : { on : OnType }) : CancelableType {\n    return on(MESSAGE_NAME.HELLO, { domain: WILDCARD }, ({ source, origin }) => {\n        resolveHelloPromise(source, { domain: origin });\n        return { instanceID: getInstanceID() };\n    });\n}\n\nexport function sayHello(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<{ win : CrossDomainWindowType, domain : string, instanceID : string }> {\n    return send(win, MESSAGE_NAME.HELLO, { instanceID: getInstanceID() }, { domain: WILDCARD, timeout: -1 })\n        .then(({ origin, data: { instanceID } }) => {\n            resolveHelloPromise(win, { domain: origin });\n            return { win, domain: origin, instanceID };\n        });\n}\n\nexport function getWindowInstanceID(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<string> {\n    return windowStore('windowInstanceIDPromises').getOrSet(win, () => {\n        return sayHello(win, { send }).then(({ instanceID }) => instanceID);\n    });\n}\n\nexport function initHello({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore('builtinListeners').getOrSet('helloListener', () => {\n        const listener = listenForHello({ on });\n\n        const parent = getAncestor();\n        if (parent) {\n            sayHello(parent, { send }).catch(noop);\n        }\n\n        return listener;\n    });\n}\n\nexport function awaitWindowHello(win : CrossDomainWindowType, timeout : number = 5000, name : string = 'Window') : ZalgoPromise<{ domain : string }> {\n    let promise = getHelloPromise(win);\n\n    if (timeout !== -1) {\n        promise = promise.timeout(timeout, new Error(`${ name } did not load after ${ timeout }ms`));\n    }\n\n    return promise;\n}\n","/* @flow */\n\nimport { getUserAgent } from 'cross-domain-utils/src';\n\nexport function needsGlobalMessagingForBrowser() : boolean {\n\n    if (getUserAgent(window).match(/MSIE|rv:11|trident|edge\\/12|edge\\/13/i)) {\n        return true;\n    }\n\n    return false;\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport { windowStore } from '../global';\n\nexport function markWindowKnown(win : CrossDomainWindowType) {\n    const knownWindows = windowStore('knownWindows');\n    knownWindows.set(win, true);\n}\n\nexport function isWindowKnown(win : CrossDomainWindowType) : boolean {\n    const knownWindows = windowStore('knownWindows');\n    return knownWindows.get(win, false);\n}\n","/* @flow */\n\nexport * from './hello';\nexport * from './compat';\nexport * from './windows';\n","/* @flow */\n\nexport const TYPE = {\n    FUNCTION:  ('function' : 'function'),\n    ERROR:     ('error' : 'error'),\n    PROMISE:   ('promise' : 'promise'),\n    REGEX:     ('regex' : 'regex'),\n    DATE:      ('date' : 'date'),\n    ARRAY:     ('array' : 'array'),\n    OBJECT:    ('object' : 'object'),\n    STRING:    ('string' : 'string'),\n    NUMBER:    ('number' : 'number'),\n    BOOLEAN:   ('boolean' : 'boolean'),\n    NULL:      ('null' : 'null'),\n    UNDEFINED: ('undefined' : 'undefined')\n};\n","/* @flow */\n\nimport { TYPE } from './constants';\nimport type { CustomSerializedType } from './types';\n\nexport function isSerializedType(item : mixed) : boolean {\n    return (typeof item === 'object' && item !== null && typeof item.__type__ === 'string');\n}\n\nexport function determineType(val : mixed) : $Values<typeof TYPE> | void {\n    if (typeof val === 'undefined') {\n        return TYPE.UNDEFINED;\n    }\n\n    if (val === null) {\n        return TYPE.NULL;\n    }\n\n    if (Array.isArray(val)) {\n        return TYPE.ARRAY;\n    }\n\n    if (typeof val === 'function') {\n        return TYPE.FUNCTION;\n    }\n\n    if (typeof val === 'object') {\n\n        if (val instanceof Error) {\n            return TYPE.ERROR;\n        }\n\n        if (typeof val.then === 'function') {\n            return TYPE.PROMISE;\n        }\n\n        if (Object.prototype.toString.call(val) === '[object RegExp]') {\n            return TYPE.REGEX;\n        }\n\n        if (Object.prototype.toString.call(val) === '[object Date]') {\n            return TYPE.DATE;\n        }\n\n        return TYPE.OBJECT;\n    }\n\n    if (typeof val === 'string') {\n        return TYPE.STRING;\n    }\n\n    if (typeof val === 'number') {\n        return TYPE.NUMBER;\n    }\n\n    if (typeof val === 'boolean') {\n        return TYPE.BOOLEAN;\n    }\n}\n\nexport function serializeType<T : string, V : mixed>(type : T, val : V) : CustomSerializedType<T, V> {\n    return {\n        __type__: type,\n        __val__:  val\n    };\n}\n","/* @flow */\n\nexport type SerializedArray<T : mixed = mixed> = $ReadOnlyArray<T>;\n\nexport function serializeArray<T : mixed>(val : $ReadOnlyArray<T>) : SerializedArray<T> {\n    return val;\n}\n\nexport function deserializeArray<T : mixed>(val : SerializedArray<T>) : $ReadOnlyArray<T> {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedBoolean = boolean;\n\nexport function serializeBoolean(val : boolean) : SerializedBoolean {\n    return val;\n}\n\nexport function deserializeBoolean(val : SerializedBoolean) : boolean {\n    return val;\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedDate = string;\n\nexport function serializeDate(val : Date) : NativeSerializedType<typeof TYPE.DATE, SerializedDate> {\n    return serializeType(TYPE.DATE, val.toJSON());\n}\n\nexport function deserializeDate(val : string) : Date {\n    return new Date(val);\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedError = {|\n    message : string,\n    stack : string,\n    code : string | number | void\n|};\n\n// $FlowFixMe\nexport function serializeError({ message, stack, code } : Error) : NativeSerializedType<typeof TYPE.ERROR, SerializedError> {\n    return serializeType(TYPE.ERROR, { message, stack, code });\n}\n\nexport function deserializeError({ message, stack, code } : SerializedError) : Error {\n    const error = new Error(message);\n    // $FlowFixMe\n    error.code = code;\n    error.stack = `${ stack }\\n\\n${ error.stack }`;\n    return error;\n}\n","/* @flow */\n\nexport type SerializedFunction = void;\n\nexport function serializeFunction() : SerializedFunction {\n    // pass\n}\n\nexport function deserializeFunction() {\n    throw new Error(`Function serialization is not implemented; nothing to deserialize`);\n}\n","/* @flow */\n\nexport type SerializedNumber = number;\n\nexport function serializeNumber(val : number) : SerializedNumber {\n    return val;\n}\n\nexport function deserializeNumber(val : SerializedNumber) : number {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedObject = Object;\n\nexport function serializeObject(val : Object) : SerializedObject {\n    return val;\n}\n\nexport function deserializeObject(val : SerializedObject) : Object {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedPromise = void;\n\nexport function serializePromise() : SerializedPromise {\n    // pass\n}\n\nexport function deserializePromise() {\n    throw new Error(`Promise serialization is not implemented; nothing to deserialize`);\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedRegex = string;\n\nexport function serializeRegex(val : RegExp) : NativeSerializedType<typeof TYPE.REGEX, SerializedRegex> {\n    return serializeType(TYPE.REGEX, val.source);\n}\n\nexport function deserializeRegex(val : string) : RegExp {\n    // eslint-disable-next-line security/detect-non-literal-regexp\n    return new RegExp(val);\n}\n","/* @flow */\n\nexport type SerializedString = string;\n\nexport function serializeString(val : string) : SerializedString {\n    return val;\n}\n\nexport function deserializeString(val : SerializedString) : string {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedNull = null;\n\nexport function serializeNull(val : null) : SerializedNull {\n    return val;\n}\n\nexport function deserializeNull(val : SerializedNull) : null {\n    return val;\n}\n","/* @flow */\n\nexport * from './array';\nexport * from './boolean';\nexport * from './date';\nexport * from './error';\nexport * from './function';\nexport * from './number';\nexport * from './object';\nexport * from './promise';\nexport * from './regex';\nexport * from './string';\nexport * from './null';\n","/* @flow */\n\nimport { TYPE } from './constants';\nimport type { Thenable, CustomSerializedType, NativeSerializedType } from './types';\nimport { determineType, isSerializedType } from './common';\nimport {\n    serializeFunction,\n    serializeError, type SerializedError,\n    serializePromise,\n    serializeRegex, type SerializedRegex,\n    serializeDate, type SerializedDate,\n    serializeArray,\n    serializeObject,\n    serializeString,\n    serializeNumber,\n    serializeBoolean,\n    serializeNull\n} from './serializers';\n\ntype NativeSerializer<V : mixed, S : mixed, T : $Values<typeof TYPE>> = (value : V, key : string) => NativeSerializedType<T, S>;\ntype CustomSerializer<V : mixed, S : mixed, T : string> = (value : V, key : string) => CustomSerializedType<T, S>;\ntype PrimitiveSerializer<V : mixed, S : mixed> = (value : V, key : string) => S;\ntype CustomOrPrimitiveSerializer<V : mixed, T : string> = CustomSerializer<V, *, T> | PrimitiveSerializer<V, *>;\ntype NativeOrCustomOrPrimitiveSerializer<V : mixed, S : mixed, T : string> = NativeSerializer<V, S, T> | CustomOrPrimitiveSerializer<V, T>;\n\ntype Serializers = {|\n    function? : CustomOrPrimitiveSerializer<Function, typeof TYPE.FUNCTION>,\n    error? : NativeOrCustomOrPrimitiveSerializer<Error, SerializedError, typeof TYPE.ERROR>,\n    promise? : CustomOrPrimitiveSerializer<Thenable, typeof TYPE.PROMISE>,\n    regex? : NativeOrCustomOrPrimitiveSerializer<RegExp, SerializedRegex, typeof TYPE.REGEX>,\n    date? : NativeOrCustomOrPrimitiveSerializer<Date, SerializedDate, typeof TYPE.DATE>,\n    array? : CustomOrPrimitiveSerializer<$ReadOnlyArray<mixed>, typeof TYPE.ARRAY>,\n    object? : CustomOrPrimitiveSerializer<Object, typeof TYPE.OBJECT>,\n    string? : CustomOrPrimitiveSerializer<string, typeof TYPE.STRING>,\n    number? : CustomOrPrimitiveSerializer<number, typeof TYPE.NUMBER>,\n    boolean? : CustomOrPrimitiveSerializer<boolean, typeof TYPE.BOOLEAN>,\n    null? : CustomOrPrimitiveSerializer<null, typeof TYPE.NULL>\n|};\n\nconst SERIALIZER : Serializers = {\n    [ TYPE.FUNCTION ]:  serializeFunction,\n    [ TYPE.ERROR ]:     serializeError,\n    [ TYPE.PROMISE ]:   serializePromise,\n    [ TYPE.REGEX ]:     serializeRegex,\n    [ TYPE.DATE ]:      serializeDate,\n    [ TYPE.ARRAY ]:     serializeArray,\n    [ TYPE.OBJECT ]:    serializeObject,\n    [ TYPE.STRING ]:    serializeString,\n    [ TYPE.NUMBER ]:    serializeNumber,\n    [ TYPE.BOOLEAN ]:   serializeBoolean,\n    [ TYPE.NULL ]:      serializeNull\n};\n\n// $FlowFixMe\nconst defaultSerializers : Serializers = {};\n\nexport function serialize<T : mixed>(obj : T, serializers : Serializers = defaultSerializers) : string {\n\n    function replacer(key) : ?mixed {\n        const val = this[key];\n\n        if (isSerializedType(this)) {\n            return val;\n        }\n        \n        const type = determineType(val);\n\n        if (!type) {\n            return val;\n        }\n\n        // $FlowFixMe\n        const serializer = serializers[type] || SERIALIZER[type];\n\n        if (!serializer) {\n            return val;\n        }\n\n        return serializer(val, key);\n    }\n\n    const result = JSON.stringify(obj, replacer);\n\n    if (typeof result === 'undefined') {\n        return TYPE.UNDEFINED;\n    }\n\n    return result;\n}\n","/* @flow */\n\nimport type { Thenable } from './types';\nimport { TYPE } from './constants';\nimport { determineType, isSerializedType } from './common';\nimport {\n    deserializeFunction,\n    deserializeError, type SerializedError,\n    deserializePromise,\n    deserializeRegex, type SerializedRegex,\n    deserializeDate, type SerializedDate,\n    deserializeArray,\n    deserializeObject,\n    deserializeString,\n    deserializeNumber,\n    deserializeBoolean,\n    deserializeNull\n} from './serializers';\n\ntype Deserializer<V : mixed, S : mixed> = (serializedValue : S, key : string) => V;\ntype PrimitiveDeserializer<V, S = V> = (serializedValue : S, key : string) => V;\n\ntype Deserializers = {\n    function? : Deserializer<Function, *>,\n    error? : Deserializer<Error, SerializedError>,\n    promise? : Deserializer<Thenable, *>,\n    regex? : Deserializer<RegExp, SerializedRegex>,\n    date? : Deserializer<Date, SerializedDate>,\n    array? : PrimitiveDeserializer<$ReadOnlyArray<mixed>>,\n    object? : PrimitiveDeserializer<Object>,\n    string? : PrimitiveDeserializer<string>,\n    number? : PrimitiveDeserializer<number>,\n    boolean? : PrimitiveDeserializer<boolean>,\n    null? : PrimitiveDeserializer<null>,\n    [string] : Deserializer<mixed, *>\n};\n\n// $FlowFixMe\nconst DESERIALIZER : Deserializers = {\n    [ TYPE.FUNCTION ]:  deserializeFunction,\n    [ TYPE.ERROR ]:     deserializeError,\n    [ TYPE.PROMISE ]:   deserializePromise,\n    [ TYPE.REGEX ]:     deserializeRegex,\n    [ TYPE.DATE ]:      deserializeDate,\n    [ TYPE.ARRAY ]:     deserializeArray,\n    [ TYPE.OBJECT ]:    deserializeObject,\n    [ TYPE.STRING ]:    deserializeString,\n    [ TYPE.NUMBER ]:    deserializeNumber,\n    [ TYPE.BOOLEAN ]:   deserializeBoolean,\n    [ TYPE.NULL ]:      deserializeNull\n};\n\n// $FlowFixMe\nconst defaultDeserializers : Deserializers = {};\n\nexport function deserialize<T : mixed | null | void>(str : string, deserializers : Deserializers = defaultDeserializers) : T {\n    if (str === TYPE.UNDEFINED) {\n        // $FlowFixMe\n        return;\n    }\n\n    function replacer(key, val) : ?mixed {\n        if (isSerializedType(this)) {\n            return val;\n        }\n\n        let type;\n        let value;\n\n        if (isSerializedType(val)) {\n            type = val.__type__;\n            value = val.__val__;\n        } else {\n            type = determineType(val);\n            value = val;\n        }\n\n        if (!type) {\n            return value;\n        }\n\n        // $FlowFixMe\n        const deserializer = deserializers[type] || DESERIALIZER[type];\n\n        if (!deserializer) {\n            return value;\n        }\n\n        return deserializer(value, key);\n    }\n\n    return JSON.parse(str, replacer);\n}\n","/* @flow */\n\nimport { TYPE } from './constants';\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type Thenable = {\n    then : (onSuccess? : (val? : mixed) => mixed, onError? : (err? : mixed) => mixed) => Thenable,\n    catch : (onError? : (err? : mixed) => mixed) => Thenable\n};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type NativeSerializedType<T : $Values<typeof TYPE>, V : mixed> = {\n    __type__ : T,\n    __val__ : V\n};\n\nexport type CustomSerializedType<T : string, V : mixed> = {|\n    __type__ : T,\n    __val__ : V\n|};\n","/* @flow */\n\nexport * from './serialize';\nexport * from './deserialize';\nexport * from './serializers';\nexport * from './constants';\nexport * from './common';\nexport * from './types';\n","/* @flow */\n\nimport { type ZalgoPromise } from 'zalgo-promise/src';\nimport { getParent, isWindowClosed, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop, uniqueID } from 'belter/src';\n\nimport { MESSAGE_NAME, WILDCARD } from '../conf';\nimport { getGlobal, globalStore } from '../global';\nimport type { SendType, ResponseMessageEvent } from '../types';\n\nfunction cleanTunnelWindows() {\n    const tunnelWindows = globalStore('tunnelWindows');\n\n    for (const key of tunnelWindows.keys()) {\n        const tunnelWindow = tunnelWindows[key];\n\n        try {\n            noop(tunnelWindow.source);\n        } catch (err) {\n            tunnelWindows.del(key);\n            continue;\n        }\n\n        if (isWindowClosed(tunnelWindow.source)) {\n            tunnelWindows.del(key);\n        }\n    }\n}\n\ntype TunnelWindowDataType = {|\n    name : string,\n    source : CrossDomainWindowType,\n    canary : () => void,\n    sendMessage : (message : string) => void\n|};\n\nfunction addTunnelWindow({ name, source, canary, sendMessage } : TunnelWindowDataType) : string {\n    cleanTunnelWindows();\n    const id = uniqueID();\n    const tunnelWindows = globalStore('tunnelWindows');\n    tunnelWindows.set(id, { name, source, canary, sendMessage });\n    return id;\n}\n\nexport function setupOpenTunnelToParent({ send } : { send : SendType }) {\n    getGlobal(window).openTunnelToParent = function openTunnelToParent({ name, source, canary, sendMessage } : TunnelWindowDataType) : ZalgoPromise<ResponseMessageEvent> {\n\n        const tunnelWindows = globalStore('tunnelWindows');\n        const parentWindow = getParent(window);\n    \n        if (!parentWindow) {\n            throw new Error(`No parent window found to open tunnel to`);\n        }\n    \n        const id = addTunnelWindow({ name, source, canary, sendMessage });\n    \n        return send(parentWindow, MESSAGE_NAME.OPEN_TUNNEL, {\n    \n            name,\n    \n            sendMessage() {\n    \n                const tunnelWindow = tunnelWindows.get(id);\n    \n                try {\n                    // IE gets antsy if you try to even reference a closed window\n                    noop(tunnelWindow && tunnelWindow.source);\n                } catch (err) {\n                    tunnelWindows.del(id);\n                    return;\n                }\n    \n                if (!tunnelWindow || !tunnelWindow.source || isWindowClosed(tunnelWindow.source)) {\n                    return;\n                }\n    \n                try {\n                    tunnelWindow.canary();\n                } catch (err) {\n                    return;\n                }\n    \n                tunnelWindow.sendMessage.apply(this, arguments);\n            }\n    \n        }, { domain: WILDCARD });\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, isSameDomain, isOpener, isSameTopWindow, matchDomain, getUserAgent, getDomainFromUrl, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { BRIDGE_NAME_PREFIX } from '../conf';\nimport { windowStore } from '../global';\n\nexport function needsBridgeForBrowser() : boolean {\n\n    if (getUserAgent(window).match(/MSIE|trident|edge\\/12|edge\\/13/i)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForWin(win : CrossDomainWindowType) : boolean {\n\n    if (!isSameTopWindow(window, win)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForDomain(domain : ?string, win : ?CrossDomainWindowType) : boolean {\n\n    if (domain) {\n        if (getDomain() !== getDomainFromUrl(domain)) {\n            return true;\n        }\n    } else if (win) {\n        if (!isSameDomain(win))  {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function needsBridge({ win, domain } : { win? : CrossDomainWindowType, domain? : string }) : boolean {\n\n    if (!needsBridgeForBrowser()) {\n        return false;\n    }\n\n    if (domain && !needsBridgeForDomain(domain, win)) {\n        return false;\n    }\n\n    if (win && !needsBridgeForWin(win)) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function getBridgeName(domain : string) : string {\n\n    domain = domain || getDomainFromUrl(domain);\n\n    const sanitizedDomain = domain.replace(/[^a-zA-Z0-9]+/g, '_');\n\n    const id = `${ BRIDGE_NAME_PREFIX }_${ sanitizedDomain }`;\n\n    return id;\n}\n\nexport function isBridge() : boolean {\n    return Boolean(window.name && window.name === getBridgeName(getDomain()));\n}\n\nexport const documentBodyReady = new ZalgoPromise(resolve => {\n\n    if (window.document && window.document.body) {\n        return resolve(window.document.body);\n    }\n\n    const interval = setInterval(() => {\n        if (window.document && window.document.body) {\n            clearInterval(interval);\n            return resolve(window.document.body);\n        }\n    }, 10);\n});\n\nexport function registerRemoteWindow(win : CrossDomainWindowType) {\n    const remoteWindowPromises = windowStore('remoteWindowPromises');\n    remoteWindowPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nexport function findRemoteWindow(win : CrossDomainWindowType) : ZalgoPromise<(remoteWin : CrossDomainWindowType, message : string, remoteDomain : string) => void> {\n    const remoteWindowPromises = windowStore('remoteWindowPromises');\n    const remoteWinPromise = remoteWindowPromises.get(win);\n\n    if (!remoteWinPromise) {\n        throw new Error(`Remote window promise not found`);\n    }\n\n    return remoteWinPromise;\n}\n\ntype SendMessageType = {|\n    (string) : void,\n    fireAndForget : (string) => void\n|};\n\nexport function registerRemoteSendMessage(win : CrossDomainWindowType, domain : string, sendMessage : SendMessageType) {\n    const sendMessageWrapper = (remoteWin : CrossDomainWindowType, remoteDomain : string, message : string) => {\n        if (remoteWin !== win) {\n            throw new Error(`Remote window does not match window`);\n        }\n\n        if (!matchDomain(remoteDomain, domain)) {\n            throw new Error(`Remote domain ${ remoteDomain } does not match domain ${ domain }`);\n        }\n\n        sendMessage.fireAndForget(message);\n    };\n\n    findRemoteWindow(win).resolve(sendMessageWrapper);\n}\n\nexport function rejectRemoteSendMessage(win : CrossDomainWindowType, err : Error) {\n    findRemoteWindow(win).reject(err).catch(noop);\n}\n\nexport function sendBridgeMessage(win : CrossDomainWindowType, domain : string, message : string) : ZalgoPromise<void> {\n\n    const messagingChild  = isOpener(window, win);\n    const messagingParent = isOpener(win, window);\n\n    if (!messagingChild && !messagingParent) {\n        throw new Error(`Can only send messages to and from parent and popup windows`);\n    }\n\n    return findRemoteWindow(win).then(sendMessage => {\n        return sendMessage(win, domain, message);\n    });\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isSameDomain, getOpener, getDomain, getFrameByName, assertSameDomain, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { getGlobal, windowStore } from '../global';\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { needsBridge, registerRemoteWindow, rejectRemoteSendMessage, registerRemoteSendMessage, getBridgeName } from './common';\n\nfunction awaitRemoteBridgeForWindow (win : CrossDomainWindowType) : ZalgoPromise<?CrossDomainWindowType> {\n    return windowStore('remoteBridgeAwaiters').getOrSet(win, () => {\n        return ZalgoPromise.try(() => {\n            const frame = getFrameByName(win, getBridgeName(getDomain()));\n\n            if (!frame) {\n                return;\n            }\n\n            if (isSameDomain(frame) && getGlobal(assertSameDomain(frame))) {\n                return frame;\n            }\n\n            return new ZalgoPromise(resolve => {\n\n                let interval;\n                let timeout; // eslint-disable-line prefer-const\n\n                interval = setInterval(() => { // eslint-disable-line prefer-const\n                    if (frame && isSameDomain(frame) && getGlobal(assertSameDomain(frame))) {\n                        clearInterval(interval);\n                        clearTimeout(timeout);\n                        return resolve(frame);\n                    }\n                }, 100);\n\n                timeout = setTimeout(() => {\n                    clearInterval(interval);\n                    return resolve();\n                }, 2000);\n            });\n        });\n    });\n}\n\nexport function openTunnelToOpener({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) : ZalgoPromise<void> {\n    return ZalgoPromise.try(() => {\n        const opener = getOpener(window);\n        \n        if (!opener || !needsBridge({ win: opener })) {\n            return;\n        }\n\n        registerRemoteWindow(opener);\n\n        return awaitRemoteBridgeForWindow(opener).then(bridge => {\n\n            if (!bridge) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: no bridge found in opener`));\n            }\n\n            if (!window.name) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: window does not have a name`));\n            }\n\n            return getGlobal(assertSameDomain(bridge)).openTunnelToParent({\n\n                name: window.name,\n\n                source: window,\n\n                canary() {\n                    // pass\n                },\n\n                sendMessage(message) {\n\n                    try {\n                        noop(window);\n                    } catch (err) {\n                        return;\n                    }\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    try {\n                        receiveMessage({\n                            data:   message,\n                            origin: this.origin,\n                            source: this.source\n                        }, { on, send });\n                    } catch (err) {\n                        ZalgoPromise.reject(err);\n                    }\n                }\n\n            }).then(({ source, origin, data }) => {\n\n                if (source !== opener) {\n                    throw new Error(`Source does not match opener`);\n                }\n\n                registerRemoteSendMessage(source, origin, data.sendMessage);\n\n            }).catch(err => {\n\n                rejectRemoteSendMessage(opener, err);\n                throw err;\n            });\n        });\n    });\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, getFrameByName, isWindowClosed, getDomainFromUrl, normalizeMockUrl, type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport { BRIDGE_TIMEOUT, MESSAGE_NAME } from '../conf';\nimport { awaitWindowHello } from '../lib';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { getBridgeName, documentBodyReady, registerRemoteSendMessage, registerRemoteWindow } from './common';\n\nexport function listenForOpenTunnel({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) {\n    const popupWindowsByName = globalStore('popupWindowsByName');\n\n    on(MESSAGE_NAME.OPEN_TUNNEL, ({ source, origin, data }) => {\n        const bridgePromise = globalStore('bridges').get(origin);\n\n        if (!bridgePromise) {\n            throw new Error(`Can not find bridge promise for domain ${ origin }`);\n        }\n\n        return bridgePromise.then(bridge => {\n            if (source !== bridge) {\n                throw new Error(`Message source does not matched registered bridge for domain ${ origin }`);\n            }\n\n            if (!data.name) {\n                throw new Error(`Register window expected to be passed window name`);\n            }\n\n            if (!data.sendMessage) {\n                throw new Error(`Register window expected to be passed sendMessage method`);\n            }\n\n            if (!popupWindowsByName.has(data.name)) {\n                throw new Error(`Window with name ${ data.name } does not exist, or was not opened by this window`);\n            }\n\n            if (!popupWindowsByName.get(data.name).domain) {\n                throw new Error(`We do not have a registered domain for window ${ data.name }`);\n            }\n\n            if (popupWindowsByName.get(data.name).domain !== origin) {\n                throw new Error(`Message origin ${ origin } does not matched registered window origin ${ popupWindowsByName.get(data.name).domain }`);\n            }\n\n            registerRemoteSendMessage(popupWindowsByName.get(data.name).win, origin, data.sendMessage);\n\n            return {\n                sendMessage(message) {\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    const winDetails = popupWindowsByName.get(data.name);\n\n                    if (!winDetails) {\n                        return;\n                    }\n\n                    try {\n                        receiveMessage({\n                            data:   message,\n                            origin: winDetails.domain,\n                            source: winDetails.win\n                        }, { on, send });\n                    } catch (err) {\n                        ZalgoPromise.reject(err);\n                    }\n                }\n            };\n        });\n    });\n}\n\nfunction openBridgeFrame(name : string, url : string) : HTMLIFrameElement {\n\n    const iframe = document.createElement(`iframe`);\n\n    iframe.setAttribute(`name`, name);\n    iframe.setAttribute(`id`,   name);\n\n    iframe.setAttribute(`style`, `display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;`);\n    iframe.setAttribute(`frameborder`, `0`);\n    iframe.setAttribute(`border`, `0`);\n    iframe.setAttribute(`scrolling`, `no`);\n    iframe.setAttribute(`allowTransparency`, `true`);\n\n    iframe.setAttribute(`tabindex`, `-1`);\n    iframe.setAttribute(`hidden`, `true`);\n    iframe.setAttribute(`title`, ``);\n    iframe.setAttribute(`role`, `presentation`);\n\n    iframe.src = url;\n\n    return iframe;\n}\n\nexport function hasBridge(url : string, domain : string) : boolean {\n    const bridges = globalStore('bridges');\n    return bridges.has(domain || getDomainFromUrl(url));\n}\n\nexport function openBridge(url : string, domain : string) : ZalgoPromise<CrossDomainWindowType> {\n    const bridges = globalStore('bridges');\n    const bridgeFrames = globalStore('bridgeFrames');\n    \n    domain = domain || getDomainFromUrl(url);\n    \n    return bridges.getOrSet(domain, () => ZalgoPromise.try(() => {\n\n        if (getDomain() === domain) {\n            throw new Error(`Can not open bridge on the same domain as current domain: ${ domain }`);\n        }\n\n        const name  = getBridgeName(domain);\n        const frame = getFrameByName(window, name);\n\n        if (frame) {\n            throw new Error(`Frame with name ${ name } already exists on page`);\n        }\n\n        const iframe = openBridgeFrame(name, url);\n        bridgeFrames.set(domain, iframe);\n\n        return documentBodyReady.then(body => {\n\n            body.appendChild(iframe);\n            const bridge = iframe.contentWindow;\n\n            return new ZalgoPromise((resolve, reject) => {\n\n                iframe.addEventListener('load', resolve);\n                iframe.addEventListener('error', reject);\n\n            }).then(() => {\n\n                return awaitWindowHello(bridge, BRIDGE_TIMEOUT, `Bridge ${ url }`);\n\n            }).then(() => {\n\n                return bridge;\n            });\n        });\n    }));\n}\n\ntype WinDetails = {|\n    win : CrossDomainWindowType,\n    domain? : ?string,\n    name? : ?string\n|};\n\nexport function linkWindow({ win, name, domain } : WinDetails) : WinDetails {\n    const popupWindowsByName = globalStore('popupWindowsByName');\n    const popupWindowsByWin = windowStore('popupWindowsByWin');\n\n    for (const winName of popupWindowsByName.keys()) {\n        // $FlowFixMe\n        const details = popupWindowsByName.get(winName);\n        if (!details || isWindowClosed(details.win)) {\n            popupWindowsByName.del(winName);\n        }\n    }\n\n    if (isWindowClosed(win)) {\n        return { win, name, domain };\n    }\n\n    const details = popupWindowsByWin.getOrSet(win, () : WinDetails => {\n        if (!name) {\n            return { win };\n        }\n        \n        return popupWindowsByName.getOrSet(name, () : WinDetails => {\n            return { win, name };\n        });\n    });\n\n    if (details.win && details.win !== win) {\n        throw new Error(`Different window already linked for window: ${ name || 'undefined' }`);\n    }\n\n    if (name) {\n        details.name = name;\n        popupWindowsByName.set(name, details);\n    }\n\n    if (domain) {\n        details.domain = domain;\n        registerRemoteWindow(win);\n    }\n\n    popupWindowsByWin.set(win, details);\n    \n    return details;\n}\n\nexport function linkUrl(win : CrossDomainWindowType, url : string) {\n    linkWindow({ win, domain: getDomainFromUrl(url) });\n}\n\nexport function listenForWindowOpen() {\n    const windowOpen = window.open;\n\n    window.open = function windowOpenWrapper(url : string, name : string, options : string, last : mixed) : mixed {\n        const win = windowOpen.call(this, normalizeMockUrl(url), name, options, last);\n    \n        if (!win) {\n            return win;\n        }\n    \n        linkWindow({ win, name, domain: url ? getDomainFromUrl(url) : null });\n    \n        return win;\n    };\n}\n\nexport function destroyBridges() {\n    const bridges = globalStore('bridges');\n    const bridgeFrames = globalStore('bridgeFrames');\n\n    for (const domain of bridgeFrames.keys()) {\n        const frame = bridgeFrames.get(domain);\n        if (frame && frame.parentNode) {\n            frame.parentNode.removeChild(frame);\n        }\n    }\n    bridgeFrames.reset();\n    bridges.reset();\n}\n","/* @flow */\n\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { listenForWindowOpen, listenForOpenTunnel } from './parent';\nimport { setupOpenTunnelToParent } from './bridge';\nimport { openTunnelToOpener } from './child';\n\nexport function setupBridge({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) {\n    listenForWindowOpen();\n    listenForOpenTunnel({ on, send, receiveMessage });\n    setupOpenTunnelToParent({ on, send });\n    openTunnelToOpener({ on, send, receiveMessage });\n}\n","/* @flow */\n\n\nexport * from './bridge';\nexport * from './child';\nexport * from './common';\nexport * from './parent';\nexport * from './setup';\n","/* @flow */\n\nimport { isSameDomain, isWindowClosed, type CrossDomainWindowType, closeWindow,\n    type DomainMatcher, getOpener, WINDOW_TYPE, isWindow, assertSameDomain, getFrameForWindow } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { uniqueID, memoizePromise } from 'belter/src';\nimport { serializeType, type CustomSerializedType } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport { getWindowInstanceID } from '../lib';\nimport { linkWindow } from '../bridge';\nimport type { SendType } from '../types';\n\nfunction cleanupProxyWindows() {\n    const idToProxyWindow = globalStore('idToProxyWindow');\n    for (const id of idToProxyWindow.keys()) {\n        // $FlowFixMe\n        if (idToProxyWindow.get(id).shouldClean()) {\n            idToProxyWindow.del(id);\n        }\n    }\n}\n\ntype SerializedWindowType = {|\n    id : string,\n    getType : () => ZalgoPromise<$Values<typeof WINDOW_TYPE>>,\n    close : () => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<void>,\n    isClosed : () => ZalgoPromise<boolean>,\n    setLocation : (string) => ZalgoPromise<void>,\n    getName : () => ZalgoPromise<?string>,\n    setName : (string) => ZalgoPromise<void>,\n    getInstanceID : () => ZalgoPromise<string>\n|};\n\nfunction getSerializedWindow(winPromise : ZalgoPromise<CrossDomainWindowType>, { send, id = uniqueID() } : { send : SendType, id? : string }) : SerializedWindowType {\n    \n    let windowNamePromise = winPromise.then(win => {\n        if (isSameDomain(win)) {\n            return assertSameDomain(win).name;\n        }\n    });\n    \n    return {\n        id,\n        getType: () => winPromise.then(win => {\n            return getOpener(win) ? WINDOW_TYPE.POPUP : WINDOW_TYPE.IFRAME;\n        }),\n        getInstanceID: memoizePromise(() => winPromise.then(win => getWindowInstanceID(win, { send }))),\n        close:         () => winPromise.then(closeWindow),\n        getName:       () => winPromise.then(win => {\n            if (isWindowClosed(win)) {\n                return;\n            }\n\n            if (isSameDomain(win)) {\n                return assertSameDomain(win).name;\n            }\n\n            return windowNamePromise;\n        }),\n        focus:   () => winPromise.then(win => {\n            win.focus();\n        }),\n        isClosed: () => winPromise.then(win => {\n            return isWindowClosed(win);\n        }),\n        setLocation: (href) => winPromise.then(win => {\n            if (isSameDomain(win)) {\n                try {\n                    if (win.location && typeof win.location.replace === 'function') {\n                        // $FlowFixMe\n                        win.location.replace(href);\n                        return;\n                    }\n                } catch (err) {\n                    // pass\n                }\n            }\n\n            win.location = href;\n        }),\n        setName: (name) => winPromise.then(win => {\n            if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n                linkWindow({ win, name });\n            }\n\n            const sameDomain = isSameDomain(win);\n            const frame = getFrameForWindow(win);\n\n            if (!sameDomain) {\n                throw new Error(`Can not set name for cross-domain window: ${ name }`);\n            }\n\n            assertSameDomain(win).name = name;\n            if (frame) {\n                frame.setAttribute('name', name);\n            }\n\n            windowNamePromise = ZalgoPromise.resolve(name);\n        })\n    };\n}\n\nexport class ProxyWindow {\n\n    id : string\n    isProxyWindow : true = true\n    serializedWindow : SerializedWindowType\n    actualWindow : ?CrossDomainWindowType\n    actualWindowPromise : ZalgoPromise<CrossDomainWindowType>\n    send : SendType\n    name : string\n\n    constructor({ send, win, serializedWindow } : { win? : CrossDomainWindowType, serializedWindow? : SerializedWindowType, send : SendType }) {\n        this.actualWindowPromise = new ZalgoPromise();\n        this.serializedWindow = serializedWindow || getSerializedWindow(this.actualWindowPromise, { send });\n        globalStore('idToProxyWindow').set(this.getID(), this);\n        if (win) {\n            this.setWindow(win, { send });\n        }\n    }\n\n    getID() : string {\n        return this.serializedWindow.id;\n    }\n\n    getType() : ZalgoPromise<$Values<typeof WINDOW_TYPE>> {\n        return this.serializedWindow.getType();\n    }\n\n    isPopup() : ZalgoPromise<boolean> {\n        return this.getType().then(type => {\n            return type === WINDOW_TYPE.POPUP;\n        });\n    }\n\n    setLocation(href : string) : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.setLocation(href).then(() => this);\n    }\n\n    getName() : ZalgoPromise<?string> {\n        return this.serializedWindow.getName();\n    }\n\n    setName(name : string) : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.setName(name).then(() => this);\n    }\n\n    close() : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.close().then(() => this);\n    }\n\n    focus() : ZalgoPromise<ProxyWindow> {\n        const isPopupPromise = this.isPopup();\n        const getNamePromise = this.getName();\n\n        const reopenPromise = ZalgoPromise.hash({ isPopup: isPopupPromise, name: getNamePromise }).then(({ isPopup, name }) => {\n            if (isPopup && name) {\n                window.open('', name);\n            }\n        });\n        const focusPromise = this.serializedWindow.focus();\n\n        return ZalgoPromise.all([\n            reopenPromise,\n            focusPromise\n        ]).then(() => this);\n    }\n\n    isClosed() : ZalgoPromise<boolean> {\n        return this.serializedWindow.isClosed();\n    }\n\n    getWindow() : ?CrossDomainWindowType {\n        return this.actualWindow;\n    }\n\n    setWindow(win : CrossDomainWindowType, { send } : { send : SendType }) {\n        this.actualWindow = win;\n        this.actualWindowPromise.resolve(this.actualWindow);\n        this.serializedWindow = getSerializedWindow(this.actualWindowPromise, { send, id: this.getID() });\n        windowStore('winToProxyWindow').set(win, this);\n    }\n\n    awaitWindow() : ZalgoPromise<CrossDomainWindowType> {\n        return this.actualWindowPromise;\n    }\n\n    matchWindow(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<boolean> {\n        return ZalgoPromise.try(() => {\n            if (this.actualWindow) {\n                return win === this.actualWindow;\n            }\n            \n            return ZalgoPromise.hash({\n                proxyInstanceID:       this.getInstanceID(),\n                knownWindowInstanceID: getWindowInstanceID(win, { send })\n            }).then(({ proxyInstanceID, knownWindowInstanceID }) => {\n                const match = proxyInstanceID === knownWindowInstanceID;\n\n                if (match) {\n                    this.setWindow(win, { send });\n                }\n\n                return match;\n            });\n        });\n    }\n\n    unwrap() : CrossDomainWindowType | ProxyWindow {\n        return this.actualWindow || this;\n    }\n\n    getInstanceID() : ZalgoPromise<string> {\n        return this.serializedWindow.getInstanceID();\n    }\n\n    shouldClean() : boolean {\n        return Boolean(this.actualWindow && isWindowClosed(this.actualWindow));\n    }\n\n    serialize() : SerializedWindowType {\n        return this.serializedWindow;\n    }\n\n    static unwrap(win : CrossDomainWindowType | ProxyWindow) : CrossDomainWindowType | ProxyWindow {\n        return ProxyWindow.isProxyWindow(win)\n            // $FlowFixMe\n            ? win.unwrap()\n            : win;\n    }\n\n    static serialize(win : CrossDomainWindowType | ProxyWindow, { send } : { send : SendType }) : SerializedWindowType {\n        cleanupProxyWindows();\n        return ProxyWindow.toProxyWindow(win, { send }).serialize();\n    }\n\n    static deserialize(serializedWindow : SerializedWindowType, { send } : { send : SendType }) : ProxyWindow {\n        cleanupProxyWindows();\n        return globalStore('idToProxyWindow').get(serializedWindow.id) || new ProxyWindow({ serializedWindow, send });\n    }\n\n    static isProxyWindow(obj : CrossDomainWindowType | ProxyWindow) : boolean {\n        // $FlowFixMe\n        return Boolean(obj && !isWindow(obj) && obj.isProxyWindow);\n    }\n\n    static toProxyWindow(win : CrossDomainWindowType | ProxyWindow, { send } : { send : SendType }) : ProxyWindow {\n        cleanupProxyWindows();\n\n        if (ProxyWindow.isProxyWindow(win)) {\n            // $FlowFixMe\n            return win;\n        }\n\n        // $FlowFixMe\n        const actualWindow : CrossDomainWindowType = win;\n        \n        return windowStore('winToProxyWindow').get(actualWindow) || new ProxyWindow({ win: actualWindow, send });\n    }\n}\n\nexport type SerializedWindow = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW, SerializedWindowType>;\n\nexport function serializeWindow(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, win : CrossDomainWindowType, { send } : { send : SendType }) : SerializedWindow {\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW, ProxyWindow.serialize(win, { send }));\n}\n\nexport function deserializeWindow(source : CrossDomainWindowType | ProxyWindow, origin : string, win : SerializedWindowType, { send } : { send : SendType }) : ProxyWindow {\n    return ProxyWindow.deserialize(win, { send });\n}\n","/* @flow */\n\nimport { matchDomain, getDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { uniqueID, isRegex } from 'belter/src';\nimport { serializeType, type CustomSerializedType } from 'universal-serialize/src';\n\nimport { MESSAGE_NAME, WILDCARD, SERIALIZATION_TYPE } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, CancelableType } from '../types';\n\nimport { ProxyWindow } from './window';\n\ntype StoredMethod = {|\n    name : string,\n    domain : DomainMatcher,\n    val : Function,\n    source : CrossDomainWindowType | ProxyWindow\n|};\n\nfunction addMethod(id : string, val : Function, name : string, source : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher) {\n    const methodStore = windowStore('methodStore');\n    const proxyWindowMethods = globalStore('proxyWindowMethods');\n    \n    if (ProxyWindow.isProxyWindow(source)) {\n        proxyWindowMethods.set(id, { val, name, domain, source });\n    } else {\n        proxyWindowMethods.del(id);\n        // $FlowFixMe\n        const methods = methodStore.getOrSet(source, () => ({}));\n        methods[id] = { domain, name, val, source };\n    }\n}\n\nfunction lookupMethod(source : CrossDomainWindowType, id : string) : ?StoredMethod {\n    const methodStore = windowStore('methodStore');\n    const proxyWindowMethods = globalStore('proxyWindowMethods');\n    const methods = methodStore.getOrSet(source, () => ({}));\n    return methods[id] || proxyWindowMethods.get(id);\n}\n\nfunction listenForFunctionCalls({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore('builtinListeners').getOrSet('functionCalls', () => {\n        return on(MESSAGE_NAME.METHOD, { domain: WILDCARD }, ({ source, origin, data } : { source : CrossDomainWindowType, origin : string, data : Object }) => {\n            const { id, name } = data;\n\n            const meth = lookupMethod(source, id);\n    \n            if (!meth) {\n                throw new Error(`Could not find method '${ name }' with id: ${ data.id } in ${ getDomain(window) }`);\n            }\n\n            const { source: methodSource, domain, val } = meth;\n            \n            return ZalgoPromise.try(() => {\n                if (!matchDomain(domain, origin)) {\n                    // $FlowFixMe\n                    throw new Error(`Method '${ data.name }' domain ${ JSON.stringify(isRegex(meth.domain) ? meth.domain.source : meth.domain) } does not match origin ${ origin } in ${ getDomain(window) }`);\n                }\n                \n                if (ProxyWindow.isProxyWindow(methodSource)) {\n                    // $FlowFixMe\n                    return methodSource.matchWindow(source, { send }).then(match => {\n                        if (!match) {\n                            throw new Error(`Method call '${ data.name }' failed - proxy window does not match source in ${ getDomain(window) }`);\n                        }\n                    });\n                }\n            }).then(() => {\n                return val.apply({ source, origin }, data.args);\n            }, err => {\n                return ZalgoPromise.try(() => {\n                    if (val.onError) {\n                        return val.onError(err);\n                    }\n                }).then(() => {\n                    // $FlowFixMe\n                    if (err.stack) {\n                        // $FlowFixMe\n                        err.stack = `Remote call to ${ name }()\\n\\n${ err.stack }`;\n                    }\n\n                    throw err;\n                });\n            }).then(result => {\n                return { result, id, name };\n            });\n        });\n    });\n}\n\nexport type SerializedFunction = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION, {\n    id : string,\n    name : string\n}>;\n\n// eslint-disable-next-line flowtype/require-exact-type\ntype SerializableFunction<T> = {\n    () : ZalgoPromise<T> | T,\n    __id__? : string,\n    __name__? : string\n};\n\nexport function serializeFunction<T>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, val : SerializableFunction<T>, key : string, { on, send } : { on : OnType, send : SendType }) : SerializedFunction {\n    listenForFunctionCalls({ on, send });\n    \n    const id = val.__id__ || uniqueID();\n    destination = ProxyWindow.unwrap(destination);\n    let name = val.__name__ || val.name || key;\n\n    if (typeof name === 'string' && typeof name.indexOf === 'function' && name.indexOf('anonymous::') === 0) {\n        name = name.replace('anonymous::', `${ key }::`);\n    }\n\n    if (ProxyWindow.isProxyWindow(destination)) {\n        addMethod(id, val, name, destination, domain);\n\n        // $FlowFixMe\n        destination.awaitWindow().then(win => {\n            addMethod(id, val, name, win, domain);\n        });\n    } else {\n        addMethod(id, val, name, destination, domain);\n    }\n\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION, { id, name });\n}\n\nexport function deserializeFunction<T>(source : CrossDomainWindowType | ProxyWindow, origin : string, { id, name } : { id : string, name : string }, { send } : { send : SendType }) : (...args : $ReadOnlyArray<mixed>) => ZalgoPromise<T> {\n    const getDeserializedFunction = (opts? : Object = {}) => {\n        function crossDomainFunctionWrapper<X : mixed>() : ZalgoPromise<X> {\n            let originalStack;\n    \n            if (__DEBUG__) {\n                originalStack = (new Error(`Original call to ${ name }():`)).stack;\n            }\n    \n            return ProxyWindow.toProxyWindow(source, { send }).awaitWindow().then(win => {\n                const meth = lookupMethod(win, id);\n    \n                if (meth && meth.val !== crossDomainFunctionWrapper) {\n                    return meth.val.apply({ source: window, origin: getDomain() }, arguments);\n                } else {\n                    // $FlowFixMe\n                    const options = { domain: origin, fireAndForget: opts.fireAndForget };\n                    const args = Array.prototype.slice.call(arguments);\n\n                    return send(win, MESSAGE_NAME.METHOD, { id, name, args }, options)\n                        .then(res => {\n                            if (!opts.fireAndForget) {\n                                return res.data.result;\n                            }\n                        });\n                }\n    \n            }).catch(err => {\n                // $FlowFixMe\n                if (__DEBUG__ && originalStack && err.stack) {\n                    // $FlowFixMe\n                    err.stack = `${ err.stack }\\n\\n${ originalStack }`;\n                }\n                throw err;\n            });\n        }\n\n        crossDomainFunctionWrapper.__name__ = name;\n        crossDomainFunctionWrapper.__origin__ = origin;\n        crossDomainFunctionWrapper.__source__ = source;\n        crossDomainFunctionWrapper.__id__ = id;\n\n        crossDomainFunctionWrapper.origin = origin;\n\n        return crossDomainFunctionWrapper;\n    };\n\n    const crossDomainFunctionWrapper = getDeserializedFunction();\n    crossDomainFunctionWrapper.fireAndForget = getDeserializedFunction({ fireAndForget: true });\n\n    return crossDomainFunctionWrapper;\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { serializeType, type CustomSerializedType, type Thenable } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport type { OnType, SendType } from '../types';\n\nimport { serializeFunction, type SerializedFunction } from './function';\nimport { ProxyWindow } from './window';\n\nexport type SerializedPromise = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE, {\n    then : SerializedFunction\n}>;\n\nexport function serializePromise(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, val : Thenable, key : string, { on, send } : { on : OnType, send : SendType }) : SerializedPromise {\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE, {\n        then: serializeFunction(destination, domain, (resolve, reject) => val.then(resolve, reject), key, { on, send })\n    });\n}\n\nexport function deserializePromise<T>(source : CrossDomainWindowType | ProxyWindow, origin : string, { then } : { then : Function }) : ZalgoPromise<T> {\n    return new ZalgoPromise(then);\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType, isWindow, type DomainMatcher } from 'cross-domain-utils/src';\nimport { TYPE, serialize, deserialize, type Thenable } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport type { OnType, SendType } from '../types';\n\nimport { serializeFunction, deserializeFunction, type SerializedFunction } from './function';\nimport { serializePromise, deserializePromise, type SerializedPromise } from './promise';\nimport { serializeWindow, deserializeWindow, type SerializedWindow, ProxyWindow } from './window';\n\nexport function serializeMessage<T : mixed>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, obj : T, { on, send } : { on : OnType, send : SendType }) : string {\n    return serialize(obj, {\n        [ TYPE.PROMISE ]:  (val : Thenable, key : string) : SerializedPromise => serializePromise(destination, domain, val, key, { on, send }),\n        [ TYPE.FUNCTION ]: (val : Function, key : string) : SerializedFunction => serializeFunction(destination, domain, val, key, { on, send }),\n        [ TYPE.OBJECT ]:   (val : CrossDomainWindowType) : Object | SerializedWindow => {\n            return (isWindow(val) || ProxyWindow.isProxyWindow(val)) ? serializeWindow(destination, domain, val, { on, send }) : val;\n        }\n    });\n}\n\nexport function deserializeMessage<T : mixed>(source : CrossDomainWindowType | ProxyWindow, origin : string, message : string, { on, send } : { on : OnType, send : SendType }) : T {\n    return deserialize(message, {\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE ]: (serializedPromise)  => deserializePromise(source, origin, serializedPromise),\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION ]:      (serializedFunction) => deserializeFunction(source, origin, serializedFunction, { on, send }),\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW ]:        (serializedWindow)   => deserializeWindow(source, origin, serializedWindow, { send })\n    });\n}\n","/* @flow */\n\nexport * from './serialize';\nexport * from './function';\nexport * from './promise';\nexport * from './window';\n","/* @flow */\n\nimport { isSameDomain, isSameTopWindow, isActuallySameDomain, getActualDomain,\n    getDomain, type CrossDomainWindowType, type DomainMatcher, PROTOCOL } from 'cross-domain-utils/src';\n\nimport { SEND_STRATEGY, WILDCARD } from '../../conf';\nimport { needsGlobalMessagingForBrowser } from '../../lib';\nimport { getGlobal } from '../../global';\nimport { sendBridgeMessage, needsBridgeForBrowser, isBridge } from '../../bridge';\n\nexport const SEND_MESSAGE_STRATEGIES = {};\n\nSEND_MESSAGE_STRATEGIES[SEND_STRATEGY.POST_MESSAGE] = (win : CrossDomainWindowType, serializedMessage : string, domain : DomainMatcher) => {\n\n    if (__TEST__) {\n        if (needsGlobalMessagingForBrowser() && isSameTopWindow(window, win) === false) {\n            return;\n        }\n    }\n\n    let domains;\n\n    if (Array.isArray(domain)) {\n        domains = domain;\n    } else if (typeof domain === 'string') {\n        domains = [ domain ];\n    } else {\n        domains = [ WILDCARD ];\n    }\n\n    domains = domains.map(dom => {\n\n        if (__TEST__) {\n            if (dom.indexOf(PROTOCOL.MOCK) === 0) {\n                if (window.location.protocol === PROTOCOL.FILE) {\n                    return WILDCARD;\n                }\n\n                if (!isActuallySameDomain(win)) {\n                    throw new Error(`Attempting to send messsage to mock domain ${ dom }, but window is actually cross-domain`);\n                }\n\n                // $FlowFixMe\n                const windowDomain = getDomain(win);\n                \n                if (windowDomain !== dom) {\n                    throw new Error(`Mock domain target ${ dom } does not match window domain ${ windowDomain }`);\n                }\n\n                // $FlowFixMe\n                return getActualDomain(win);\n\n            }\n        }\n        \n        if (dom.indexOf(PROTOCOL.FILE) === 0) {\n            return WILDCARD;\n        }\n\n        return dom;\n    });\n\n    domains.forEach(dom => {\n        win.postMessage(serializedMessage, dom);\n    });\n};\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n\n    SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.BRIDGE] = (win : CrossDomainWindowType, serializedMessage : string, domain : string) => {\n\n        if (!needsBridgeForBrowser() && !isBridge()) {\n            throw new Error(`Bridge not needed for browser`);\n        }\n\n        if (isSameDomain(win)) {\n            throw new Error(`Post message through bridge disabled between same domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use bridge to communicate between two different windows, not between frames`);\n        }\n\n        sendBridgeMessage(win, domain, serializedMessage);\n    };\n}\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__ || __POST_ROBOT__.__GLOBAL_MESSAGE_SUPPORT__) {\n    \n    SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.GLOBAL] = (win : CrossDomainWindowType, serializedMessage : string) => {\n\n        if (!needsGlobalMessagingForBrowser()) {\n            throw new Error(`Global messaging not needed for browser`);\n        }\n\n        if (!isSameDomain(win)) {\n            throw new Error(`Post message through global disabled between different domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use global to communicate between two different windows, not between frames`);\n        }\n\n        // $FlowFixMe\n        const foreignGlobal = getGlobal(win);\n\n        if (!foreignGlobal) {\n            throw new Error(`Can not find postRobot global on foreign window`);\n        }\n\n        foreignGlobal.receiveMessage({\n            source: window,\n            origin: getDomain(),\n            data:   serializedMessage\n        });\n    };\n}\n","/* @flow */\n\nimport { isWindowClosed, getDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { uniqueID, stringifyError } from 'belter/src';\n\nimport { serializeMessage } from '../../serialize';\nimport type { Message } from '../types';\nimport type { OnType, SendType } from '../../types';\n\nimport { SEND_MESSAGE_STRATEGIES } from './strategies';\n\nexport function sendMessage(win : CrossDomainWindowType, domain : DomainMatcher, message : Message, { on, send } : { on : OnType, send : SendType }) {\n    if (isWindowClosed(win)) {\n        throw new Error('Window is closed');\n    }\n    \n    const serializedMessage = serializeMessage(win, domain, {\n        [ __POST_ROBOT__.__GLOBAL_KEY__ ]: {\n            id:     uniqueID(),\n            origin: getDomain(window),\n            ...message\n        }\n    }, { on, send });\n\n    const strategies = Object.keys(SEND_MESSAGE_STRATEGIES);\n    const errors = [];\n\n    for (const strategyName of strategies) {\n        try {\n            SEND_MESSAGE_STRATEGIES[strategyName](win, serializedMessage, domain);\n        } catch (err) {\n            errors.push(err);\n        }\n    }\n\n    if (errors.length === strategies.length) {\n        throw new Error(`All post-robot messaging strategies failed:\\n\\n${ errors.map((err, i) => `${ i }. ${ stringifyError(err) }`).join('\\n\\n') }`);\n    }\n}\n","/* @flow */\n\nimport { type ZalgoPromise } from 'zalgo-promise/src';\nimport { matchDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { isRegex, getOrSet } from 'belter/src';\n\nimport { getWildcard, type WildCard, globalStore, windowStore } from '../global';\nimport { WILDCARD } from '../conf';\n\nexport function resetListeners() {\n    const responseListeners = globalStore('responseListeners');\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    responseListeners.reset();\n    erroredResponseListeners.reset();\n}\n\nconst __DOMAIN_REGEX__ = '__domain_regex__';\n\nexport type RequestListenerType = {|\n    handler : ({ source : CrossDomainWindowType, origin : string, data : mixed }) => (mixed | ZalgoPromise<mixed>),\n    handleError : (err : mixed) => void,\n    window : ?CrossDomainWindowType,\n    name : string,\n    domain : DomainMatcher\n|};\n\nexport type ResponseListenerType = {|\n    name : string,\n    win : CrossDomainWindowType,\n    domain : DomainMatcher,\n    promise : ZalgoPromise<*>,\n    ack? : ?boolean,\n    cancelled? : ?boolean\n|};\n\nexport function addResponseListener(hash : string, listener : ResponseListenerType) {\n    const responseListeners = globalStore('responseListeners');\n    responseListeners.set(hash, listener);\n}\n\nexport function getResponseListener(hash : string) : ?ResponseListenerType {\n    const responseListeners = globalStore('responseListeners');\n    return responseListeners.get(hash);\n}\n\nexport function deleteResponseListener(hash : string) {\n    const responseListeners = globalStore('responseListeners');\n    responseListeners.del(hash);\n}\n\nexport function cancelResponseListeners() {\n    const responseListeners = globalStore('responseListeners');\n    for (const hash of responseListeners.keys()) {\n        const listener = responseListeners.get(hash);\n        if (listener) {\n            listener.cancelled = true;\n        }\n        responseListeners.del(hash);\n    }\n}\n\nexport function markResponseListenerErrored(hash : string) {\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    erroredResponseListeners.set(hash, true);\n}\n\nexport function isResponseListenerErrored(hash : string) : boolean {\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    return erroredResponseListeners.has(hash);\n}\n\nexport function getRequestListener({ name, win, domain } : { name : string, win : ?(CrossDomainWindowType | WildCard), domain : ?(string | RegExp) }) : ?RequestListenerType {\n    const requestListeners = windowStore('requestListeners');\n\n    if (win === WILDCARD) {\n        win = null;\n    }\n\n    if (domain === WILDCARD) {\n        domain = null;\n    }\n\n    if (!name) {\n        throw new Error(`Name required to get request listener`);\n    }\n\n    for (const winQualifier of [ win, getWildcard() ]) {\n        if (!winQualifier) {\n            continue;\n        }\n\n        const nameListeners = requestListeners.get(winQualifier);\n\n        if (!nameListeners) {\n            continue;\n        }\n\n        const domainListeners = nameListeners[name];\n\n        if (!domainListeners) {\n            continue;\n        }\n\n        if (domain && typeof domain === 'string') {\n            if (domainListeners[domain]) {\n                return domainListeners[domain];\n            }\n\n            if (domainListeners[__DOMAIN_REGEX__]) {\n                for (const { regex, listener } of domainListeners[__DOMAIN_REGEX__]) {\n                    if (matchDomain(regex, domain)) {\n                        return listener;\n                    }\n                }\n            }\n        }\n\n        if (domainListeners[WILDCARD]) {\n            return domainListeners[WILDCARD];\n        }\n    }\n}\n\nexport function addRequestListener({ name, win, domain } : { name : string, win : ?(CrossDomainWindowType | WildCard), domain : ?DomainMatcher }, listener : RequestListenerType) : { cancel : () => void } {\n    const requestListeners = windowStore('requestListeners');\n\n    if (!name || typeof name !== 'string') {\n        throw new Error(`Name required to add request listener`);\n    }\n\n    if (Array.isArray(win)) {\n        const listenersCollection = [];\n\n        for (const item of win) {\n            listenersCollection.push(addRequestListener({ name, domain, win: item }, listener));\n        }\n\n        return {\n            cancel() {\n                for (const cancelListener of listenersCollection) {\n                    cancelListener.cancel();\n                }\n            }\n        };\n    }\n\n    if (Array.isArray(domain)) {\n        const listenersCollection = [];\n\n        for (const item of domain) {\n            listenersCollection.push(addRequestListener({ name, win, domain: item }, listener));\n        }\n\n        return {\n            cancel() {\n                for (const cancelListener of listenersCollection) {\n                    cancelListener.cancel();\n                }\n            }\n        };\n    }\n\n    const existingListener = getRequestListener({ name, win, domain });\n\n    if (!win || win === WILDCARD) {\n        win = getWildcard();\n    }\n\n    domain = domain || WILDCARD;\n\n    if (existingListener) {\n        if (win && domain) {\n            throw new Error(`Request listener already exists for ${ name } on domain ${ domain.toString() } for ${ win === getWildcard() ? 'wildcard' : 'specified' } window`);\n        } else if (win) {\n            throw new Error(`Request listener already exists for ${ name } for ${ win === getWildcard() ? 'wildcard' : 'specified' } window`);\n        } else if (domain) {\n            throw new Error(`Request listener already exists for ${ name } on domain ${ domain.toString() }`);\n        } else {\n            throw new Error(`Request listener already exists for ${ name }`);\n        }\n    }\n\n    const nameListeners = requestListeners.getOrSet(win, () => ({}));\n    const domainListeners = getOrSet(nameListeners, name, () => ({}));\n\n    const strDomain = domain.toString();\n\n    let regexListeners;\n    let regexListener;\n\n    if (isRegex(domain)) {\n        regexListeners = getOrSet(domainListeners, __DOMAIN_REGEX__, () => []);\n        regexListener = { regex: domain, listener };\n        regexListeners.push(regexListener);\n    } else {\n        domainListeners[strDomain] = listener;\n    }\n\n    return {\n        cancel() {\n            delete domainListeners[strDomain];\n\n            if (regexListener) {\n                regexListeners.splice(regexListeners.indexOf(regexListener, 1));\n\n                if (!regexListeners.length) {\n                    delete domainListeners[__DOMAIN_REGEX__];\n                }\n            }\n\n            if (!Object.keys(domainListeners).length) {\n                delete nameListeners[name];\n            }\n\n            if (win && !Object.keys(nameListeners).length) {\n                requestListeners.del(win);\n            }\n        }\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, isWindowClosed, matchDomain, stringifyDomainPattern, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop, stringifyError } from 'belter/src';\n\nimport { MESSAGE_TYPE, MESSAGE_ACK, MESSAGE_NAME } from '../../conf';\nimport { sendMessage } from '../send';\nimport { getRequestListener, getResponseListener, deleteResponseListener, isResponseListenerErrored } from '../listeners';\nimport type { RequestMessage, AckResponseMessage, SuccessResponseMessage, ErrorResponseMessage } from '../types';\nimport type { OnType, SendType } from '../../types';\n\nexport const RECEIVE_MESSAGE_TYPES = {\n\n    [ MESSAGE_TYPE.REQUEST ](source : CrossDomainWindowType, origin : string, message : RequestMessage, { on, send } : { on : OnType, send : SendType }) : ZalgoPromise<void> {\n\n        const options = getRequestListener({ name: message.name, win: source, domain: origin });\n\n        const logName = (message.name === MESSAGE_NAME.METHOD && message.data && typeof message.data.name === 'string') ? `${ message.data.name }()` : message.name;\n\n        if (__DEBUG__) {\n            // eslint-disable-next-line no-console\n            console.info('receive::req', logName, origin, '\\n\\n', message.data);\n        }\n\n        function sendResponse(type : $Values<typeof MESSAGE_TYPE>, ack? : $Values<typeof MESSAGE_ACK>, response = {}) {\n\n            if (message.fireAndForget || isWindowClosed(source)) {\n                return;\n            }\n\n            if (__DEBUG__ && type !== MESSAGE_TYPE.ACK) {\n                if (ack === MESSAGE_ACK.SUCCESS) {\n                    // $FlowFixMe\n                    console.info('respond::res', logName, origin, '\\n\\n', response.data);  // eslint-disable-line no-console\n                } else if (ack === MESSAGE_ACK.ERROR) {\n                    // $FlowFixMe\n                    console.error('respond::err', logName, origin, '\\n\\n', response.error); // eslint-disable-line no-console\n                }\n            }\n\n            try {\n                // $FlowFixMe\n                sendMessage(source, origin, {\n                    type,\n                    ack,\n                    hash:   message.hash,\n                    name:   message.name,\n                    ...response\n                }, { on, send });\n            } catch (err) {\n                throw new Error(`Send response message failed for ${ logName } in ${ getDomain() }\\n\\n${ stringifyError(err) }`);\n            }\n        }\n\n        return ZalgoPromise.all([\n\n            sendResponse(MESSAGE_TYPE.ACK),\n\n            ZalgoPromise.try(() => {\n\n                if (!options) {\n                    throw new Error(`No handler found for post message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n                }\n\n                if (!matchDomain(options.domain, origin)) {\n                    throw new Error(`Request origin ${ origin } does not match domain ${ options.domain.toString() }`);\n                }\n\n                const data = message.data;\n\n                return options.handler({ source, origin, data });\n\n            }).then(data => {\n                return sendResponse(MESSAGE_TYPE.RESPONSE, MESSAGE_ACK.SUCCESS, { data });\n\n            }, error => {\n                return sendResponse(MESSAGE_TYPE.RESPONSE, MESSAGE_ACK.ERROR, { error });\n            })\n\n        ]).then(noop).catch(err => {\n            if (options && options.handleError) {\n                return options.handleError(err);\n            } else {\n                throw err;\n            }\n        });\n    },\n\n    [ MESSAGE_TYPE.ACK ](source : CrossDomainWindowType, origin : string, message : AckResponseMessage) {\n\n        if (isResponseListenerErrored(message.hash)) {\n            return;\n        }\n\n        const options = getResponseListener(message.hash);\n\n        if (!options) {\n            throw new Error(`No handler found for post message ack for message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n        }\n\n        try {\n            if (!matchDomain(options.domain, origin)) {\n                throw new Error(`Ack origin ${ origin } does not match domain ${ options.domain.toString() }`);\n            }\n    \n            if (source !== options.win) {\n                throw new Error(`Ack source does not match registered window`);\n            }\n        } catch (err) {\n            options.promise.reject(err);\n        }\n\n        options.ack = true;\n    },\n\n    [ MESSAGE_TYPE.RESPONSE ](source : CrossDomainWindowType, origin : string, message : SuccessResponseMessage | ErrorResponseMessage) : void | ZalgoPromise<void> {\n\n        if (isResponseListenerErrored(message.hash)) {\n            return;\n        }\n\n        const options = getResponseListener(message.hash);\n\n        if (!options) {\n            throw new Error(`No handler found for post message response for message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n        }\n\n        if (!matchDomain(options.domain, origin)) {\n            throw new Error(`Response origin ${ origin } does not match domain ${ stringifyDomainPattern(options.domain) }`);\n        }\n\n        if (source !== options.win) {\n            throw new Error(`Response source does not match registered window`);\n        }\n\n        deleteResponseListener(message.hash);\n\n        const logName = (message.name === MESSAGE_NAME.METHOD && message.data && typeof message.data.name === 'string') ? `${ message.data.name }()` : message.name;\n\n        if (message.ack === MESSAGE_ACK.ERROR) {\n            if (__DEBUG__) {\n                console.error('receive::err', logName, origin, '\\n\\n', message.error); // eslint-disable-line no-console\n            }\n\n            options.promise.reject(message.error);\n\n        } else if (message.ack === MESSAGE_ACK.SUCCESS) {\n            if (__DEBUG__) {\n                console.info('receive::res', logName, origin, '\\n\\n', message.data); // eslint-disable-line no-console\n            }\n\n            options.promise.resolve({ source, origin, data: message.data });\n        }\n    }\n};\n","/* @flow */\n\nimport { isWindowClosed, type CrossDomainWindowType, getDomain, isSameTopWindow, PROTOCOL  } from 'cross-domain-utils/src';\nimport { addEventListener, noop } from 'belter/src';\n\nimport { markWindowKnown, needsGlobalMessagingForBrowser } from '../../lib';\nimport { deserializeMessage } from '../../serialize';\nimport { getGlobal, globalStore } from '../../global';\nimport type { OnType, SendType, MessageEvent, CancelableType } from '../../types';\n\nimport { RECEIVE_MESSAGE_TYPES } from './types';\n\nfunction parseMessage(message : string, source : CrossDomainWindowType, origin : string, { on, send } : { on : OnType, send : SendType }) : ?Object {\n    let parsedMessage;\n\n    try {\n        parsedMessage = deserializeMessage(source, origin, message, { on, send });\n    } catch (err) {\n        return;\n    }\n\n    if (!parsedMessage) {\n        return;\n    }\n\n    if (typeof parsedMessage !== 'object' || parsedMessage === null) {\n        return;\n    }\n\n    parsedMessage = parsedMessage[__POST_ROBOT__.__GLOBAL_KEY__];\n\n    if (!parsedMessage || typeof parsedMessage !== 'object' || parsedMessage === null) {\n        return;\n    }\n\n    if (!parsedMessage.type || typeof parsedMessage.type !== 'string') {\n        return;\n    }\n\n    if (!RECEIVE_MESSAGE_TYPES[parsedMessage.type]) {\n        return;\n    }\n\n    return parsedMessage;\n}\n\nexport function receiveMessage(event : MessageEvent, { on, send } : { on : OnType, send : SendType }) {\n    const receivedMessages = globalStore('receivedMessages');\n\n    try {\n        if (!window || window.closed || !event.source) {\n            return;\n        }\n    } catch (err) {\n        return;\n    }\n\n    let { source, origin, data } = event;\n\n    if (__TEST__) {\n        // $FlowFixMe\n        origin = getDomain(source);\n    }\n\n    const message = parseMessage(data, source, origin, { on, send });\n\n    if (!message) {\n        return;\n    }\n\n    markWindowKnown(source);\n\n    if (receivedMessages.has(message.id)) {\n        return;\n    }\n\n    receivedMessages.set(message.id, true);\n\n    if (isWindowClosed(source) && !message.fireAndForget) {\n        return;\n    }\n\n    if (message.origin.indexOf(PROTOCOL.FILE) === 0) {\n        origin = `${ PROTOCOL.FILE }//`;\n    }\n\n    RECEIVE_MESSAGE_TYPES[message.type](source, origin, message, { on, send });\n}\n\nexport function setupGlobalReceiveMessage({ on, send } : { on : OnType, send : SendType }) {\n    const global = getGlobal();\n    global.receiveMessage = global.receiveMessage || (message => receiveMessage(message, { on, send }));\n}\n\ntype ListenerEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : string,\n    sourceElement : CrossDomainWindowType,\n    originalEvent? : { origin : string }\n|};\n\nexport function messageListener(event : ListenerEvent, { on, send } : { on : OnType, send : SendType }) {\n\n    try {\n        noop(event.source);\n    } catch (err) {\n        return;\n    }\n\n    const source = event.source || event.sourceElement;\n    let origin = event.origin || (event.originalEvent && event.originalEvent.origin);\n    const data = event.data;\n\n    if (origin === 'null') {\n        origin = `${ PROTOCOL.FILE }//`;\n    }\n\n    if (!source) {\n        return;\n    }\n\n    if (!origin) {\n        throw new Error(`Post message did not have origin domain`);\n    }\n\n    if (__TEST__) {\n        if (needsGlobalMessagingForBrowser() && isSameTopWindow(source, window) === false) {\n            return;\n        }\n    }\n\n    receiveMessage({ source, origin, data }, { on, send });\n}\n\nexport function listenForMessages({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore().getOrSet('postMessageListener', () => {\n        return addEventListener(window, 'message', event => {\n            // $FlowFixMe\n            messageListener(event, { on, send });\n        });\n    });\n}\n\nexport function stopListenForMessages() {\n    const listener = globalStore().get('postMessageListener');\n    if (listener) {\n        listener.cancel();\n    }\n}\n","/* @flow */\n\nexport * from './receive';\nexport * from './send';\nexport * from './listeners';\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nimport { addRequestListener, type RequestListenerType } from '../drivers';\nimport { WILDCARD } from '../conf';\nimport type { ServerOptionsType, HandlerType, CancelableType } from '../types';\n\nexport function on(name : string, options : ServerOptionsType | HandlerType, handler : ?HandlerType) : CancelableType {\n\n    if (!name) {\n        throw new Error('Expected name');\n    }\n\n    if (typeof options === 'function') {\n        handler = options;\n        // $FlowFixMe\n        options = {};\n    }\n\n    if (!handler) {\n        throw new Error('Expected handler');\n    }\n\n    options = options || {};\n    options.name = name;\n    options.handler = handler || options.handler;\n\n    const win = options.window;\n    const domain = options.domain;\n\n    const listenerOptions : RequestListenerType = {\n        handler:     options.handler,\n        handleError: options.errorHandler || (err => {\n            throw err;\n        }),\n        window: win,\n        domain: domain || WILDCARD,\n        name\n    };\n\n    const requestListener = addRequestListener({ name, win, domain }, listenerOptions);\n\n    return {\n        cancel() {\n            requestListener.cancel();\n        }\n    };\n}\n\nexport function once(name : string, options? : ServerOptionsType | HandlerType, handler? : HandlerType) : ZalgoPromise<{ source : mixed, origin : string, data : Object }> {\n    \n    // $FlowFixMe\n    options = options || {};\n    if (typeof options === 'function') {\n        handler = options;\n        // $FlowFixMe\n        options = {};\n    }\n\n    const promise = new ZalgoPromise();\n    let listener; // eslint-disable-line prefer-const\n\n    options.errorHandler = (err) => {\n        listener.cancel();\n        promise.reject(err);\n    };\n\n    listener = on(name, options, event => {\n        listener.cancel();\n        promise.resolve(event);\n        if (handler) {\n            return handler(event);\n        }\n    });\n\n    promise.cancel = listener.cancel;\n    return promise;\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isAncestor, isWindowClosed, getDomain, matchDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { uniqueID, isRegex, noop, safeInterval, stringify, stringifyError } from 'belter/src';\n\n\nimport { CHILD_WINDOW_TIMEOUT, MESSAGE_TYPE, WILDCARD, MESSAGE_NAME, ACK_TIMEOUT, RES_TIMEOUT, ACK_TIMEOUT_KNOWN, RESPONSE_CYCLE_TIME } from '../conf';\nimport { sendMessage, addResponseListener, deleteResponseListener, markResponseListenerErrored, type ResponseListenerType } from '../drivers';\nimport { awaitWindowHello, sayHello, isWindowKnown } from '../lib';\nimport { windowStore } from '../global';\nimport type { SendType } from '../types';\n\nimport { on } from './on';\n\nfunction validateOptions(name : string, win : CrossDomainWindowType, domain : ?DomainMatcher) {\n    if (!name) {\n        throw new Error('Expected name');\n    }\n\n    if (domain) {\n        if (typeof domain !== 'string' && !Array.isArray(domain) && !isRegex(domain)) {\n            throw new TypeError(`Expected domain to be a string, array, or regex`);\n        }\n    }\n\n    if (isWindowClosed(win)) {\n        throw new Error('Target window is closed');\n    }\n}\n\nfunction normalizeDomain(win : CrossDomainWindowType, targetDomain : DomainMatcher, actualDomain : ?string, { send } : { send : SendType }) : ZalgoPromise<string | $ReadOnlyArray<string>> {\n    if (typeof targetDomain === 'string') {\n        return ZalgoPromise.resolve(targetDomain);\n    }\n    \n    return ZalgoPromise.try(() => {\n        return actualDomain || sayHello(win, { send }).then(({ domain }) => domain);\n\n    }).then(normalizedDomain => {\n        if (!matchDomain(targetDomain, targetDomain)) {\n            throw new Error(`Domain ${ stringify(targetDomain) } does not match ${ stringify(targetDomain) }`);\n        }\n\n        return normalizedDomain;\n    });\n}\n\nexport const send : SendType = (win, name, data, options) => {\n    options = options || {};\n    let domain = options.domain || WILDCARD;\n    const responseTimeout = options.timeout || RES_TIMEOUT;\n    const childTimeout = options.timeout || CHILD_WINDOW_TIMEOUT;\n    const fireAndForget = options.fireAndForget || false;\n\n    // $FlowFixMe\n    return ZalgoPromise.try(() => {\n        validateOptions(name, win, domain);\n\n        if (isAncestor(window, win)) {\n            return awaitWindowHello(win, childTimeout);\n        }\n        \n    }).then(({ domain: actualDomain } = {}) => {\n\n        return normalizeDomain(win, domain, actualDomain, { send });\n    }).then(targetDomain => {\n\n        domain = targetDomain;\n\n        const logName = (name === MESSAGE_NAME.METHOD && data && typeof data.name === 'string') ? `${ data.name }()` : name;\n\n        if (__DEBUG__) {\n            console.info('send::req', logName, domain, '\\n\\n', data); // eslint-disable-line no-console\n        }\n\n        const promise = new ZalgoPromise();\n        const hash = `${ name }_${ uniqueID() }`;\n\n        if (!fireAndForget) {\n            const responseListener : ResponseListenerType = { name, win, domain, promise };\n            addResponseListener(hash, responseListener);\n\n            const reqPromises = windowStore('requestPromises').getOrSet(win, () => []);\n            reqPromises.push(promise);\n\n            promise.catch(() => {\n                markResponseListenerErrored(hash);\n                deleteResponseListener(hash);\n            });\n\n            const totalAckTimeout = isWindowKnown(win) ? ACK_TIMEOUT_KNOWN : ACK_TIMEOUT;\n            const totalResTimeout = responseTimeout;\n\n            let ackTimeout = totalAckTimeout;\n            let resTimeout = totalResTimeout;\n        \n            const interval = safeInterval(() => {\n                if (isWindowClosed(win)) {\n                    return promise.reject(new Error(`Window closed for ${ name } before ${ responseListener.ack ? 'response' : 'ack' }`));\n                }\n\n                if (responseListener.cancelled) {\n                    return promise.reject(new Error(`Response listener was cancelled for ${ name }`));\n                }\n\n                ackTimeout = Math.max(ackTimeout - RESPONSE_CYCLE_TIME, 0);\n                if (resTimeout !== -1) {\n                    resTimeout = Math.max(resTimeout - RESPONSE_CYCLE_TIME, 0);\n                }\n\n                if (!responseListener.ack && ackTimeout === 0) {\n                    return promise.reject(new Error(`No ack for postMessage ${ logName } in ${ getDomain() } in ${ totalAckTimeout }ms`));\n\n                } else if (resTimeout === 0) {\n                    return promise.reject(new Error(`No response for postMessage ${ logName } in ${ getDomain() } in ${ totalResTimeout }ms`));\n                }\n            }, RESPONSE_CYCLE_TIME);\n\n            promise.finally(() => {\n                interval.cancel();\n                reqPromises.splice(reqPromises.indexOf(promise, 1));\n            }).catch(noop);\n        }\n\n        try {\n            sendMessage(win, domain, {\n                type: MESSAGE_TYPE.REQUEST,\n                hash,\n                name,\n                data,\n                fireAndForget\n            }, { on, send });\n        } catch (err) {\n            throw new Error(`Send request message failed for ${ logName } in ${ getDomain() }\\n\\n${ stringifyError(err) }`);\n        }\n    \n        return fireAndForget ? promise.resolve() : promise;\n    });\n};\n","/* @flow */\n\nexport * from './on';\nexport * from './send';\n","/* @flow */\n\nimport type { CrossDomainWindowType, DomainMatcher } from 'cross-domain-utils/src';\n\nimport { initHello } from './lib';\nimport { listenForMessages, stopListenForMessages, receiveMessage, setupGlobalReceiveMessage, cancelResponseListeners } from './drivers';\nimport { getGlobal, deleteGlobal } from './global';\nimport { on, send } from './public';\nimport { setupBridge } from './bridge';\nimport { serializeMessage as internalSerializeMessage, deserializeMessage as internalDeserializeMessage, ProxyWindow } from './serialize';\n\nexport function serializeMessage<T>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, obj : T) : string {\n    return internalSerializeMessage(destination, domain, obj, { on, send });\n}\n\nexport function deserializeMessage<T : mixed>(source : CrossDomainWindowType | ProxyWindow, origin : string, message : string) : T {\n    return internalDeserializeMessage(source, origin, message, { on, send });\n}\n\nexport function createProxyWindow(win? : CrossDomainWindowType) : ProxyWindow {\n    return new ProxyWindow({ send, win });\n}\n\nexport function toProxyWindow(win : CrossDomainWindowType | ProxyWindow) : ProxyWindow {\n    return ProxyWindow.toProxyWindow(win, { send });\n}\n\nexport function setup() {\n    if (!getGlobal().initialized) {\n        getGlobal().initialized = true;\n    \n        setupGlobalReceiveMessage({ on, send });\n        listenForMessages({ on, send });\n    \n        if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n            setupBridge({ on, send, receiveMessage });\n        }\n\n        initHello({ on, send });\n    }\n}\n\nexport function destroy() {\n    cancelResponseListeners();\n    stopListenForMessages();\n    deleteGlobal();\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from 'zalgo-promise/src';\nimport type { CrossDomainWindowType, DomainMatcher } from 'cross-domain-utils/src';\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CancelableType = {\n    cancel : () => void\n};\n\nexport type ErrorHandlerType = (err : mixed) => void;\n\nexport type HandlerType = ({\n    source : CrossDomainWindowType,\n    origin : string,\n    data : any // eslint-disable-line flowtype/no-weak-types\n}) => (void | any | ZalgoPromise<any>); // eslint-disable-line flowtype/no-weak-types\n\nexport type ServerOptionsType = {|\n    handler? : ?HandlerType,\n    errorHandler? : ?ErrorHandlerType,\n    window? : CrossDomainWindowType,\n    name? : ?string,\n    domain? : ?DomainMatcher,\n    once? : ?boolean,\n    errorOnClose? : ?boolean\n|};\n\nexport type OnType = (\n    name : string,\n    options : ServerOptionsType | HandlerType,\n    handler : ?HandlerType\n) => CancelableType;\n\ntype RegularRequestOptionsType = {|\n    domain? : ?DomainMatcher,\n    fireAndForget? : false,\n    timeout? : ?number\n|};\n\ntype FireAndForgetRequestOptionsType = {|\n    domain? : ?DomainMatcher,\n    fireAndForget : true,\n    timeout? : ?number\n|};\n\nexport type RequestOptionsType = RegularRequestOptionsType | FireAndForgetRequestOptionsType;\n\nexport type ResponseMessageEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : Object\n|};\n\ntype RegularSendType = (\n    win : CrossDomainWindowType,\n    name : string,\n    data : ?Object,\n    options? : RegularRequestOptionsType\n) => ZalgoPromise<ResponseMessageEvent>;\n\ntype FireAndForgetSendType = (\n    win : CrossDomainWindowType,\n    name : string,\n    data : ?Object,\n    options? : FireAndForgetRequestOptionsType\n) => ZalgoPromise<void>;\n\nexport type SendType = RegularSendType & FireAndForgetSendType;\n\nexport type MessageEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : string\n|};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CrossDomainFunctionType<A, R> = {\n    (...args : A) : ZalgoPromise<R>,\n    fireAndForget : (...args : A) => ZalgoPromise<void>,\n    __id__? : string,\n    __name__? : string\n};\n\nexport type ReceiveMessageType = (MessageEvent, { on : OnType, send : SendType }) => void;\n","/* @flow */\n\nimport { type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { windowStore } from './global';\n\nexport function cleanUpWindow(win : CrossDomainWindowType) {\n    const requestPromises = windowStore('requestPromises');\n    for (const promise of requestPromises.get(win, [])) {\n        promise.reject(new Error(`Window cleaned up before response`)).catch(noop);\n    }\n}\n","/* @flow */\n\nimport { setup } from './setup';\nimport { setupBridge, openBridge, linkWindow, linkUrl, isBridge, needsBridge, needsBridgeForBrowser, hasBridge,\n    needsBridgeForWin, needsBridgeForDomain, destroyBridges } from './bridge';\n\nexport { ZalgoPromise as Promise } from 'zalgo-promise/src';\n\nexport * from './types';\nexport { ProxyWindow } from './serialize';\nexport { setup, destroy, serializeMessage, deserializeMessage, createProxyWindow, toProxyWindow } from './setup';\nexport { on, once, send } from './public';\nexport { markWindowKnown } from './lib';\nexport { cleanUpWindow } from './clean';\nexport let bridge;\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n    bridge = { setupBridge, openBridge, linkWindow, linkUrl, isBridge, needsBridge,\n        needsBridgeForBrowser, hasBridge, needsBridgeForWin, needsBridgeForDomain, destroyBridges };\n}\n\nif (__POST_ROBOT__.__AUTO_SETUP__) {\n    setup();\n}\n","/* @flow */\n\nimport { isSameDomain, type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nexport function getGlobal(win? : CrossDomainWindowType = window) : Object {\n\n    if (!isSameDomain(win)) {\n        throw new Error(`Can not get global for window on different domain`);\n    }\n\n    if (!win[__ZOID__.__GLOBAL_KEY__]) {\n        win[__ZOID__.__GLOBAL_KEY__] = {};\n    }\n\n    return win[__ZOID__.__GLOBAL_KEY__];\n}\n\nexport function destroyGlobal() {\n    delete window[__ZOID__.__GLOBAL_KEY__];\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nexport type ProxyObject<T> = {|\n    get : () => ZalgoPromise<T>\n|};\n\nexport function getProxyObject<T>(obj : T) : ProxyObject<T> {\n    return {\n        get() : ZalgoPromise<T> {\n            return ZalgoPromise.try(() => {\n                if (this.source && this.source !== window) {\n                    throw new Error(`Can not call get on proxy object from a remote window`);\n                }\n    \n                return obj;\n            });\n        }\n    };\n}\n","/* @flow */\n\nexport * from './global';\nexport * from './serialize';\n","/* @flow */\n\nimport { WINDOW_TYPE } from 'cross-domain-utils/src';\n\nexport const ZOID = `zoid`;\n\nexport const POST_MESSAGE = {\n    DELEGATE:       `${ ZOID }_delegate`,\n    ALLOW_DELEGATE: `${ ZOID }_allow_delegate`\n};\n\nexport const PROP_TYPE = {\n    STRING:   `string`,\n    OBJECT:   `object`,\n    FUNCTION: `function`,\n    BOOLEAN:  `boolean`,\n    NUMBER:   `number`,\n    ARRAY:    `array`\n};\n\nexport const INITIAL_PROPS = {\n    RAW: 'raw',\n    UID: 'uid'\n};\n\nexport const WINDOW_REFERENCES = {\n    OPENER: ('opener' : 'opener'),\n    PARENT: ('parent' : 'parent'),\n    GLOBAL: ('global' : 'global')\n};\n\nexport const PROP_SERIALIZATION = {\n    JSON:   ('json' : 'json'),\n    DOTIFY: ('dotify' : 'dotify'),\n    BASE64: ('base64' : 'base64')\n};\n\nexport const CONTEXT = WINDOW_TYPE;\n\nexport const WILDCARD = '*';\n\nexport const DEFAULT_DIMENSIONS = {\n    WIDTH:  '300px',\n    HEIGHT: '150px'\n};\n\nexport const EVENT = {\n    RENDER:   'zoid-render',\n    RENDERED: 'zoid-rendered',\n    DISPLAY:  'zoid-display',\n    ERROR:    'zoid-error',\n    CLOSE:    'zoid-close',\n    PROPS:    'zoid-props',\n    RESIZE:   'zoid-resize',\n    FOCUS:    'zoid-focus'\n};\n","/* @flow */\n\nimport { getDomain, isSameDomain, type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport type { Component } from '../component';\nimport type { PropsType, MixedPropDefinitionType } from '../component/props';\n\nimport type { ChildHelpers } from './index';\n\nexport function normalizeChildProp<T, P>(component : Component<P>, props : (PropsType<P>), key : string, value : T, helpers : ChildHelpers<P>) : ?T  {\n\n    // $FlowFixMe\n    const prop : MixedPropDefinitionType<P> = component.getPropDefinition(key);\n\n    if (!prop) {\n        return value;\n    }\n\n    if (typeof prop.childDecorate === 'function') {\n        const { close, focus, onError, onProps, resize, getParent, getParentDomain, show, hide } = helpers;\n        return prop.childDecorate({ value, close, focus, onError, onProps, resize, getParent, getParentDomain, show, hide });\n    }\n\n    return value;\n}\n\n// eslint-disable-next-line max-params\nexport function normalizeChildProps<P>(parentComponentWindow : CrossDomainWindowType, component : Component<P>, props : (PropsType<P>), origin : string, helpers : ChildHelpers<P>, isUpdate : boolean = false) : (PropsType<P>) {\n\n    const result = {};\n\n    for (const key of Object.keys(props)) {\n        const prop = component.getPropDefinition(key);\n\n        if (prop && prop.sameDomain && (origin !== getDomain(window) || !isSameDomain(parentComponentWindow))) {\n            continue;\n        }\n\n        // $FlowFixMe\n        const value = normalizeChildProp(component, props, key, props[key], helpers);\n\n        result[key] = value;\n        if (prop && prop.alias && !result[prop.alias]) {\n            result[prop.alias] = value;\n        }\n    }\n\n    if (!isUpdate) {\n        for (const key of component.getPropNames()) {\n            if (!props.hasOwnProperty(key)) {\n                result[key] = normalizeChildProp(component, props, key, props[key], helpers);\n            }\n        }\n    }\n\n    // $FlowFixMe\n    return result;\n}\n","/* @flow */\n\nimport { inlineMemoize, stringifyError, base64decode } from 'belter/src';\n\nimport { ZOID } from '../constants';\nimport type { ChildPayload } from '../parent';\n\nfunction parseChildWindowName(windowName : string) : ChildPayload {\n    return inlineMemoize(parseChildWindowName, () => {\n        if (!windowName) {\n            throw new Error(`No window name`);\n        }\n    \n        const [ , zoidcomp, name, encodedPayload ] = windowName.split('__');\n    \n        if (zoidcomp !== ZOID) {\n            throw new Error(`Window not rendered by zoid - got ${ zoidcomp }`);\n        }\n    \n        if (!name) {\n            throw new Error(`Expected component name`);\n        }\n    \n        if (!encodedPayload) {\n            throw new Error(`Expected encoded payload`);\n        }\n    \n        try {\n            return JSON.parse(base64decode(encodedPayload));\n        } catch (err) {\n            throw new Error(`Can not decode window name payload: ${ encodedPayload }: ${ stringifyError(err) }`);\n        }\n    }, [ windowName ]);\n}\n\nexport function getChildPayload() : ?ChildPayload {\n    try {\n        return parseChildWindowName(window.name);\n    } catch (err) {\n        // pass\n    }\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { isSameDomain, matchDomain, getDomain, getOpener,\n    getNthParentFromTop, getAncestor, getAllFramesInWindow,\n    type CrossDomainWindowType, onCloseWindow } from 'cross-domain-utils/src';\nimport { markWindowKnown, deserializeMessage, type CrossDomainFunctionType } from 'post-robot/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { extend, waitForDocumentBody, onResize, getElementSafe, assertExists } from 'belter/src';\n\nimport { getGlobal } from '../lib';\nimport { CONTEXT, INITIAL_PROPS, WINDOW_REFERENCES } from '../constants';\nimport type { Component } from '../component';\nimport type { PropsType } from '../component/props';\nimport type { WindowRef, PropRef, ParentExportsType } from '../parent';\n\nimport { normalizeChildProps } from './props';\nimport { getChildPayload } from './window';\n\nexport * from './window';\n\nexport type ChildExportsType<P> = {|\n    updateProps : CrossDomainFunctionType<[ PropsType<P> ], void>,\n    close : CrossDomainFunctionType<[], void>\n|};\n\nexport type ChildHelpers<P> = {|\n    close : () => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<void>,\n    resize : ({ width : ?number, height : ?number }) => ZalgoPromise<void>,\n    onError : (mixed) => ZalgoPromise<void>,\n    onProps : ((PropsType<P>) => void) => void,\n    getParent : () => CrossDomainWindowType,\n    getParentDomain : () => string,\n    show : () => ZalgoPromise<void>,\n    hide : () => ZalgoPromise<void>\n|};\n\n/*  Child Component\n    ---------------\n\n    This is the portion of code which runs inside the frame or popup window containing the component's implementation.\n\n    When the component author calls myComponent.attach(), it creates a new instance of ChildComponent, which is then\n    responsible for managing the state and messaging back up to the parent, and providing props for the component to\n    utilize.\n*/\n\nexport class ChildComponent<P> {\n\n    component : Component<P>\n    props : PropsType<P>\n    context : string\n    parent : ParentExportsType<P>\n    parentDomain : string\n    parentComponentWindow : CrossDomainWindowType\n\n    onPropHandlers : Array<(PropsType<P>) => void> // eslint-disable-line flowtype/no-mutable-array\n    autoResize : { width : boolean, height : boolean, element? : string }\n\n    constructor(component : Component<P>) {\n        ZalgoPromise.try(() => {\n            this.component = component;\n            this.onPropHandlers = [];\n            \n            const childPayload = getChildPayload();\n\n            if (!childPayload) {\n                throw new Error(`No child payload found`);\n            }\n\n            if (childPayload.version !== __ZOID__.__VERSION__) {\n                throw new Error(`Parent window has zoid version ${ childPayload.version }, child window has version ${ __ZOID__.__VERSION__ }`);\n            }\n\n            const { parent, parentDomain, exports, context, props } = childPayload;\n\n            this.context = context;\n            this.parentComponentWindow = this.getParentComponentWindow(parent);\n            this.parentDomain = parentDomain;\n            this.parent = deserializeMessage(this.parentComponentWindow, parentDomain, exports);\n\n            this.checkParentDomain(parentDomain);\n\n            const initialProps = this.getPropsByRef(this.parentComponentWindow, parentDomain, props);\n            this.setProps(initialProps, parentDomain);\n            markWindowKnown(this.parentComponentWindow);\n            \n            this.watchForClose();\n\n            return this.parent.init(this.buildExports());\n\n        }).then(() => {\n            return this.watchForResize();\n\n        }).catch(err => {\n            this.onError(err);\n        });\n    }\n\n    getHelpers() : ChildHelpers<P> {\n        return {\n            focus:           () => this.focus(),\n            close:           () => this.close(),\n            resize:          ({ width, height }) => this.resize({ width, height }),\n            onError:         (err) => this.onError(err),\n            onProps:         (handler) => this.onProps(handler),\n            getParent:       () => this.parentComponentWindow,\n            getParentDomain: () => this.parentDomain,\n            show:            () => this.show(),\n            hide:            () => this.hide()\n        };\n    }\n\n    show() : ZalgoPromise<void> {\n        return this.parent.show();\n    }\n\n    hide() : ZalgoPromise<void> {\n        return this.parent.hide();\n    }\n\n    checkParentDomain(domain : string) {\n        if (!matchDomain(this.component.allowedParentDomains, domain)) {\n            throw new Error(`Can not be rendered by domain: ${ domain }`);\n        }\n    }\n\n    onProps(handler : Function) {\n        this.onPropHandlers.push(handler);\n    }\n\n    getPropsByRef(parentComponentWindow : CrossDomainWindowType, domain : string, { type, value, uid } : PropRef) : (PropsType<P>) {\n        let props;\n\n        if (type === INITIAL_PROPS.RAW) {\n            props = value;\n        } else if (type === INITIAL_PROPS.UID) {\n            if (!isSameDomain(parentComponentWindow)) {\n                throw new Error(`Parent component window is on a different domain - expected ${ getDomain() } - can not retrieve props`);\n            }\n\n            const global = getGlobal(parentComponentWindow);\n            props = assertExists('props', global && global.props[uid]);\n        }\n\n        if (!props) {\n            throw new Error(`Could not find props`);\n        }\n\n        return deserializeMessage(parentComponentWindow, domain, props);\n    }\n\n    getParentComponentWindow(ref : WindowRef) : CrossDomainWindowType {\n        const { type } = ref;\n    \n        if (type === WINDOW_REFERENCES.OPENER) {\n            return assertExists('opener', getOpener(window));\n    \n        } else if (type === WINDOW_REFERENCES.PARENT && typeof ref.distance === 'number') {\n            return assertExists('parent', getNthParentFromTop(window, ref.distance));\n\n        } else if (type === WINDOW_REFERENCES.GLOBAL && ref.uid && typeof ref.uid === 'string') {\n            const { uid } = ref;\n            const ancestor = getAncestor(window);\n\n            if (!ancestor) {\n                throw new Error(`Can not find ancestor window`);\n            }\n\n            for (const frame of getAllFramesInWindow(ancestor)) {\n                if (isSameDomain(frame)) {\n                    const global = getGlobal(frame);\n\n                    if (global && global.windows && global.windows[uid]) {\n                        return global.windows[uid];\n                    }\n                }\n            }\n        }\n    \n        throw new Error(`Unable to find ${ type } parent component window`);\n    }\n\n    getProps() : PropsType<P> {\n        // $FlowFixMe\n        this.props = this.props || {};\n        return this.props;\n    }\n\n    setProps(props : PropsType<P>, origin : string, isUpdate : boolean = false) {\n        const helpers = this.getHelpers();\n        const existingProps = this.getProps();\n        const normalizedProps = normalizeChildProps(this.parentComponentWindow, this.component, props, origin, helpers, isUpdate);\n\n        extend(existingProps, normalizedProps);\n\n        for (const handler of this.onPropHandlers) {\n            handler.call(this, existingProps);\n        }\n    }\n\n    watchForClose() {\n        window.addEventListener('beforeunload', () => {\n            this.parent.checkClose.fireAndForget();\n        });\n\n        window.addEventListener('unload', () => {\n            this.parent.checkClose.fireAndForget();\n        });\n\n        onCloseWindow(this.parentComponentWindow, () => {\n            this.destroy();\n        });\n    }\n\n    getAutoResize() : { width : boolean, height : boolean, element : ?HTMLElement } {\n        let { width = false, height = false, element = 'body' } = this.autoResize || this.component.autoResize || {};\n        element = getElementSafe(element);\n        return { width, height, element };\n    }\n\n    watchForResize() : ?ZalgoPromise<void> {\n        return waitForDocumentBody().then(() => {\n            const { width, height, element } = this.getAutoResize();\n\n            if (!element || (!width && !height) || this.context === CONTEXT.POPUP) {\n                return;\n            }\n\n            onResize(element, ({ width: newWidth, height: newHeight }) => {\n                this.resize({\n                    width:  width ? newWidth : undefined,\n                    height: height ? newHeight : undefined\n                });\n            }, { width, height });\n        });\n    }\n\n    buildExports() : ChildExportsType<P> {\n\n        const self = this;\n\n        return {\n            updateProps(props : (PropsType<P>)) : ZalgoPromise<void> {\n                return ZalgoPromise.try(() => self.setProps(props, this.__origin__, true));\n            },\n\n            close() : ZalgoPromise<void> {\n                return ZalgoPromise.try(() => self.destroy());\n            }\n        };\n    }\n\n    resize({ width, height } : { width : ?number, height : ?number }) : ZalgoPromise<void> {\n        return this.parent.resize.fireAndForget({ width, height });\n    }\n\n    close() : ZalgoPromise<void> {\n        return this.parent.close();\n    }\n    \n    destroy() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            window.close();\n        });\n    }\n\n    focus() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            window.focus();\n        });\n    }\n\n    onError(err : mixed) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            if (this.parent && this.parent.onError) {\n                return this.parent.onError(err);\n            } else {\n                throw err;\n            }\n        });\n    }\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { cleanUpWindow, ProxyWindow, toProxyWindow } from 'post-robot/src';\nimport { assertSameDomain, closeWindow, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { iframe, popup, destroyElement, normalizeDimension, watchElementForClose,\n    awaitFrameWindow, uniqueID } from 'belter/src';\n\nimport { CONTEXT } from '../constants';\nimport { getProxyObject, type ProxyObject } from '../lib';\n\n\nexport type ContextDriverType = {|\n    openFrame? : ({ windowName : string }) => ProxyObject<HTMLIFrameElement>,\n    open : ({ windowName : string, proxyFrame : ?ProxyObject<HTMLIFrameElement> }) => ZalgoPromise<CrossDomainWindowType>,\n    openPrerenderFrame? : () => ProxyObject<HTMLIFrameElement>,\n    openPrerender : (ProxyWindow, ?ProxyObject<HTMLIFrameElement>) => ZalgoPromise<ProxyWindow>,\n    resize? : ({ width : ?number, height : ?number }) => void,\n    delegate : $ReadOnlyArray<string>\n|};\n\nexport const RENDER_DRIVERS : { [string] : ContextDriverType } = {};\n\nRENDER_DRIVERS[CONTEXT.IFRAME] = {\n    openFrame({ windowName } : { windowName : string }) : ProxyObject<HTMLIFrameElement> {\n        return getProxyObject(iframe({\n            attributes: {\n                name:  windowName,\n                title: this.component.name,\n                ...this.component.attributes.iframe\n            }\n        }));\n    },\n\n    open({ proxyFrame } : { proxyFrame : ?ProxyObject<HTMLIFrameElement> }) : ZalgoPromise<CrossDomainWindowType> {\n        if (!proxyFrame) {\n            throw new Error(`Expected proxy frame to be passed`);\n        }\n\n        return proxyFrame.get().then(frame => {\n            return awaitFrameWindow(frame).then(win => {\n\n                const frameWatcher = watchElementForClose(frame, () => this.close());\n                this.clean.register(() => frameWatcher.cancel());\n                this.clean.register(() => destroyElement(frame));\n                this.clean.register(() => cleanUpWindow(win));\n\n                return win;\n            });\n        });\n    },\n\n    openPrerenderFrame() : ProxyObject<HTMLIFrameElement> {\n        return getProxyObject(iframe({\n            attributes: {\n                name:  `__zoid_prerender_frame__${ this.component.name }_${ uniqueID() }__`,\n                title: `prerender__${ this.component.name }`,\n                ...this.component.attributes.iframe\n            }\n        }));\n    },\n\n    openPrerender(proxyWin : ProxyWindow, proxyPrerenderFrame : ?ProxyObject<HTMLIFrameElement>) : ZalgoPromise<ProxyWindow> {\n        if (!proxyPrerenderFrame) {\n            throw new Error(`Expected proxy frame to be passed`);\n        }\n        \n        return proxyPrerenderFrame.get().then(prerenderFrame => {\n            this.clean.register(() => destroyElement(prerenderFrame));\n\n            return awaitFrameWindow(prerenderFrame).then(prerenderFrameWindow => {\n                return assertSameDomain(prerenderFrameWindow);\n            }).then(win => {\n                return toProxyWindow(win);\n            });\n        });\n    },\n\n    delegate: [\n        'getProxyWindow',\n        'getProxyContainer',\n        'renderContainer',\n        'openFrame',\n        'openPrerenderFrame',\n        'prerender',\n        'open',\n        'openPrerender',\n        'show',\n        'hide'\n    ]\n};\n\nif (__ZOID__.__POPUP_SUPPORT__) {\n    RENDER_DRIVERS[CONTEXT.POPUP] = {\n        open({ windowName } : { windowName : string }) : ZalgoPromise<CrossDomainWindowType> {\n            return ZalgoPromise.try(() => {\n                let { width, height } = this.component.dimensions;\n\n                width = normalizeDimension(width, window.outerWidth);\n                height = normalizeDimension(height, window.outerWidth);\n\n                const win = popup('', {\n                    name: windowName,\n                    width,\n                    height,\n                    ...this.component.attributes.popup\n                });\n\n                this.clean.register(() => {\n                    closeWindow(win);\n                    cleanUpWindow(win);\n                });\n\n                return win;\n            });\n        },\n\n        openPrerender(proxyWin : ProxyWindow) : ZalgoPromise<ProxyWindow> {\n            return ZalgoPromise.try(() => {\n                return proxyWin;\n            });\n        },\n\n        delegate: [\n            'getProxyContainer',\n            'renderContainer',\n            'setProxyWin',\n            'show',\n            'hide'\n        ]\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { dotify, isDefined, extend } from 'belter/src';\n\nimport type { Component } from '../component';\nimport type { BuiltInPropsDefinitionType, PropsInputType, PropsType, MixedPropDefinitionType } from '../component/props';\nimport { PROP_SERIALIZATION } from '../constants';\n\nimport type { ParentHelpers } from './index';\n\n/*  Normalize Props\n    ---------------\n\n    Turn props into normalized values, using defaults, function options, etc.\n*/\n\nexport function extendProps<P>(component : Component<P>, props : PropsType<P>, inputProps : PropsInputType<P>, helpers : ParentHelpers<P>, isUpdate : boolean = false) { // eslint-disable-line complexity\n\n    // $FlowFixMe\n    inputProps = inputProps || {};\n    extend(props, inputProps);\n\n    const propNames = isUpdate ? [] : [ ...component.getPropNames() ];\n\n    for (const key of Object.keys(inputProps)) {\n        if (propNames.indexOf(key) === -1) {\n            propNames.push(key);\n        }\n    }\n\n    const aliases = [];\n\n    const { state, close, focus, event, onError } = helpers;\n\n    for (const key of propNames) {\n        const propDef = component.getPropDefinition(key);\n        let value = inputProps[key];\n\n        if (!propDef) {\n            continue;\n        }\n\n        const alias = propDef.alias;\n        if (alias) {\n            if (!isDefined(value) && isDefined(inputProps[alias])) {\n                value = inputProps[alias];\n            }\n            aliases.push(alias);\n        }\n\n        if (propDef.value) {\n            value = propDef.value({ props, state, close, focus, event, onError });\n        }\n\n        if (!isDefined(value) && propDef.default) {\n            value = propDef.default({ props, state, close, focus, event, onError });\n        }\n\n        if (isDefined(value)) {\n            if (propDef.type === 'array' ? !Array.isArray(value) : (typeof value !== propDef.type)) {\n                throw new TypeError(`Prop is not of type ${ propDef.type }: ${ key }`);\n            }\n        }\n        \n        // $FlowFixMe\n        props[key] = value;\n    }\n\n    for (const alias of aliases) {\n        delete props[alias];\n    }\n\n    // $FlowFixMe\n    for (const key of Object.keys(props)) {\n        const propDef = component.getPropDefinition(key);\n        const value = props[key];\n\n        if (!propDef) {\n            continue;\n        }\n\n        if (isDefined(value) && propDef.validate) {\n            // $FlowFixMe\n            propDef.validate({ value, props });\n        }\n\n        if (isDefined(value) && propDef.decorate) {\n            props[key] = propDef.decorate({ value, props, state, close, focus, event, onError });\n        }\n    }\n\n    for (const key of component.getPropNames()) {\n        const propDef = component.getPropDefinition(key);\n        if (propDef.required !== false && !isDefined(props[key])) {\n            throw new Error(`Expected prop \"${ key }\" to be defined`);\n        }\n    }\n}\n\n// $FlowFixMe\nfunction getQueryParam<T, P>(prop : MixedPropDefinitionType<P>, key : string, value : T) : ZalgoPromise<string> {\n    return ZalgoPromise.try(() => {\n        if (typeof prop.queryParam === 'function') {\n            return prop.queryParam({ value });\n        } else if (typeof prop.queryParam === 'string') {\n            return prop.queryParam;\n        } else {\n            return key;\n        }\n    });\n}\n\n// $FlowFixMe\nfunction getQueryValue<T, P>(prop : MixedPropDefinitionType<P>, key : string, value : T) : ZalgoPromise<mixed> {\n    return ZalgoPromise.try(() => {\n        if (typeof prop.queryValue === 'function' && isDefined(value)) {\n            return prop.queryValue({ value });\n        } else {\n            return value;\n        }\n    });\n}\n\nexport function propsToQuery<P>(propsDef : BuiltInPropsDefinitionType<P>, props : (PropsType<P>)) : ZalgoPromise<{ [string] : string }> {\n\n    const params = {};\n\n    // $FlowFixMe\n    const keys = Object.keys(props);\n    \n    return ZalgoPromise.all(keys.map(key => {\n\n        const prop = propsDef[key];\n\n        if (!prop) {\n            return; // eslint-disable-line array-callback-return\n        }\n\n        return ZalgoPromise.resolve().then(() => {\n\n            const value = props[key];\n\n            if (!value) {\n                return;\n            }\n\n            if (!prop.queryParam) {\n                return;\n            }\n\n            return value;\n\n        }).then(value => {\n\n            if (value === null || typeof value === 'undefined') {\n                return;\n            }\n\n            return ZalgoPromise.all([\n                getQueryParam(prop, key, value),\n                getQueryValue(prop, key, value)\n            ]).then(([ queryParam, queryValue ]) => {\n\n                let result;\n\n                if (typeof queryValue === 'boolean') {\n                    result = queryValue.toString();\n                } else if (typeof queryValue === 'string') {\n                    result = queryValue.toString();\n                } else if (typeof queryValue === 'object' && queryValue !== null) {\n\n                    if (prop.serialization === PROP_SERIALIZATION.JSON) {\n                        result = JSON.stringify(queryValue);\n                    } else if (prop.serialization === PROP_SERIALIZATION.BASE64) {\n                        result = btoa(JSON.stringify(queryValue));\n                    } else if (prop.serialization === PROP_SERIALIZATION.DOTIFY || !prop.serialization) {\n                        result = dotify(queryValue, key);\n\n                        for (const dotkey of Object.keys(result)) {\n                            params[dotkey] = result[dotkey];\n                        }\n\n                        return;\n                    }\n\n                } else if (typeof queryValue === 'number') {\n                    result = queryValue.toString();\n                }\n\n                params[queryParam] = result;\n            });\n        });\n\n    })).then(() => {\n        return params;\n    });\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { send, bridge, serializeMessage, ProxyWindow, toProxyWindow, type CrossDomainFunctionType } from 'post-robot/src';\nimport { isSameDomain, matchDomain, getDomainFromUrl, isBlankDomain,\n    getDomain, type CrossDomainWindowType,\n    getDistanceFromTop, normalizeMockUrl, assertSameDomain } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { addEventListener, uniqueID, elementReady, writeElementToWindow, eventEmitter, type EventEmitterType,\n    noop, onResize, extendUrl, appendChild, cleanup, type CleanupType, base64encode,\n    once, stringifyError, destroyElement, getElementSafe, showElement, hideElement } from 'belter/src';\n\nimport { ZOID, POST_MESSAGE, CONTEXT, EVENT,\n    INITIAL_PROPS, WINDOW_REFERENCES } from '../constants';\nimport type { Component, onErrorPropType } from '../component';\nimport { getGlobal, getProxyObject, type ProxyObject } from '../lib';\nimport type { PropsInputType, PropsType } from '../component/props';\nimport type { ChildExportsType } from '../child';\nimport type { DimensionsType } from '../types';\n\nimport { RENDER_DRIVERS, type ContextDriverType } from './drivers';\nimport { propsToQuery, extendProps } from './props';\n\nexport type RenderOptionsType<P> = {|\n    uid : string,\n    props : PropsInputType<P>,\n    tag : string,\n    context : string,\n    close : (?string) => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<ProxyWindow>,\n    doc : Document,\n    container? : HTMLElement,\n    dimensions : DimensionsType,\n    state : Object,\n    event : EventEmitterType,\n    frame : ?HTMLIFrameElement,\n    prerenderFrame : ?HTMLIFrameElement\n|};\n\nexport type ParentExportsType<P> = {|\n    init : (ChildExportsType<P>) => ZalgoPromise<void>,\n    close : () => ZalgoPromise<void>,\n    checkClose : CrossDomainFunctionType<[], void>,\n    resize : CrossDomainFunctionType<[{ width? : ?number, height? : ?number }], void>,\n    onError : (mixed) => ZalgoPromise<void>,\n    show : () => ZalgoPromise<void>,\n    hide : () => ZalgoPromise<void>\n|};\n\nexport type PropRef =\n    {| type : typeof INITIAL_PROPS.RAW, uid? : string, value? : string |};\n\nexport type WindowRef =\n    {| type : typeof WINDOW_REFERENCES.OPENER |} |\n    {| type : typeof WINDOW_REFERENCES.PARENT, distance : number |} |\n    {| type : typeof WINDOW_REFERENCES.GLOBAL, uid : string |};\n\nexport type ChildPayload = {|\n    uid : string,\n    tag : string,\n    version : string,\n    context : $Values<typeof CONTEXT>,\n    parentDomain : string,\n    childDomain : string,\n    parent : WindowRef,\n    props : PropRef,\n    exports : string\n|};\n\nexport type StateType = Object;\n\nexport type ParentHelpers<P> = {|\n    state : StateType,\n    close : () => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<void>,\n    resize : ({ width : ?number, height : ?number }) => ZalgoPromise<void>,\n    onError : (mixed) => ZalgoPromise<void>,\n    updateProps : PropsInputType<P> => ZalgoPromise<void>,\n    event : EventEmitterType,\n    show : () => ZalgoPromise<void>,\n    hide : () => ZalgoPromise<void>\n|};\n\nexport class ParentComponent<P> {\n\n    component : Component<P>\n    driver : ContextDriverType\n    clean : CleanupType\n    event : EventEmitterType\n\n    initPromise : ZalgoPromise<void>\n    handledErrors : Array<mixed> // eslint-disable-line flowtype/no-mutable-array\n    \n    props : PropsType<P>\n    state : StateType\n    child : ?ChildExportsType<P>\n\n    proxyContainer : ?ProxyObject<HTMLElement>\n    proxyWin : ?ProxyWindow\n\n    visible : boolean = true\n\n    constructor(component : Component<P>, props : PropsInputType<P>) {\n        this.initPromise = new ZalgoPromise();\n        this.handledErrors = [];\n\n        // $FlowFixMe\n        this.props = {};\n\n        this.clean = cleanup(this);\n        this.state = {};\n\n        this.component = component;\n\n        this.setupEvents(props.onError);\n        this.setProps(props);\n        this.component.registerActiveComponent(this);\n        this.clean.register(() => this.component.destroyActiveComponent(this));\n        this.watchForUnload();\n    }\n\n    setupEvents(onError : ?onErrorPropType) {\n        this.event = eventEmitter();\n        \n        this.event.on(EVENT.RENDER,   () => this.props.onRender());\n        this.event.on(EVENT.DISPLAY,  () => this.props.onDisplay());\n        this.event.on(EVENT.RENDERED, () => this.props.onRendered());\n        this.event.on(EVENT.CLOSE,    () => this.props.onClose());\n        this.event.on(EVENT.RESIZE,   () => this.props.onResize());\n        this.event.on(EVENT.FOCUS,    () => this.props.onFocus());\n        this.event.on(EVENT.PROPS,    (props) => this.props.onProps(props));\n\n        this.event.on(EVENT.ERROR, err => {\n            if (this.props && this.props.onError) {\n                return this.props.onError(err);\n            } else if (onError) {\n                return onError(err);\n            } else {\n                return this.initPromise.reject(err).then(() => {\n                    setTimeout(() => {\n                        throw err;\n                    }, 1);\n                });\n            }\n        });\n\n        this.clean.register(() => this.event.reset());\n    }\n\n    render(target : CrossDomainWindowType, container : string | HTMLElement, context : $Values<typeof CONTEXT>) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.component.log(`render`);\n\n            this.driver = RENDER_DRIVERS[context];\n            const uid = `${ ZOID }-${ this.component.tag }-${ uniqueID() }`;\n            const domain = this.getDomain();\n            const childDomain = this.getChildDomain();\n            \n            this.component.checkAllowRender(target, domain, container);\n\n            if (target !== window) {\n                this.delegate(context, target);\n            }\n\n            const windowProp = this.props.window;\n\n            const init = this.initPromise;\n            const buildUrl = this.buildUrl();\n            const onRender = this.event.trigger(EVENT.RENDER);\n\n            const getProxyContainer = this.getProxyContainer(container);\n            const getProxyWindow = this.getProxyWindow();\n\n            const buildWindowName = getProxyWindow.then(proxyWin => {\n                return this.buildWindowName({ proxyWin, childDomain, domain, target, context, uid });\n            });\n\n            const openFrame = buildWindowName.then(windowName => this.openFrame({ windowName }));\n            const openPrerenderFrame = this.openPrerenderFrame();\n\n            const renderContainer = ZalgoPromise.hash({ proxyContainer: getProxyContainer, proxyFrame: openFrame, proxyPrerenderFrame: openPrerenderFrame }).then(({ proxyContainer, proxyFrame, proxyPrerenderFrame }) => {\n                return this.renderContainer(proxyContainer, { context, uid, proxyFrame, proxyPrerenderFrame, visible: this.visible });\n            }).then(proxyContainer => {\n                this.proxyContainer = proxyContainer;\n                return proxyContainer;\n            });\n\n            const open = ZalgoPromise.hash({ windowName: buildWindowName, proxyFrame: openFrame, proxyWin: getProxyWindow }).then(({ windowName, proxyWin, proxyFrame }) => {\n                return windowProp\n                    ? proxyWin\n                    : this.open({ windowName, proxyWin, proxyFrame });\n            });\n\n            const openPrerender = ZalgoPromise.hash({ proxyWin: open, proxyPrerenderFrame: openPrerenderFrame }).then(({ proxyWin, proxyPrerenderFrame }) => {\n                return this.openPrerender(proxyWin, proxyPrerenderFrame);\n            });\n\n            const setState = open.then(proxyWin => {\n                this.proxyWin = proxyWin;\n                return this.setProxyWin(proxyWin);\n            });\n            \n            const prerender = ZalgoPromise.hash({ proxyPrerenderWin: openPrerender, state: setState }).then(({ proxyPrerenderWin }) => {\n                return this.prerender(proxyPrerenderWin, { context, uid });\n            });\n\n            const setWindowName =  ZalgoPromise.hash({ proxyWin: open, windowName: buildWindowName }).then(({ proxyWin, windowName }) => {\n                if (windowProp) {\n                    return proxyWin.setName(windowName);\n                }\n            });\n\n            const loadUrl = ZalgoPromise.hash({ proxyWin: open, url: buildUrl, windowName: setWindowName, prerender }).then(({ proxyWin, url }) => {\n                return proxyWin.setLocation(url);\n            });\n\n            const watchForClose = open.then(proxyWin => {\n                this.watchForClose(proxyWin);\n            });\n\n            const onDisplay = ZalgoPromise.hash({ container: renderContainer, prerender }).then(() => {\n                return this.event.trigger(EVENT.DISPLAY);\n            });\n\n            const openBridge = open.then(proxyWin => {\n                return this.openBridge(proxyWin, childDomain, context);\n            });\n\n            const runTimeout = loadUrl.then(() => {\n                return this.runTimeout();\n            });\n\n            const onRendered = init.then(() => {\n                return this.event.trigger(EVENT.RENDERED);\n            });\n\n            return ZalgoPromise.hash({\n                init, buildUrl, onRender, getProxyContainer, openFrame, openPrerenderFrame, renderContainer, open,\n                openPrerender, setState, prerender, loadUrl, buildWindowName, setWindowName, watchForClose, onDisplay,\n                openBridge, runTimeout, onRendered\n            });\n            \n        }).catch(err => {\n            return ZalgoPromise.all([\n                this.onError(err),\n                this.destroy(err)\n            ]).then(() => {\n                throw err;\n            }, () => {\n                throw err;\n            });\n        }).then(noop);\n    }\n\n    getProxyWindow() : ZalgoPromise<ProxyWindow> {\n        return ZalgoPromise.try(() => {\n            const windowProp = this.props.window;\n\n            if (windowProp) {\n                const proxyWin = toProxyWindow(windowProp);\n                this.clean.register(() => windowProp.close());\n                return proxyWin;\n            }\n\n            return new ProxyWindow({ send });\n        });\n    }\n\n    getProxyContainer(container : string | HTMLElement) : ZalgoPromise<ProxyObject<HTMLElement>> {\n        return ZalgoPromise.try(() => {\n            return elementReady(container);\n        }).then(containerElement => {\n            return getProxyObject(containerElement);\n        });\n    }\n\n    buildWindowName({ proxyWin, childDomain, domain, target, uid, context } : { proxyWin : ProxyWindow, childDomain : string, domain : string | RegExp, target : CrossDomainWindowType, context : $Values<typeof CONTEXT>, uid : string }) : string {\n        const childPayload = this.buildChildPayload({ proxyWin, childDomain, domain, target, context, uid });\n        return `__${ ZOID }__${ this.component.name }__${ base64encode(JSON.stringify(childPayload)) }__`;\n    }\n\n    getPropsRef(proxyWin : ProxyWindow, childDomain : string, domain : string | RegExp, uid : string) : PropRef {\n        const value = serializeMessage(proxyWin, domain, this.getPropsForChild(domain));\n\n        const propRef = (childDomain === getDomain())\n            ? { type: INITIAL_PROPS.UID, uid }\n            : { type: INITIAL_PROPS.RAW, value };\n\n        if (propRef.type === INITIAL_PROPS.UID) {\n            const global = getGlobal(window);\n            global.props = global.props || {};\n            global.props[uid] = value;\n\n            this.clean.register(() => {\n                delete global.props[uid];\n            });\n        }\n\n        return propRef;\n    }\n\n    buildChildPayload({ proxyWin, childDomain, domain, target = window, context, uid } : { proxyWin : ProxyWindow, childDomain : string, domain : string | RegExp, target : CrossDomainWindowType, context : $Values<typeof CONTEXT>, uid : string } = {}) : ChildPayload {\n        return {\n            uid,\n            context,\n            version:      __ZOID__.__VERSION__,\n            childDomain,\n            parentDomain: getDomain(window),\n            tag:          this.component.tag,\n            parent:       this.getWindowRef(target, childDomain, uid, context),\n            props:        this.getPropsRef(proxyWin, childDomain, domain, uid),\n            exports:      serializeMessage(proxyWin, domain, this.buildParentExports(proxyWin))\n        };\n    }\n\n    setProxyWin(proxyWin : ProxyWindow) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.proxyWin = proxyWin;\n        });\n    }\n\n    getHelpers() : ParentHelpers<P> {\n        return {\n            state:       this.state,\n            event:       this.event,\n            close:       () => this.close(),\n            focus:       () => this.focus(),\n            resize:      ({ width, height }) => this.resize({ width, height }),\n            onError:     (err) => this.onError(err),\n            updateProps: (props) => this.updateProps(props),\n            show:        () => this.show(),\n            hide:        () => this.hide()\n        };\n    }\n\n    show() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.visible = true;\n            if (this.proxyContainer) {\n                return this.proxyContainer.get()\n                    .then(showElement);\n            }\n        });\n    }\n\n    hide() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.visible = false;\n            if (this.proxyContainer) {\n                return this.proxyContainer.get()\n                    .then(hideElement);\n            }\n        });\n    }\n\n    setProps(props : PropsInputType<P>, isUpdate : boolean = false) {\n        if (this.component.validate) {\n            this.component.validate({ props });\n        }\n\n        const helpers = this.getHelpers();\n        extendProps(this.component, this.props, props, helpers, isUpdate);\n    }\n\n    buildUrl() : ZalgoPromise<string> {\n        return propsToQuery({ ...this.component.props, ...this.component.builtinProps }, this.props).then(query => {\n            return extendUrl(normalizeMockUrl(this.component.getUrl(this.props)), { query });\n        });\n    }\n\n    getDomain() : string | RegExp {\n        return this.component.getDomain(this.props);\n    }\n\n    getChildDomain() : string {\n        return this.component.getChildDomain(this.props);\n    }\n\n    getPropsForChild(domain : string | RegExp) : (PropsType<P>) {\n        const result = {};\n\n        for (const key of Object.keys(this.props)) {\n            const prop = this.component.getPropDefinition(key);\n\n            if (prop && prop.sendToChild === false) {\n                continue;\n            }\n\n            if (prop && prop.sameDomain && !matchDomain(domain, getDomain(window))) {\n                continue;\n            }\n            \n            result[key] = this.props[key];\n        }\n\n        // $FlowFixMe\n        return result;\n    }\n\n    updateProps(props : PropsInputType<P>) : ZalgoPromise<void> {\n        this.setProps(props, true);\n\n        return this.initPromise.then(() => {\n            if (this.child) {\n                return this.child.updateProps(this.getPropsForChild(this.getDomain())).catch(err => {\n                    if (!this.child || !this.proxyWin) {\n                        return;\n                    }\n\n                    return this.checkClose(this.proxyWin).then(() => {\n                        if (this.child) {\n                            throw err;\n                        }\n                    });\n                });\n            }\n        });\n    }\n\n    openFrame({ windowName } : { windowName : string }) : ZalgoPromise<?ProxyObject<HTMLIFrameElement>> {\n        return ZalgoPromise.try(() => {\n            if (this.driver.openFrame) {\n                return this.driver.openFrame.call(this, { windowName });\n            }\n        });\n    }\n\n    openPrerenderFrame() : ZalgoPromise<?ProxyObject<HTMLIFrameElement>> {\n        return ZalgoPromise.try(() => {\n            if (this.driver.openPrerenderFrame) {\n                return this.driver.openPrerenderFrame.call(this);\n            }\n        });\n    }\n    \n    open({ proxyWin, proxyFrame, windowName } : { proxyWin : ProxyWindow, proxyFrame : ?ProxyObject<HTMLIFrameElement>, windowName : string }) : ZalgoPromise<ProxyWindow> {\n        return ZalgoPromise.try(() => {\n            this.component.log(`open`);\n\n            return this.driver.open.call(this, { windowName, proxyFrame }).then(win => {\n                proxyWin.setWindow(win, { send });\n                return proxyWin;\n            });\n        });\n    }\n\n    openPrerender(proxyWin : ProxyWindow, proxyPrerenderFrame : ?ProxyObject<HTMLIFrameElement>) : ZalgoPromise<ProxyWindow> {\n        return ZalgoPromise.try(() => {\n            return this.driver.openPrerender.call(this, proxyWin, proxyPrerenderFrame);\n        });\n    }\n\n    focus() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            const proxyWin = this.proxyWin;\n            if (proxyWin) {\n                this.event.trigger(EVENT.FOCUS);\n                return proxyWin.focus().then(noop);\n            }\n        });\n    }\n\n    delegate(context : $Values<typeof CONTEXT>, target : CrossDomainWindowType) {\n        this.component.log(`delegate`);\n\n        const props = {};\n        for (const propName of this.component.getPropNames()) {\n            if (this.component.getPropDefinition(propName).allowDelegate) {\n                props[propName] = this.props[propName];\n            }\n        }\n\n        const overridesPromise = send(target, `${ POST_MESSAGE.DELEGATE }_${ this.component.name }`, {\n            context,\n            props,\n            overrides: {\n                event:   this.event,\n                close:   () => this.close(),\n                onError: (err) => this.onError(err)\n            }\n\n        }).then(({ data }) => {\n            this.clean.register(data.destroy);\n            return data.overrides;\n\n        }).catch(err => {\n            throw new Error(`Unable to delegate rendering. Possibly the component is not loaded in the target window.\\n\\n${ stringifyError(err) }`);\n        });\n\n        for (const key of this.driver.delegate) {\n            // $FlowFixMe\n            this[key] = function overriddenFunction() : ZalgoPromise<mixed> {\n                return overridesPromise.then(overrides => {\n                    return overrides[key].apply(this, arguments);\n                });\n            };\n        }\n    }\n\n    getWindowRef(target : CrossDomainWindowType, domain : string, uid : string, context : $Values<typeof CONTEXT>) : WindowRef {\n        \n        if (domain === getDomain(window)) {\n            const global = getGlobal(window);\n            global.windows = global.windows || {};\n            global.windows[uid] = window;\n            this.clean.register(() => {\n                delete global.windows[uid];\n            });\n    \n            return { type: WINDOW_REFERENCES.GLOBAL, uid };\n        }\n\n        if (context === CONTEXT.POPUP) {\n            return { type: WINDOW_REFERENCES.OPENER };\n        }\n\n        return { type: WINDOW_REFERENCES.PARENT, distance: getDistanceFromTop(window) };\n    }\n\n    watchForClose(proxyWin : ProxyWindow) : ZalgoPromise<void> {\n        let cancelled = false;\n\n        this.clean.register(() => {\n            cancelled = true;\n        });\n\n        return ZalgoPromise.delay(2000).then(() => {\n            return proxyWin.isClosed();\n        }).then(isClosed => {\n            if (isClosed) {\n                this.component.log(`detect_close_child`);\n                return this.close();\n            } else if (!cancelled) {\n                return this.watchForClose(proxyWin);\n            }\n        });\n    }\n\n    watchForUnload() {\n        const unloadWindowListener = addEventListener(window, 'unload', once(() => {\n            this.component.log(`navigate_away`);\n            this.destroy(new Error(`Window navigated away`));\n        }));\n\n        this.clean.register(unloadWindowListener.cancel);\n    }\n\n    runTimeout() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            const timeout = this.props.timeout;\n\n            if (timeout) {\n                return this.initPromise.timeout(timeout, new Error(`Loading component timed out after ${ timeout } milliseconds`));\n            }\n        });\n    }\n\n    initChild(child : ChildExportsType<P>) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.clean.set('child', child);\n            this.initPromise.resolve();\n        });\n    }\n\n    buildParentExports(win : ProxyWindow) : ParentExportsType<P> {\n        const onError    = (err) => this.onError(err);\n        const init       = (child) => this.initChild(child);\n        const close      = () => this.close();\n        const checkClose = () => this.checkClose(win);\n        const resize     = ({ width, height }) => this.resize({ width, height });\n        const show       = () => this.show();\n        const hide       = () => this.hide();\n\n        init.onError = onError;\n\n        return { init, close, checkClose, resize, onError, show, hide };\n    }\n\n    resize({ width, height } : { width? : ?number, height? : ?number }) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.event.trigger(EVENT.RESIZE, { width, height });\n        });\n    }\n\n    checkClose(win : ProxyWindow) : ZalgoPromise<void> {\n        return win.isClosed().then(closed => {\n            if (closed) {\n                return this.close();\n            }\n\n            return ZalgoPromise.delay(200)\n                .then(() => win.isClosed())\n                .then(secondClosed => {\n                    if (secondClosed) {\n                        return this.close();\n                    }\n                });\n        });\n    }\n\n    close() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.component.log(`close`);\n            return this.event.trigger(EVENT.CLOSE);\n\n        }).then(() => {\n            if (this.child) {\n                this.child.close.fireAndForget().catch(noop);\n            }\n\n            return this.destroy(new Error(`Window closed`));\n        });\n    }\n\n    prerender(proxyPrerenderWin : ProxyWindow, { context, uid } : { context : $Values<typeof CONTEXT>, uid : string }) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            const prerenderTemplate = this.component.prerenderTemplate;\n\n            if (!prerenderTemplate) {\n                return;\n            }\n\n            let prerenderWindow = proxyPrerenderWin.getWindow();\n\n            if (!prerenderWindow || !isSameDomain(prerenderWindow) || !isBlankDomain(prerenderWindow)) {\n                return;\n            }\n\n            prerenderWindow = assertSameDomain(prerenderWindow);\n    \n            const doc = prerenderWindow.document;\n            const el = this.renderTemplate(prerenderTemplate, { context, uid, doc });\n\n            if (!el) {\n                return;\n            }\n\n            if (el.ownerDocument !== doc) {\n                throw new Error(`Expected prerender template to have been created with document from child window`);\n            }\n\n            writeElementToWindow(prerenderWindow, el);\n\n            let { width = false, height = false, element = 'body' } = this.component.autoResize || {};\n            element = getElementSafe(element, doc);\n            \n            if (element && (width || height)) {\n                onResize(element, ({ width: newWidth, height: newHeight }) => {\n                    this.resize({\n                        width:  width ? newWidth : undefined,\n                        height: height ? newHeight : undefined\n                    });\n                }, { width, height, win: prerenderWindow });\n            }\n        });\n    }\n\n    renderTemplate(renderer : (RenderOptionsType<P>) => ?HTMLElement, { context, uid, container, doc, frame, prerenderFrame } : { context : $Values<typeof CONTEXT>, uid : string, container? : HTMLElement, doc : Document, frame? : ?HTMLIFrameElement, prerenderFrame? : ?HTMLIFrameElement }) : ?HTMLElement {\n        // $FlowFixMe\n        return renderer.call(this, {\n            container,\n            context,\n            uid,\n            doc,\n            frame,\n            prerenderFrame,\n            focus:      () => this.focus(),\n            close:      () => this.close(),\n            state:      this.state,\n            props:      this.props,\n            tag:        this.component.tag,\n            dimensions: this.component.dimensions,\n            event:      this.event\n        });\n    }\n\n    renderContainer(proxyContainer : ProxyObject<HTMLElement>, { proxyFrame, proxyPrerenderFrame, context, uid, visible } :\n        { context : $Values<typeof CONTEXT>, uid : string, proxyFrame : ?ProxyObject<HTMLIFrameElement>, proxyPrerenderFrame : ?ProxyObject<HTMLIFrameElement>, visible : boolean }) : ZalgoPromise<?ProxyObject<HTMLElement>> {\n        \n\n        return ZalgoPromise.hash({\n            container:      proxyContainer.get().then(elementReady),\n            // $FlowFixMe\n            frame:          proxyFrame ? proxyFrame.get() : null,\n            // $FlowFixMe\n            prerenderFrame: proxyPrerenderFrame ? proxyPrerenderFrame.get() : null\n        }).then(({ container, frame, prerenderFrame }) => {\n            const innerContainer = this.renderTemplate(this.component.containerTemplate, { context, uid, container, frame, prerenderFrame, doc: document });\n            if (innerContainer) {\n                if (!visible) {\n                    hideElement(innerContainer);\n                }\n                appendChild(container, innerContainer);\n                this.clean.register(() => destroyElement(innerContainer));\n                this.proxyContainer = getProxyObject(innerContainer);\n                return getProxyObject(innerContainer);\n            }\n        });\n    }\n\n    destroy(err? : mixed) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            return this.clean.all();\n        }).then(() => {\n            this.initPromise.asyncReject(err || new Error('Component destroyed'));\n            this.component.log(`destroy`);\n        });\n    }\n\n    onError(err : mixed) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            if (this.handledErrors.indexOf(err) !== -1) {\n                return;\n            }\n\n            this.handledErrors.push(err);\n            this.initPromise.asyncReject(err);\n\n            return this.event.trigger(EVENT.ERROR, err);\n        });\n    }\n\n    openBridge(proxyWin : ProxyWindow, domain : string, context : $Values<typeof CONTEXT>) : ?ZalgoPromise<?CrossDomainWindowType> {\n        if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n            return ZalgoPromise.try(() => {\n                return proxyWin.awaitWindow();\n                \n            }).then(win => {\n                if (!bridge || !bridge.needsBridge({ win, domain }) || bridge.hasBridge(domain, domain)) {\n                    return;\n                }\n\n                const bridgeUrl = this.component.getBridgeUrl();\n\n                if (!bridgeUrl) {\n                    throw new Error(`Bridge needed to render ${ context }`);\n                }\n\n                const bridgeDomain = getDomainFromUrl(bridgeUrl);\n                bridge.linkUrl(win, domain);\n                return bridge.openBridge(normalizeMockUrl(bridgeUrl), bridgeDomain);\n            });\n        }\n    }\n}\n","/* @flow */\n\nimport { onCloseWindow, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { ProxyWindow } from 'post-robot/src';\nimport { cleanup, type CleanupType, type EventEmitterType } from 'belter/src';\n\nimport { ParentComponent } from '../parent';\nimport { RENDER_DRIVERS, type ContextDriverType } from '../parent/drivers';\nimport type { Component } from '../component';\n\nexport type DelegatePropsType = {|\n    onClose : () => ?ZalgoPromise<void>,\n    onDisplay : () => ?ZalgoPromise<void>,\n    window : ?ProxyWindow\n|};\n\nexport type DelegateOptionsType = {|\n    context : string,\n    props : DelegatePropsType,\n    overrides : {\n        close : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    }\n|};\n\nexport type DelegateReturnType = {|\n    overrides : Object,\n    destroy : () => ZalgoPromise<void>\n|};\n\nexport class DelegateComponent<P>  {\n\n    component : Component<P>\n    source : CrossDomainWindowType\n    context : string\n    driver : ContextDriverType\n    props : DelegatePropsType\n    clean : CleanupType\n\n    focus : () => ZalgoPromise<void>\n    resize : ({ width? : ?number, height? : ?number }) => ZalgoPromise<void>\n    renderTemplate : Function\n\n    close : () => ZalgoPromise<void>\n    onError : (mixed) => ZalgoPromise<void>\n    event : EventEmitterType\n\n    constructor(component : Component<P>, source : CrossDomainWindowType, options : DelegateOptionsType) {\n        this.component = component;\n        this.context = options.context;\n        this.driver = RENDER_DRIVERS[options.context];\n        this.clean = cleanup(this);\n        \n        this.focus = ParentComponent.prototype.focus;\n        this.resize = ParentComponent.prototype.resize;\n        this.renderTemplate = ParentComponent.prototype.renderTemplate;\n\n        // $FlowFixMe\n        this.props = {};\n        \n        for (const propName of Object.keys(options.props)) {\n            const propDef = this.component.getPropDefinition(propName);\n            if (propDef && propDef.allowDelegate && options.props[propName]) {\n                // $FlowFixMe\n                this.props[propName] = options.props[propName];\n            }\n        }\n\n        this.close   = options.overrides.close;\n        this.onError = options.overrides.onError;\n        this.event   = options.overrides.event;\n\n        this.component.registerActiveComponent(this);\n        this.clean.register(() => this.component.destroyActiveComponent(this));\n\n        this.watchForSourceClose(source);\n    }\n\n    getDelegate() : DelegateReturnType {\n        return {\n            overrides: this.getOverrides(),\n            destroy:   () => this.destroy()\n        };\n    }\n\n    watchForSourceClose(source : CrossDomainWindowType) {\n        const closeSourceWindowListener = onCloseWindow(source, () => this.destroy(), 3000);\n        this.clean.register(closeSourceWindowListener.cancel);\n    }\n\n    getOverrides() : { [string] : mixed } {\n        const overrides = {};\n        const self = this;\n\n        for (const key of this.driver.delegate) {\n            overrides[key] = function delegateOverride() : mixed {\n                // $FlowFixMe\n                return ParentComponent.prototype[key].apply(self, arguments);\n            };\n            overrides[key].__name__ = key;\n        }\n\n        return overrides;\n    }\n\n    destroy() : ZalgoPromise<void> {\n        return this.clean.all();\n    }\n}\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","/* @flow */\n/* eslint react/no-deprecated: off, react/no-find-dom-node: off, react/display-name: off, react/no-did-mount-set-state: off, react/destructuring-assignment: off, react/prop-types: off */\n\nimport { extend, noop } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ndeclare class ReactClassType {\n\n}\n\ntype ReactElementType = {|\n\n|};\n\ndeclare class __ReactComponent {\n\n}\n\ntype ReactType = {|\n    Component : __ReactComponent,\n    createClass : ({ render : () => ReactElementType, componentDidMount : () => void, componentDidUpdate : () => void }) => (typeof ReactClassType),\n    createElement : (string, ?{ [string] : mixed }, ...children : $ReadOnlyArray<ReactElementType>) => ReactElementType\n|};\n\ntype ReactDomType = {|\n    findDOMNode : (typeof ReactClassType) => HTMLElement\n|};\n\ntype ReactLibraryType = {|\n    React : ReactType,\n    ReactDOM : ReactDomType\n|};\n\nexport const react : ComponentDriverType<*, ReactLibraryType> = {\n\n    register(component : Component<*>, { React, ReactDOM } : ReactLibraryType) : (typeof ReactClassType) {\n\n        // $FlowFixMe\n        return class extends React.Component {\n            render() : ReactElementType {\n                return React.createElement('div', null);\n            }\n\n            componentDidMount() {\n                component.log(`instantiate_react_component`);\n                \n                const el = ReactDOM.findDOMNode(this);\n\n                const parent = component.init(extend({}, this.props));\n                parent.render(el, CONTEXT.IFRAME);\n                this.setState({ parent });\n            }\n\n            componentDidUpdate() {\n\n                if (this.state && this.state.parent) {\n                    this.state.parent.updateProps(extend({}, this.props)).catch(noop);\n                }\n            }\n        };\n    }\n};\n","/* @flow */\n\nimport { noop } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ntype VueComponent = {|\n    render : (Function) => Element,\n    inheritAttrs : boolean,\n    mounted : () => void,\n    watch : {|\n        $attrs : {|\n            deep : boolean,\n            handler : () => void\n        |}\n    |}\n|};\n\ntype RegisteredVueComponent = {|\n    \n|};\n\ntype VueType = {|\n    component : (string, VueComponent) => RegisteredVueComponent\n|};\n\nexport const vue : ComponentDriverType<*, VueType> = {\n\n    register<P>(component : Component<P>, Vue : VueType) : RegisteredVueComponent {\n\n        return Vue.component(component.tag, {\n            render(createElement) : Element {\n                return createElement('div');\n            },\n\n            inheritAttrs: false,\n\n            mounted() {\n                const el = this.$el;\n                \n                this.parent = component.init({ ...this.$attrs });\n                this.parent.render(el, CONTEXT.IFRAME);\n            },\n\n            watch: {\n                $attrs: {\n                    handler: function handler() {\n                        if (this.parent && this.$attrs) {\n                            this.parent.updateProps({ ...this.$attrs }).catch(noop);\n                        }\n                    },\n                    deep: true\n                }\n            }\n        });\n    }\n};\n","/* @flow */\n\nimport { dasherizeToCamel, replaceObject, noop } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ntype AngularModule = {|\n    directive : (string, () => {\n        scope : { [string] : '=' | '@' },\n        restrict : string,\n        controller : $ReadOnlyArray<string | Function>\n    }) => AngularModule\n|};\n\ntype Angular = {|\n    module : (string, $ReadOnlyArray<string>) => AngularModule\n|};\n\nexport const angular : ComponentDriverType<*, Angular> = {\n\n    register(component : Component<*>, ng : Angular) : AngularModule {\n\n        const module = ng.module(component.tag, []).directive(dasherizeToCamel(component.tag), () => {\n\n            const scope = {};\n\n            for (const key of component.getPropNames()) {\n                scope[key] = '=';\n            }\n\n            scope.props = '=';\n\n            return {\n                scope,\n\n                restrict: 'E',\n\n                controller: [ '$scope', '$element', ($scope, $element) => {\n                    component.log(`instantiate_angular_component`);\n\n                    function safeApply() {\n                        if ($scope.$root.$$phase !== '$apply' && $scope.$root.$$phase !== '$digest') {\n                            try {\n                                $scope.$apply();\n                            } catch (err) {\n                                // pass\n                            }\n                        }\n                    }\n\n                    const getProps = () => {\n                        return replaceObject($scope.props, item => {\n                            if (typeof item === 'function') {\n                                return function angularWrapped() : mixed {\n                                    // $FlowFixMe\n                                    const result = item.apply(this, arguments);\n                                    safeApply();\n                                    return result;\n                                };\n                            }\n                            return item;\n                        });\n                    };\n\n                    const instance = component.init(getProps());\n                    instance.render($element[0], CONTEXT.IFRAME);\n\n                    $scope.$watch(() => {\n                        instance.updateProps(getProps()).catch(noop);\n                    });\n                } ]\n            };\n        });\n\n        return module;\n    }\n};\n","/* @flow */\n/* eslint new-cap: 0 */\n\nimport { replaceObject } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ntype Angular2Injection = {||};\n\ntype Angular2Component = {||};\n\ntype Angular2Module = {||};\n\ntype Angular2 = {|\n    Component : ({ selector : string, template : string, inputs : $ReadOnlyArray<string> }) => {\n        Class : ({ constructor : $ReadOnlyArray<Angular2Injection | Function>, ngOnInit : () => void, ngDoCheck : () => void }) => Angular2Component\n    },\n    NgModule : ({ declarations : $ReadOnlyArray<Angular2Component>, exports : $ReadOnlyArray<Angular2Component> }) => {\n        Class : ({ constructor : () => void }) => Angular2Module\n    },\n    ElementRef : Angular2Injection,\n    NgZone : Angular2Injection\n|};\n\nconst equals = (obj1, obj2) => {\n    const checked = {};\n\n    for (const key in obj1) {\n        if (obj1.hasOwnProperty(key)) {\n            checked[key] = true;\n\n            if (obj1[key] !== obj2[key]) {\n                return false;\n            }\n        }\n    }\n\n    for (const key in obj2) {\n        if (!checked[key]) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\nexport const angular2 : ComponentDriverType<*, Angular2> = {\n\n    register(zoid : Component<*>, { Component : AngularComponent, NgModule, ElementRef, NgZone }) : Angular2Module {\n\n        zoid.log('initializing angular2 component');\n\n        const getProps = (component) => {\n            return replaceObject({ ...component.internalProps, ...component.props }, item => {\n                if (typeof item === 'function') {\n                    return function angular2Wrapped() : void {\n                        // $FlowFixMe\n                        return component.zone.run(() => item.apply(this, arguments));\n                    };\n                }\n                return item;\n            });\n        };\n\n        const ComponentInstance =\n            AngularComponent({\n                selector: zoid.tag,\n                template: '<div></div>',\n                inputs:   [ 'props' ]\n            }).Class({\n                constructor: [ ElementRef, NgZone, function angularConstructor(elementRef, zone) {\n                    this._props = {};\n                    this.elementRef = elementRef;\n                    this.zone = zone;\n                } ],\n                ngOnInit () {\n                    const targetElement = this.elementRef.nativeElement;\n                    \n                    this.parent = zoid.init(getProps(this));\n                    this.parent.render(targetElement, CONTEXT.IFRAME);\n                },\n                ngDoCheck() {\n                    if (this.parent && !equals(this._props, this.props)) {\n                        this._props = { ...this.props };\n                        this.parent.updateProps(getProps(this));\n                    }\n                }\n            });\n\n\n        const ModuleInstance = NgModule({\n            declarations: [ ComponentInstance ],\n            exports:      [ ComponentInstance ]\n        }).Class({\n            constructor () {\n                // pass\n            }\n        });\n\n        return ModuleInstance;\n    }\n};\n","/* @flow */\n\nexport * from './react';\nexport * from './vue';\nexport * from './angular';\nexport * from './angular2';\n","/* @flow */\n\nimport { isPerc, isPx, values } from 'belter/src';\n\nimport { CONTEXT, PROP_TYPE } from '../constants';\n\nimport type { ComponentOptionsType } from './index';\n\nfunction validatePropDefinitions<P>(options : ComponentOptionsType<P>) {\n\n    if (options.props && !(typeof options.props === 'object')) {\n        throw new Error(`Expected options.props to be an object`);\n    }\n\n    const PROP_TYPE_LIST = values(PROP_TYPE);\n\n    if (options.props) {\n        for (const key of Object.keys(options.props)) {\n            const prop = options.props[key];\n\n            if (!prop || !(typeof prop === 'object')) {\n                throw new Error(`Expected options.props.${ key } to be an object`);\n            }\n\n            if (!prop.type) {\n                throw new Error(`Expected prop.type`);\n            }\n\n            if (PROP_TYPE_LIST.indexOf(prop.type) === -1) {\n                throw new Error(`Expected prop.type to be one of ${ PROP_TYPE_LIST.join(', ') }`);\n            }\n\n            if (prop.required && prop.default) {\n                throw new Error(`Required prop can not have a default value`);\n            }\n\n            if (prop.type === PROP_TYPE.FUNCTION && prop.queryParam && !prop.queryValue) {\n                throw new Error(`Do not pass queryParam for function prop`);\n            }\n        }\n    }\n}\n\n// eslint-disable-next-line complexity\nexport function validate<P>(options : ?ComponentOptionsType<P>) { // eslint-ignore-line\n\n    if (!options) {\n        throw new Error(`Expected options to be passed`);\n    }\n\n    // eslint-disable-next-line security/detect-unsafe-regex, unicorn/no-unsafe-regex\n    if (!options.tag || !options.tag.match(/^([a-z0-9][a-z0-9-]*)+[a-z0-9]+$/)) {\n        throw new Error(`Invalid options.tag: ${ options.tag }`);\n    }\n\n    validatePropDefinitions(options);\n\n    if (options.dimensions) {\n        if (options.dimensions && !isPx(options.dimensions.width) && !isPerc(options.dimensions.width)) {\n            throw new Error(`Expected options.dimensions.width to be a px or % string value`);\n        }\n\n        if (options.dimensions && !isPx(options.dimensions.height) && !isPerc(options.dimensions.height)) {\n            throw new Error(`Expected options.dimensions.height to be a px or % string value`);\n        }\n    }\n\n    if (options.defaultContext) {\n        if (options.defaultContext !== CONTEXT.IFRAME && options.defaultContext !== CONTEXT.POPUP) {\n            throw new Error(`Unsupported context type: ${ options.defaultContext || 'unknown' }`);\n        }\n    }\n\n    if (!options.url) {\n        throw new Error(`Must pass url`);\n    }\n\n    if (typeof options.url !== 'string' && typeof options.url !== 'function') {\n        throw new TypeError(`Expected url to be string or function`);\n    }\n\n    if (options.prerenderTemplate && typeof options.prerenderTemplate !== 'function') {\n        throw new Error(`Expected options.prerenderTemplate to be a function`);\n    }\n\n    if ((options.containerTemplate || !__ZOID__.__DEFAULT_CONTAINER__) && typeof options.containerTemplate !== 'function') {\n        throw new Error(`Expected options.containerTemplate to be a function`);\n    }\n}\n","/* @flow */\n/* eslint react/react-in-jsx-scope: off */\n\nimport { destroyElement, toCSS } from 'belter/src';\n\nimport { type RenderOptionsType } from '../../parent';\nimport { EVENT } from '../../constants';\n\nconst CLASS = {\n    VISIBLE:   'visible',\n    INVISIBLE: 'invisible'\n};\n\nexport function defaultContainerTemplate<P>({ uid, frame, prerenderFrame, doc, props, event, dimensions : { width, height } } : RenderOptionsType<P>) : ?HTMLElement {\n    if (__ZOID__.__DEFAULT_CONTAINER__) {\n        if (!frame || !prerenderFrame) {\n            return;\n        }\n\n        const div = doc.createElement('div');\n        div.setAttribute('id', uid);\n        const style = doc.createElement('style');\n        if (props.cspNonce) {\n            style.setAttribute('nonce', props.cspNonce);\n        }\n\n        style.appendChild(doc.createTextNode(`\n            #${ uid } {\n                display: inline-block;\n                position: relative;\n                width: ${ width };\n                height: ${ height };\n            }\n\n            #${ uid } > iframe {\n                display: inline-block;\n                position: absolute;\n                width: 100%;\n                height: 100%;\n                top: 0;\n                left: 0;\n                transition: opacity .2s ease-in-out;\n            }\n\n            #${ uid } > iframe.${ CLASS.INVISIBLE } {\n                opacity: 0;\n            }\n\n            #${ uid } > iframe.${ CLASS.VISIBLE } {\n                opacity: 1;\n        }\n        `));\n\n        div.appendChild(frame);\n        div.appendChild(prerenderFrame);\n        div.appendChild(style);\n\n        prerenderFrame.classList.add(CLASS.VISIBLE);\n        frame.classList.add(CLASS.INVISIBLE);\n    \n        event.on(EVENT.RENDERED, () => {\n            prerenderFrame.classList.remove(CLASS.VISIBLE);\n            prerenderFrame.classList.add(CLASS.INVISIBLE);\n    \n            frame.classList.remove(CLASS.INVISIBLE);\n            frame.classList.add(CLASS.VISIBLE);\n    \n            setTimeout(() => {\n                destroyElement(prerenderFrame);\n            }, 1);\n        });\n\n        event.on(EVENT.RESIZE, ({ width: newWidth, height: newHeight }) => {\n            if (typeof newWidth === 'number') {\n                div.style.width = toCSS(newWidth);\n            }\n    \n            if (typeof newHeight === 'number') {\n                div.style.height = toCSS(newHeight);\n            }\n        });\n\n        return div;\n    }\n}\n","/* @flow */\n/* eslint react/react-in-jsx-scope: off */\n\nimport { type RenderOptionsType } from '../../parent';\n\nexport function defaultPrerenderTemplate<P>({ doc, props } : RenderOptionsType<P>) : ?HTMLElement {\n    if (__ZOID__.__DEFAULT_PRERENDER__) {\n        const html = doc.createElement('html');\n        const body = doc.createElement('body');\n        const style = doc.createElement('style');\n        const spinner = doc.createElement('div');\n        spinner.classList.add('spinner');\n\n        if (props.cspNonce) {\n            style.setAttribute('nonce', props.cspNonce);\n        }\n\n        html.appendChild(body);\n        body.appendChild(spinner);\n        body.appendChild(style);\n        style.appendChild(doc.createTextNode(`\n            html, body {\n                width: 100%;\n                height: 100%;\n            }\n\n            .spinner {\n                position: fixed;\n                max-height: 60vmin;\n                max-width: 60vmin;\n                height: 40px;\n                width: 40px;\n                top: 50%;\n                left: 50%;\n                box-sizing: border-box;\n                border: 3px solid rgba(0, 0, 0, .2);\n                border-top-color: rgba(33, 128, 192, 0.8);\n                border-radius: 100%;\n                animation: rotation .7s infinite linear;\n            }\n\n            @keyframes rotation {\n                from {\n                    transform: translateX(-50%) translateY(-50%) rotate(0deg);\n                }\n                to {\n                    transform: translateX(-50%) translateY(-50%) rotate(359deg);\n                }\n            }\n        `));\n\n        return html;\n    }\n}\n","/* @flow */\n\nexport * from './container';\nexport * from './component';\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { once, noop, type EventEmitterType } from 'belter/src';\nimport { isWindow, type CrossDomainWindowType, isWindowClosed, isSameDomain } from 'cross-domain-utils/src';\nimport { ProxyWindow, toProxyWindow } from 'post-robot/src';\n\nimport { PROP_SERIALIZATION } from '../constants';\n\nexport type EventHandlerType<T> = (T) => void | ZalgoPromise<void>;\n\nexport type timeoutPropType = number;\nexport type windowPropType = CrossDomainWindowType | ProxyWindow;\nexport type cspNoncePropType = string;\nexport type closePropType = () => ZalgoPromise<void>;\nexport type focusPropType = () => ZalgoPromise<void>;\nexport type resizePropType = ({ width : ?number, height : ?number }) => ZalgoPromise<void>;\n\nexport type onDisplayPropType = EventHandlerType<void>;\nexport type onRenderedPropType = EventHandlerType<void>;\nexport type onRenderPropType = EventHandlerType<void>;\nexport type onClosePropType = EventHandlerType<void>;\nexport type onResizePropType = EventHandlerType<void>;\nexport type onFocusPropType = EventHandlerType<void>;\nexport type onErrorPropType = EventHandlerType<mixed>;\nexport type onPropsPropType<P> = ((PropsType<P>) => void) => void; // eslint-disable-line no-use-before-define\n\nexport type PropsInputType<P> = {\n    timeout? : timeoutPropType,\n    window? : windowPropType,\n    cspNonce? : cspNoncePropType,\n\n    onDisplay? : onDisplayPropType,\n    onRendered? : onRenderedPropType,\n    onRender? : onRenderPropType,\n    onClose? : onClosePropType,\n    onResize? : onResizePropType,\n    onFocus? : onFocusPropType,\n    onError? : onErrorPropType,\n    onProps? : onPropsPropType<P>\n} & P;\n\nexport type PropsType<P> = {|\n    timeout? : timeoutPropType,\n    window? : ?windowPropType,\n    close? : ?closePropType,\n    focus? : ?focusPropType,\n    resize? : ?resizePropType,\n    cspNonce? : ?cspNoncePropType,\n\n    onDisplay : onDisplayPropType,\n    onRendered : onRenderedPropType,\n    onRender : onRenderPropType,\n    onClose : onClosePropType,\n    onResize : onResizePropType,\n    onFocus : onFocusPropType,\n    onError : onErrorPropType,\n    onProps : onPropsPropType<P>\n|} & P;\n\ntype PropDefinitionType<T, P, S : string> = {|\n    type : S,\n    alias? : string,\n    value? : ({|\n        props : P,\n        state : Object,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    |}) => ?T,\n    default? : ({|\n        props : P,\n        state : Object,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    |}) => ?T,\n    decorate? : ({|\n        value : T,\n        props : PropsType<P>,\n        state : Object,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    |}) => T,\n    childDecorate? : ({|\n        value : T,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        onProps : ((PropsType<P>) => void) => void,\n        resize : ({ width : ?number, height : ?number }) => ZalgoPromise<void>,\n        getParentDomain : () => string,\n        getParent : () => CrossDomainWindowType,\n        show : () => ZalgoPromise<void>,\n        hide : () => ZalgoPromise<void>\n    |}) => ?T,\n    required? : boolean,\n    queryParam? : boolean | string | ({ value : T }) => (string | ZalgoPromise<string>),\n    queryValue? : ({| value : T |}) => (ZalgoPromise<mixed> | mixed),\n    sendToChild? : boolean,\n    allowDelegate? : boolean,\n    validate? : ({| value : T, props : PropsInputType<P> |}) => void,\n    sameDomain? : boolean,\n    serialization? : $Values<typeof PROP_SERIALIZATION>\n|};\n\nexport type BooleanPropDefinitionType<T : boolean, P> = PropDefinitionType<T, P, 'boolean'>;\nexport type StringPropDefinitionType<T : string, P> = PropDefinitionType<T, P, 'string'>;\nexport type NumberPropDefinitionType<T : number, P> = PropDefinitionType<T, P, 'number'>;\nexport type FunctionPropDefinitionType<T : Function, P> = PropDefinitionType<T, P, 'function'>;\nexport type ArrayPropDefinitionType<T : Array<*> | $ReadOnlyArray<*>, P> = PropDefinitionType<T, P, 'array'>; // eslint-disable-line flowtype/no-mutable-array\nexport type ObjectPropDefinitionType<T : Object, P> = PropDefinitionType<T, P, 'object'>;\n\nexport type MixedPropDefinitionType<P> = BooleanPropDefinitionType<*, P> | StringPropDefinitionType<*, P> | NumberPropDefinitionType<*, P> | FunctionPropDefinitionType<*, P> | ObjectPropDefinitionType<*, P> | ArrayPropDefinitionType<*, P>;\n\nexport type UserPropsDefinitionType<P> = {\n    [string] : MixedPropDefinitionType<P>\n};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type BuiltInPropsDefinitionType<P> = {\n    timeout : NumberPropDefinitionType<timeoutPropType, P>,\n    window : ObjectPropDefinitionType<windowPropType, P>,\n    close : FunctionPropDefinitionType<closePropType, P>,\n    focus : FunctionPropDefinitionType<focusPropType, P>,\n    resize : FunctionPropDefinitionType<resizePropType, P>,\n\n    onDisplay : FunctionPropDefinitionType<onDisplayPropType, P>,\n    onRendered : FunctionPropDefinitionType<onRenderedPropType, P>,\n    onRender : FunctionPropDefinitionType<onRenderPropType, P>,\n    onClose : FunctionPropDefinitionType<onClosePropType, P>,\n    onResize : FunctionPropDefinitionType<onClosePropType, P>,\n    onFocus : FunctionPropDefinitionType<onFocusPropType, P>,\n    onError : FunctionPropDefinitionType<onErrorPropType, P>,\n    onProps : FunctionPropDefinitionType<onPropsPropType<P>, P>\n};\n\nconst defaultNoop = () => noop;\nconst decorateOnce = ({ value }) => once(value);\n\nexport function getBuiltInProps<P>() : BuiltInPropsDefinitionType<P> {\n    return {\n        window: {\n            type:          'object',\n            sendToChild:   false,\n            required:      false,\n            allowDelegate: true,\n            validate({ value } : { value : CrossDomainWindowType | ProxyWindow }) {\n                if (!isWindow(value) && !ProxyWindow.isProxyWindow(value)) {\n                    throw new Error(`Expected Window or ProxyWindow`);\n                }\n\n                if (isWindow(value)) {\n                    // $FlowFixMe\n                    if (isWindowClosed(value)) {\n                        throw new Error(`Window is closed`);\n                    }\n\n                    // $FlowFixMe\n                    if (!isSameDomain(value)) {\n                        throw new Error(`Window is not same domain`);\n                    }\n                }\n            },\n            decorate({ value } : { value : CrossDomainWindowType | ProxyWindow }) : ProxyWindow {\n                return toProxyWindow(value);\n            }\n        },\n\n        timeout: {\n            type:        'number',\n            required:    false,\n            sendToChild: false\n        },\n\n        close: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ close }) => close\n        },\n\n        focus: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ focus }) => focus\n        },\n\n        resize: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ resize }) => resize\n        },\n\n        cspNonce: {\n            type:     'string',\n            required: false\n        },\n\n        getParent: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ getParent }) => getParent\n        },\n\n        getParentDomain: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ getParentDomain }) => getParentDomain\n        },\n\n        show: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ show }) => show\n        },\n\n        hide: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ hide }) => hide\n        },\n\n        onDisplay: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop,\n            decorate:      decorateOnce\n        },\n\n        onRendered: {\n            type:        'function',\n            required:    false,\n            sendToChild: false,\n            default:     defaultNoop,\n            decorate:    decorateOnce\n        },\n\n        onRender: {\n            type:        'function',\n            required:    false,\n            sendToChild: false,\n            default:     defaultNoop,\n            decorate:    decorateOnce\n        },\n\n        onClose: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop,\n            decorate:      decorateOnce\n        },\n\n        onResize: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop\n        },\n\n        onFocus: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop\n        },\n\n        onError: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ onError }) => onError\n        },\n\n        onProps: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            default:       defaultNoop,\n            childDecorate: ({ onProps }) => onProps\n        }\n    };\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { setup as setupPostRobot, on, send, bridge, toProxyWindow, destroy as destroyPostRobot } from 'post-robot/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isWindow, getDomainFromUrl, type CrossDomainWindowType, isSameTopWindow, getDomain, matchDomain, isSameDomain } from 'cross-domain-utils/src';\nimport { isRegex, noop, isElement } from 'belter/src';\n\nimport { ChildComponent, getChildPayload } from '../child';\nimport { ParentComponent, type RenderOptionsType, type ParentHelpers } from '../parent';\nimport { DelegateComponent } from '../delegate';\nimport { CONTEXT, POST_MESSAGE, WILDCARD, DEFAULT_DIMENSIONS } from '../constants';\nimport { react, angular, vue, angular2 } from '../drivers';\nimport { getGlobal, destroyGlobal } from '../lib';\nimport type { CssDimensionsType, StringMatcherType } from '../types';\n\nimport { validate } from './validate';\nimport { defaultContainerTemplate, defaultPrerenderTemplate } from './templates';\nimport { getBuiltInProps, type UserPropsDefinitionType, type BuiltInPropsDefinitionType, type PropsInputType, type PropsType, type MixedPropDefinitionType } from './props';\n\ntype LoggerPayload = { [string] : ?string };\n\n// eslint-disable-next-line flowtype/require-exact-type\ntype Logger = {\n    debug : (event : string, payload? : LoggerPayload) => any, // eslint-disable-line flowtype/no-weak-types\n    info : (event : string, payload? : LoggerPayload) => any, // eslint-disable-line flowtype/no-weak-types\n    warn : (event : string, payload? : LoggerPayload) => any, // eslint-disable-line flowtype/no-weak-types\n    error : (event : string, payload? : LoggerPayload) => any // eslint-disable-line flowtype/no-weak-types\n};\n\n/*  Component\n    ---------\n\n    This is the spec for the component. The idea is, when I call zoid.create(), it will create a new instance\n    of Component with the blueprint needed to set up ParentComponents and ChildComponents.\n\n    This is the one portion of code which is required by -- and shared to -- both the parent and child windows, and\n    contains all of the configuration needed for them to set themselves up.\n*/\n\nexport type ComponentOptionsType<P> = {|\n\n    tag : string,\n\n    url : string | ({ props : PropsType<P> }) => string,\n    domain? : string | RegExp,\n    bridgeUrl? : string,\n\n    props? : UserPropsDefinitionType<P>,\n\n    dimensions? : CssDimensionsType,\n    autoResize? : { width? : boolean, height? : boolean, element? : string },\n\n    allowedParentDomains? : StringMatcherType,\n\n    attributes? : {\n        iframe? : { [string] : string },\n        popup? : { [string] : string }\n    },\n\n    defaultContext? : $Values<typeof CONTEXT>,\n\n    containerTemplate? : (RenderOptionsType<P>) => ?HTMLElement,\n    prerenderTemplate? : (RenderOptionsType<P>) => ?HTMLElement,\n\n    validate? : ({ props : PropsInputType<P> }) => void,\n\n    logger? : Logger\n|};\n\ntype ZoidRenderer = {|\n    render : (container? : string | HTMLElement, context? : $Values<typeof CONTEXT>) => ZalgoPromise<void>,\n    renderTo : (target : CrossDomainWindowType, container? : string, context? : $Values<typeof CONTEXT>) => ZalgoPromise<void>\n|};\n\nexport type ZoidComponentInstance<P> = {| ...ParentHelpers<P>, ...ZoidRenderer |};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type ZoidComponent<P> = {\n    (PropsInputType<P>) : ZoidComponentInstance<P>,\n    driver : (string, mixed) => mixed,\n    isChild : () => boolean,\n    xprops? : PropsType<P>,\n    canRenderTo : (CrossDomainWindowType) => ZalgoPromise<boolean>\n};\n\nexport class Component<P> {\n\n    tag : string\n    name : string\n    \n    url : string | ({ props : PropsType<P> }) => string\n    domain : void | string | RegExp\n    bridgeUrl : void | string\n\n    props : UserPropsDefinitionType<P>\n    builtinProps : BuiltInPropsDefinitionType<P>\n\n    dimensions : CssDimensionsType\n    autoResize : void | { width? : boolean, height? : boolean, element? : string }\n\n    allowedParentDomains : StringMatcherType\n\n    defaultContext : $Values<typeof CONTEXT>\n    \n    attributes : {\n        iframe? : { [string] : string },\n        popup? : { [string] : string }\n    }\n\n    containerTemplate : (RenderOptionsType<P>) => ?HTMLElement\n    prerenderTemplate : ?(RenderOptionsType<P>) => ?HTMLElement\n\n    validate : void | ({ props : PropsInputType<P> }) => void\n\n    driverCache : { [string] : mixed }\n\n    xprops : ?PropsType<P>\n\n    logger : Logger\n\n    propNames : $ReadOnlyArray<string>\n\n    constructor(options : ComponentOptionsType<P>) {\n        validate(options);\n\n        // The tag name of the component. Used by some drivers (e.g. angular) to turn the component into an html element,\n        // e.g. <my-component>\n\n        this.tag = options.tag;\n        this.name = this.tag.replace(/-/g, '_');\n\n        this.allowedParentDomains = options.allowedParentDomains || WILDCARD;\n\n        const global = getGlobal();\n        global.components = global.components || {};\n\n        if (global.components[this.tag]) {\n            throw new Error(`Can not register multiple components with the same tag: ${ this.tag }`);\n        }\n\n        // A json based spec describing what kind of props the component accepts. This is used to validate any props before\n        // they are passed down to the child.\n\n        this.builtinProps = getBuiltInProps();\n        this.props = options.props || {};\n\n        // The dimensions of the component, e.g. { width: '300px', height: '150px' }\n\n        const { width = DEFAULT_DIMENSIONS.WIDTH, height = DEFAULT_DIMENSIONS.HEIGHT } = options.dimensions || {};\n        this.dimensions = { width, height };\n\n        this.url = options.url;\n        this.domain = options.domain;\n        this.bridgeUrl = options.bridgeUrl;\n\n        this.attributes = options.attributes || {};\n        this.attributes.iframe = this.attributes.iframe || {};\n        this.attributes.popup = this.attributes.popup || {};\n\n        this.defaultContext = options.defaultContext || CONTEXT.IFRAME;\n\n        this.autoResize = options.autoResize;\n\n        if (options.containerTemplate) {\n            this.containerTemplate = options.containerTemplate;\n        } else if (__ZOID__.__DEFAULT_CONTAINER__) {\n            this.containerTemplate = defaultContainerTemplate;\n        }\n\n        if (options.prerenderTemplate) {\n            this.prerenderTemplate = options.prerenderTemplate;\n        } else if (__ZOID__.__DEFAULT_PRERENDER__) {\n            this.prerenderTemplate = defaultPrerenderTemplate;\n        }\n\n        this.validate = options.validate;\n\n        this.logger = options.logger || {\n            debug: noop,\n            info:  noop,\n            warn:  noop,\n            error: noop\n        };\n\n        this.registerChild();\n        this.listenDelegate();\n\n        global.components[this.tag] = this;\n    }\n\n    getPropNames() : $ReadOnlyArray<string> {\n        if (this.propNames) {\n            return this.propNames;\n        }\n\n        const propNames = Object.keys(this.props);\n        for (const key of Object.keys(this.builtinProps)) {\n            if (propNames.indexOf(key) === -1) {\n                propNames.push(key);\n            }\n        }\n\n        this.propNames = propNames;\n        return propNames;\n    }\n\n    getPropDefinition(name : string) : MixedPropDefinitionType<P> {\n        return this.props[name] || this.builtinProps[name];\n    }\n\n    driver(name : string, dep : mixed) : mixed {\n        if (__ZOID__.__FRAMEWORK_SUPPORT__) {\n            const drivers = { react, angular, vue, angular2 };\n\n            if (!drivers[name]) {\n                throw new Error(`Could not find driver for framework: ${ name }`);\n            }\n    \n            this.driverCache = this.driverCache || {};\n    \n            if (!this.driverCache[name]) {\n                this.driverCache[name] = drivers[name].register(this, dep);\n            }\n    \n            return this.driverCache[name];\n        } else {\n            throw new Error(`Driver support not enabled`);\n        }\n    }\n\n    registerChild() {\n        if (this.isChild()) {\n            if (window.xprops) {\n                throw new Error(`Can not register ${ this.name } as child - can not attach multiple components to the same window`);\n            }\n\n            const child = new ChildComponent(this);\n            window.xprops = this.xprops = child.getProps();\n        }\n    }\n\n    listenDelegate() {\n        on(`${ POST_MESSAGE.ALLOW_DELEGATE }_${ this.name }`, () => {\n            return true;\n        });\n\n        on(`${ POST_MESSAGE.DELEGATE }_${ this.name }`, ({ source, data: { context, props, overrides } }) => {\n            const delegate = new DelegateComponent(this, source, { context, props, overrides });\n            return delegate.getDelegate();\n        });\n    }\n\n    canRenderTo(win : CrossDomainWindowType) : ZalgoPromise<boolean> {\n        return send(win, `${ POST_MESSAGE.ALLOW_DELEGATE }_${ this.name }`).then(({ data }) => {\n            return data;\n        }).catch(() => {\n            return false;\n        });\n    }\n\n    getUrl(props : PropsType<P>) : string {\n        if (typeof this.url === 'function') {\n            return this.url({ props });\n        }\n\n        return this.url;\n    }\n\n    getChildDomain(props : PropsType<P>) : string {\n        if (this.domain && typeof this.domain === 'string') {\n            return this.domain;\n        }\n\n        return getDomainFromUrl(this.getUrl(props));\n    }\n\n    getDomain(props : PropsType<P>) : string | RegExp {\n        if (this.domain && isRegex(this.domain)) {\n            return this.domain;\n        }\n\n        return this.getChildDomain(props);\n    }\n\n    getBridgeUrl() : ?string {\n        if (this.bridgeUrl) {\n            return this.bridgeUrl;\n        }\n    }\n\n    isChild() : boolean {\n        const payload = getChildPayload();\n        return Boolean(payload && payload.tag === this.tag && payload.childDomain === getDomain());\n    }\n\n    getDefaultContainer(context : $Values<typeof CONTEXT>, container? : string | HTMLElement) : string | HTMLElement {\n        if (container) {\n            if (typeof container !== 'string' && !isElement(container)) {\n                throw new TypeError(`Expected string or element selector to be passed`);\n            }\n\n            return container;\n        }\n\n        if (context === CONTEXT.POPUP) {\n            return 'body';\n        }\n\n        throw new Error(`Expected element to be passed to render iframe`);\n    }\n\n    getDefaultContext(context : ?$Values<typeof CONTEXT>, props : PropsInputType<P>) : ZalgoPromise<$Values<typeof CONTEXT>> {\n        return ZalgoPromise.try(() => {\n            if (props.window) {\n                return toProxyWindow(props.window).getType();\n            }\n    \n            if (context) {\n                if (context !== CONTEXT.IFRAME && context !== CONTEXT.POPUP) {\n                    throw new Error(`Unrecognized context: ${ context }`);\n                }\n                \n                return context;\n            }\n    \n            return this.defaultContext;\n        });\n    }\n\n    init(props : PropsInputType<P>) : ZoidComponentInstance<P> {\n\n        // $FlowFixMe\n        props = props || {};\n        \n        const parent = new ParentComponent(this, props);\n\n        const render = (target, container, context) => {\n            return ZalgoPromise.try(() => {\n                if (!isWindow(target)) {\n                    throw new Error(`Must pass window to renderTo`);\n                }\n\n                return this.getDefaultContext(context, props);\n                \n            }).then(finalContext => {\n                container = this.getDefaultContainer(finalContext, container);\n                return parent.render(target, container, finalContext);\n            });\n        };\n\n        return {\n            ...parent.getHelpers(),\n            render:   (container, context) => render(window, container, context),\n            renderTo: (target, container, context) => render(target, container, context)\n        };\n    }\n\n    checkAllowRender(target : CrossDomainWindowType, domain : string | RegExp, container : string | HTMLElement) {\n        if (target === window) {\n            return;\n        }\n\n        if (!isSameTopWindow(window, target)) {\n            throw new Error(`Can only renderTo an adjacent frame`);\n        }\n\n        const origin = getDomain();\n\n        if (!matchDomain(domain, origin) && !isSameDomain(target)) {\n            throw new Error(`Can not render remotely to ${ domain.toString() } - can only render to ${ origin }`);\n        }\n\n        if (container && typeof container !== 'string') {\n            throw new Error(`Container passed to renderTo must be a string selector, got ${ typeof container } }`);\n        }\n    }\n\n    log(event : string, payload? : LoggerPayload) {\n        this.logger.info(`${ this.name }_${ event }`, payload);\n    }\n\n    registerActiveComponent<Q>(instance : ParentComponent<Q> | DelegateComponent<Q>) {\n        const global = getGlobal();\n        global.activeComponents = global.activeComponents || [];\n        global.activeComponents.push(instance);\n    }\n\n    destroyActiveComponent<Q>(instance : ParentComponent<Q> | DelegateComponent<Q>) {\n        const global = getGlobal();\n        global.activeComponents = global.activeComponents || [];\n        global.activeComponents.splice(global.activeComponents.indexOf(instance), 1);\n    }\n}\n\nexport type ComponentDriverType<P, T : mixed> = {|\n    register : (Component<P>, T) => mixed\n|};\n\nexport function create<P>(options : ComponentOptionsType<P>) : ZoidComponent<P> {\n    setupPostRobot();\n\n    const component : Component<P> = new Component(options);\n\n    const init = (props) => component.init(props);\n    init.driver = (name, dep) => component.driver(name, dep);\n    init.isChild = () => component.isChild();\n    init.canRenderTo = (win) => component.canRenderTo(win);\n    init.xprops = component.xprops;\n    \n    return init;\n}\n\nexport function destroyAll() : ZalgoPromise<void> {\n    if (bridge) {\n        bridge.destroyBridges();\n    }\n\n    const results = [];\n\n    const global = getGlobal();\n    global.activeComponents = global.activeComponents || [];\n    while (global.activeComponents.length) {\n        results.push(global.activeComponents[0].destroy(new Error(`zoid destroyed all`), false));\n    }\n\n    return ZalgoPromise.all(results).then(noop);\n}\n\nexport const destroyComponents = destroyAll;\n\nexport function destroy() {\n    destroyAll();\n    destroyGlobal();\n    destroyPostRobot();\n}\n","/* @flow */\n\nexport * from './component';\nexport * from './props';\n","/* @flow */\n\nexport { PopupOpenError } from 'belter/src';\nexport { create, destroy, destroyComponents, destroyAll, Component } from './component';\nexport type { ZoidComponent, ZoidComponentInstance } from './component';\nexport type { RenderOptionsType } from './parent';\nexport { PROP_TYPE, PROP_SERIALIZATION, CONTEXT, EVENT } from './constants';\n"],"sourceRoot":""}