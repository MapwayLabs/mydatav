!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TMap=t():e.TMap=t()}(window,function(){return function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);const i={hasClass:function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},addClass:function(e,t){if(void 0!==e.classList)for(var s=t.split(" "),i=0,o=s.length;i<o;i++)e.classList.add(s[i]);else this.hasClass(e,t)||(e.className=(e.className?e.className+" ":"")+t)},removeClass:function(e,t){void 0!==e.classList?e.classList.remove(t):(e.className=" "+e.className+" ",e.className=e.className.replace(" "+t+" "," "))},getCmpStyle:function(e){return getComputedStyle(e)},extend:function(e){var t,s,i;for(t=1,s=arguments.length;t<s;t++)for(var o in i=arguments[t])e[o]=i[o];return e},stamp:function(e){return this.lastId||(this.lastId=0),e.__objstampid__=e.__objstampid__||++this.lastId,e.__objstampid__},inherit:function(e,t){var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t},isNullOrUdf:function(e){return null==e},getRandomColor:function(){return"#"+function e(t){return(t+="0123456789abcdef"[Math.floor(16*Math.random())])&&6==t.length?t:e(t)}("")},isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},lightenDarkenColor:function(e,t){var s=!1;"#"==e[0]&&(e=e.slice(1),s=!0);var i=parseInt(e,16),o=(i>>16)+t;o>255?o=255:o<0&&(o=0);var r=(i>>8&255)+t;r>255?r=255:r<0&&(r=0);var h=(255&i)+t;return h>255?h=255:h<0&&(h=0),(s?"#":"")+(h|r<<8|o<<16).toString(16)}};class o{constructor(){this._events={}}on(e,t,s){if(s=s||this,t.$context=s,Array.isArray(e))for(let i=0,o=e.length;i<o;i++)this.on(e[i],t,s);else(this._events[e]||(this._events[e]=[])).push(t);return this}once(e,t,s){s=s||this;var i=this;function o(){i.off(e,t,s),t.apply(s,arguments)}return o.fn=t,this.on(e,o,s),this}off(e,t,s){if(s=s||this,!arguments.length)return this._events=Object.create(null),this;if(Array.isArray(e)){for(let i=0,o=e.length;i<o;i++)this.off(e[i],t,s);return this}if(!t)return this._events[e]=null,this;if(t){let s=this._events[e],i=s.length;for(;i--;)if(t===s[i]||t===s[i].fn){s.splice(i,1);break}return this}}emit(e){let t=this._events[e],s=Array.prototype.slice.call(arguments,1);if(t)for(let e=0,i=t.length;e<i;e++)t[e].apply(t[e].$context||this,s)}}class r{constructor(e,t,s,i){Array.isArray(e)?(this.xmin=e[0],this.xmax=t[0],this.ymin=e[1],this.ymax=t[1]):(this.xmin=e,this.xmax=s,this.ymin=t,this.ymax=i)}getWidth(){return this.xmax-this.xmin}getHeight(){return this.ymax-this.ymin}getCenter(){let e=(this.xmax-this.xmin)/2,t=(this.ymax-this.ymin)/2;return[e+this.xmin,t+this.ymin]}}const h=6378137,n=new r(-20037508.34279,-15496570.73972,20037508.34279,18764656.23138),l={wgs84ToMecator(e){var t=Math.PI/180,s=h,i=e[1]*t,o=.9966471893352525,r=Math.sqrt(1-o*o),n=r*Math.sin(i),l=Math.tan(Math.PI/4-i/2)/Math.pow((1-n)/(1+n),r/2);return i=-s*Math.log(Math.max(l,1e-10)),[e[0]*t*s,i]},mecatorToWgs84(e){for(var t,s=180/Math.PI,i=h,o=.9966471893352525,r=Math.sqrt(1-o*o),n=Math.exp(-e[1]/i),l=Math.PI/2-2*Math.atan(n),a=0,d=.1;a<15&&Math.abs(d)>1e-7;a++)t=r*Math.sin(l),t=Math.pow((1-t)/(1+t),r/2),l+=d=Math.PI/2-2*Math.atan(n*t)-l;return[e[0]*s/i,l*s]},getBounds(e){if("world"===e)return n;if("china"===e){let e=73.4766,t=135.0879,s=18.1055,i=53.5693,o=this.wgs84ToMecator([e,s]),h=this.wgs84ToMecator([t,i]);return new r(o,h)}{let t={xmin:n.xmax,xmax:n.xmin,ymin:n.ymax,ymax:n.ymin},s=[],i=[];"FeatureCollection"===e.type?s=e.features:"Feature"===e.type&&s.push(e),s.forEach(e=>{if("Polygon"===e.geometry.type)i.push(e.geometry.coordinates);else if("MultiPolygon"===e.geometry.type)for(let t=0,s=e.geometry.coordinates.length;t<s;t++)i.push(e.geometry.coordinates[t])});for(let e=0,s=i.length;e<s;e++){let s=i[e];for(let e=0;e<s.length;e++){let i=s[e];for(let e=0;e<i.length;e++){let s=this.wgs84ToMecator(i[e]);s[0]<t.xmin&&(t.xmin=s[0]),s[0]>t.xmax&&(t.xmax=s[0]),s[1]<t.ymin&&(t.ymin=s[1]),s[1]>t.ymax&&(t.ymax=s[1])}}}return new r(t.xmin,t.ymin,t.xmax,t.ymax)}}};class a extends o{constructor(e,t){super();this.options=i.extend({containerClassName:"three-map-container",lightColor:16777215,type:"2d",region:"china"},t),"2d"===this.options.type&&("china"===this.options.region?this._fullBound=l.getBounds("china"):this._fullBound=l.getBounds("world")),this._layers={},this._initContainer(e),this._init3D(),this._initEvents()}getBounds(){return this._fullBound}addLayer(e){var t=i.stamp(e);return this._layers[t]?this:(this._layers[t]=e,this._scene.add(e.getContainer()),e.onAdd(this),this)}removeLayer(e){var t=i.stamp(e);return this._layers[t]?(delete this._layers[t],this._scene.remove(e.getContainer()),e.onRemove(this),this):this}hasLayer(e){return!!e&&i.stamp(e)in this._layers}clearLayers(){for(var e in this._layers)this.removeLayer(this._layers[e])}updateSize(){this._onContainerResize()}resetView(){this._orbitControl.reset()}setView(e){if("2d"===this.options.type)if("world"===this.options.region)   ;else if("china"===this.options.region)this._orbitControl.minDistance=30,this._orbitControl.maxDistance=200,this._orbitControl.object.position.set(109.58688917016474,16.051696751000303,-9.408028404329741),this._orbitControl.target=new THREE.Vector3(106.61608780527186,-6.091,-47.26487677586227);else{let t=e.getCenter(),s=this.getOptimalDistance(e);this._orbitControl.minDistance=30*s.ratio,this._orbitControl.maxDistance=200*s.ratio,this._orbitControl.object.position.set(t[0],s.d,-t[1]),this._orbitControl.target=new THREE.Vector3(t[0],0,-t[1])}this._orbitControl.update()}getOptimalDistance(e){if(!e)return{d:60,ratio:1};var t=60*e.getHeight()/35.464;return{d:t,ratio:t/60}}getContainerElement(){return this._el}getContainerSize(){const e=i.getCmpStyle(this._el);return{width:parseInt(e.width),height:parseInt(e.height)}}_initContainer(e){if(this._container="string"==typeof e?document.getElementById(e):e,!this._container)throw new Error("未提供父容器,请为地图提供一个父容器！");this._el=document.createElement("div"),this._el.style.height="100%",this._el.style.margin=0,this._el.style.padding=0,i.addClass(this._el,this.options.containerClassName),this._container.appendChild(this._el)}_init3D(){if(void 0===THREE)throw new Error("需先引入threejs库！");if(void 0===THREE.OrbitControls)throw new Error("需先引入 THREE.OrbitControls 组件！");let e=this.getContainerSize();this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),this._renderer.setClearColor(0,0),this._renderer.setSize(e.width,e.height),this._renderer.domElement.className="chart-canvas",this._el.appendChild(this._renderer.domElement),this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(45,e.width/e.height,1,1e3),this._orbitControl=new THREE.OrbitControls(this._camera,this._renderer.domElement),this._orbitControl.maxPolarAngle=Math.PI/2,this._orbitControl.maxAzimuthAngle=Math.PI/2,this._orbitControl.minAzimuthAngle=-Math.PI/2,this._orbitControl.saveState(),this._orbitControl.update(),this._scene.add(new THREE.AmbientLight(this.options.lightColor,.6)),this._light=new THREE.DirectionalLight(this.options.lightColor,.8),this._light2=new THREE.DirectionalLight(this.options.lightColor,.1),this._light.position.set(-1,1,1),this._light2.position.set(1,1,1),this._scene.add(this._light),this._scene.add(this._light2),this._animate()}_initEvents(){this._onContainerResize=this._onContainerResize.bind(this),this._mousemoveEvtHandler=this._mousemoveEvtHandler.bind(this),window.addEventListener("resize",this._onContainerResize,!1),this._renderer.domElement.addEventListener("mousemove",this._mousemoveEvtHandler,!1)}_animate(){this._animateId=requestAnimationFrame(this._animate.bind(this)),this._orbitControl.update(),this._renderer.render(this._scene,this._camera)}_onContainerResize(){let e=this.getContainerSize();this._camera.aspect=e.width/e.height,this._camera.updateProjectionMatrix(),this._renderer.setSize(e.width,e.height,!0)}_mousemoveEvtHandler(e){this.emit("mousemove",e)}destroy(){this.clearLayers(),window.removeEventListener("resize",this._onContainerResize,!1),this._renderer.domElement.removeEventListener("mousemove",this._mousemoveEvtHandler,!1),cancelAnimationFrame(this._animateId),this._container&&this._container.hasChildNodes(this._el)&&(this._container.removeChild(this._el),this._el=null)}}class d extends o{constructor(e,t){super();this.options=i.extend({},t),this._data=e,this._container=new THREE.Group}getContainer(){return this._container}getData(){return this._data}onAdd(e){this._map=e}onRemove(e){}}class c extends d{constructor(e,t){super(e,t);const s={isExtrude:!0,depth:.6,isAreaText:!0,fillColor:"#ddd",strokeColor:"#000",strokeOpacity:.5,textColor:"rgba(0, 0, 0, 0.8)",material:{color:65280,side:THREE.DoubleSide}};this.options=i.extend(s,t)}onAdd(e){d.prototype.onAdd.call(this,e),this.draw()}onRemove(e){d.prototype.onRemove.call(this,e)}createFeatureArray(e){var t,s=[];if("Feature"==e.type)s.push(e);else if("FeatureCollection"==e.type)for(var i=0;i<e.features.length;i++)s.push(e.features[i]);else{if("GeometryCollection"!=e.type)throw new Error("The geoJSON is not valid.");for(var o=0;o<e.geometries.length;o++)t={geometry:e.geometries[o]},s.push(t)}return s}createCoordinateArray(e){for(var t=[],s=[],i=0;i<e.length;i++){var o=e[i],r=e[i-1];if(i>0)if(this.needsInterpolation(r,o)){s=[r,o],s=this.interpolatePoints(s);for(var h=0;h<s.length;h++)t.push(s[h])}else t.push(o);else t.push(o)}return t}needsInterpolation(e,t){var s=t[0],i=t[1],o=e[0],r=e[1],h=Math.abs(s-o),n=Math.abs(i-r);return h>5||n>5}interpolatePoints(e){for(var t,s,i=[],o=0;o<e.length-1;o++)t=e[o],s=e[o+1],this.needsInterpolation(s,t)?(i.push(t),i.push(this.getMidpoint(t,s))):i.push(t);return i.push(e[e.length-1]),i.length>e.length?i=this.interpolatePoints(i):i}getMidpoint(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}convertCoordinates(e){return e.map(e=>l.wgs84ToMecator(e))}draw(){var e=this._data,t=(this._container,this.createFeatureArray(e));for(let e=0,s=t.length;e<s;e++){let s=t[e].geometry;if("Point"==s.type)   ;else if("MultiPoint"==s.type)   ;else if("LineString"==s.type)   ;else if("MultiLineString"==s.type)   ;else if("Polygon"==s.type)for(let e=0;e<s.coordinates.length;e++){let t=this.createCoordinateArray(s.coordinates[e]),i=this.convertCoordinates(t);this.drawPolygon(i)}else{if("MultiPolygon"!=s.type)throw new Error("The geoJSON is not valid.");for(let e=0;e<s.coordinates.length;e++)for(let t=0;t<s.coordinates[e].length;t++){let i=this.createCoordinateArray(s.coordinates[e][t]),o=this.convertCoordinates(i);this.drawPolygon(o)}}}}drawPolygon(e){let t=new THREE.Shape;for(let s=0;s<e.length;s++){let i=e[s];0===s?t.moveTo(i[0],i[1]):t.lineTo(i[0],i[1])}t.closePath();var s=new THREE.ExtrudeBufferGeometry(t,{depth:1,bevelEnabled:!1}),i=new THREE.MeshPhongMaterial({color:10066329}),o=new THREE.Mesh(s,i);this._container.add(o)}}s.d(t,"Util",function(){return i}),s.d(t,"ThreeMap",function(){return a}),s.d(t,"GeoJSONLayer",function(){return c})}])});
//# sourceMappingURL=threejsmap.js.map