// !!! 数据视图中，
// 1. 不允许存在经纬度信息中没有的地名，即geoCoordMap里必然要有一个对应的地名
// 2. 不能存在空的数据
// 3. 计数值必须是>=0的数据

// echart库路径 正常本地化是访问不了此路径，需要改成本地化相应的路径上，如：http://ip/daping/echarts.all.min.js
var echartsUrl = chart.info.resourceUrl[0];
// 默认已有省 市经纬度内容
// 若默认的纬度不能匹配到图表的地名，必须增加该地名的经纬度(增加或替换均写在geoCoordMapExtend中）
// 自定义地区经纬度，地名：[纬度，经度]，经纬度可以通过这个工具获取 http://lbs.amap.com/console/show/picker
// var geoCoordMapExtend = {"没有的地名":['1234', 4566], "北京":["116.407526","39.904030"]};
var geoCoordMapExtend = {};
// 轨迹模型：飞机、火车
var modelToUse = 'plane'; // 代表使用飞机，如果要使用火车，请设置为train
var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';
var planeSize = 15; // 宽高都是15
var trainPath = 'path://M20.3908786,62.0857275 L20.3908786,77.285111 L20.4681738,77.285111 L20.4681738,78.6232494 L20.3908786,78.6232494 L20.3908786,92.344484 L9.66292292,92.344484 L9.66292292,45.8795604 L20.3908786,45.8795604 L20.3908786,60.6043876 L20.4681738,60.6043876 L20.4681738,62.0857275 L20.3908786,62.0857275 Z M2.64440006,95.5447034 C2.39712471,95.5193533 2.20602007,95.3162028 2.19581332,95.0678411 L0.000421692266,41.6471671 C-1.36283034e-05,41.6365744 -0.000111938982,41.6259705 0.000126909327,41.6153716 C0.625331232,13.8717905 5.74903712,-5.68434189e-13 15.3712446,0 C24.993698,0 29.8736484,13.8724995 30.0110959,41.6174985 C30.0111414,41.6266812 30.0109339,41.6358634 30.0104736,41.6450347 L27.3288033,95.0843963 C27.3166767,95.3260496 27.133257,95.5243462 26.8932804,95.5552436 C24.2212327,95.8992739 20.3805541,96.0712891 15.3712446,96.0712891 C10.311036,96.0712891 6.06875454,95.8957605 2.64440006,95.5447034 Z M26.7065903,95.1144793 L28.0560483,40.0288157 L24.5545177,46.9512967 L25.3091752,95.1144793 L26.7065903,95.1144793 Z M3.52300017,95.1144793 L4.92041527,95.1144793 L5.67507271,46.9512967 L2.17354212,40.0288157 L3.52300017,95.1144793 Z M15.4234195,17.4113158 C11.5516676,17.4113158 8.41299255,21.6607911 8.41299255,26.9027846 C8.41299255,32.144778 11.5516676,36.3942533 15.4234195,36.3942533 C19.2951714,36.3942533 22.4338464,32.144778 22.4338464,26.9027846 C22.4338464,21.6607911 19.2951714,17.4113158 15.4234195,17.4113158 Z M8.41299255,93.3594408 L21.6143658,93.3594408 L21.6143658,44.546173 L8.41299255,44.546173 L8.41299255,93.3594408 Z M20.3908786,62.0857275 L20.3908786,60.6043876 L9.76141665,60.6043876 L9.76141665,62.0857275 L20.3908786,62.0857275 Z M20.3908786,78.6232494 L20.3908786,77.285111 L9.76141665,77.285111 L9.76141665,78.6232494 L20.3908786,78.6232494 Z';
var trainSize = [8, 24]; // 宽8高24，请按这个比例等比修改尺寸
// 地名、轨迹颜色
var colorA = "#a6c84c";
// 轨迹尾巴
var colorB = '#fff';
// 地图区块颜色
var colorC = '#323c48';
// 地图轮廓颜色
var colorD = '#404a59'
// 鼠标移到地图区块后的颜色
var colorE = '#2a333d';// 背景色
var colorBg = 'transparent';
// 标题
var textTitle = '';
// 标题颜色
var textColor = '#fff';
// 子标题
var subtextTitle = '';
// 标题位置
var leftPos = 'center';
// 地名圆点大小阶梯
var sizeListAll = [2, 4, 6, 8, 10];
// 运行速度
var period = 6;
// 轨迹尾巴大小
var symbolSizeTail = 3;
// 轨迹尾巴宽度
var widthTail = 0;
// 轨迹飞机大小
var symbolSizePlane = 15;
// 轨迹宽度
var widthPlane = 1;
// 边的曲度，支持从 0 到 1 的值，值越大曲度越大
var curveness = 0.2;

// 以下数据需要对应上数据视图
var views0 = chart.views && chart.views[0];
// 兼容旧版本
if (!views0) {
    views0 = chart;
}
// 第一个纬度值
var dataX0 = views0.data.x[0].data;
// 第二个纬度值
var dataX1 = views0.data.x[1].data;
// 第一个数值值
var dataY0 = views0.data.y[0].data;
// 全部series数据
var dataAll = [];
var dataOne = [];
var dataName = "";
// 全部value数据，用于计算点的大小
var valueAll = [];

// 处理数据视图的数据，转化成轨迹图series需要的数组
for (var i = 0, len = dataX0.length; i < len; i ++) {
    if (dataX0[i] == "" || dataX1[i] == "") continue;
    if (i === 0) {
        dataName = dataX0[i];
    }
    if (dataName != dataX0[i]) {
        dataAll.push([dataName, dataOne]);
        dataName = dataX0[i];
        dataOne = [];
    }
    dataOne.push([{name: dataX0[i]}, {name: dataX1[i], value: (+dataY0[i]).toFixed(2)}]);
    valueAll.push(dataY0[i]);
    // 把最后一个存进去
    if (i == len -1) {
        dataAll.push([dataName, dataOne]);
    }
}

var option, myChart, app = {};
thirdPluginLoader({
  libSrc: echartsUrl,
    initFun: function() {
      //console.log("echarts init");
      myChart = echarts.init(chart.$elem.get(0));
      echartsCode();       
      myChart.setOption(option);
    }
}, {funcQueue: []});

function echartsCode() {
    var geoCoordMap = {"北京":["116.407526","39.904030"],"天津":["117.200983","39.084158"],"河北":["114.468665","38.037057"],"山西":["112.562398","37.873532"],"内蒙古":["111.765618","40.817498"],"辽宁":["123.429440","41.835441"],"吉林":["126.549572","43.837883"],"黑龙江":["126.661669","45.742347"],"上海":["121.473701","31.230416"],"江苏":["118.763232","32.061707"],"浙江":["120.152792","30.267447"],"安徽":["117.284923","31.861184"],"福建":["119.295144","26.100780"],"江西":["115.909228","28.675697"],"山东":["117.020359","36.668530"],"河南":["113.753602","34.765515"],"湖北":["114.341862","30.546498"],"湖南":["112.983810","28.112444"],"广东":["113.266531","23.132191"],"广西":["108.327546","22.815478"],"海南":["100.620373","36.286438"],"重庆":["106.551557","29.563010"],"四川":["104.075931","30.651652"],"贵州":["106.707410","26.598194"],"云南":["102.710002","25.045806"],"西藏":["91.117212","29.646923"],"陕西":["108.954239","34.265472"],"甘肃":["103.826308","36.059421"],"青海":["101.780199","36.620901"],"宁夏":["106.258754","38.471318"],"新疆":["87.627704","43.793026"],"台湾":["121.508904","25.044319"],"香港":["114.163825","22.276284"],"澳门":["113.543028","22.186835"],"东城区":["116.416357","39.928353"],"西城区":["116.365868","39.912289"],"朝阳区":["116.443108","39.921470"],"丰台区":["116.287062","39.858470"],"石景山区":["116.222982","39.906611"],"海淀区":["116.298045","39.959907"],"门头沟区":["116.102009","39.940646"],"房山区":["116.143267","39.749144"],"通州区":["116.656437","39.909965"],"顺义区":["116.654812","40.130211"],"昌平区":["116.231204","40.220660"],"大兴区":["116.341395","39.726929"],"怀柔区":["116.631960","40.316570"],"平谷区":["117.121383","40.140701"],"密云县":["116.843037","40.376294"],"延庆县":["115.974848","40.456951"],"和平区":["117.214510","39.116949"],"河东区":["117.251041","39.129499"],"河西区":["117.223372","39.109563"],"南开区":["117.150738","39.138203"],"河北区":["117.196648","39.147869"],"红桥区":["117.151534","39.167346"],"东丽区":["117.314324","39.086569"],"西青区":["117.008874","39.141145"],"津南区":["117.357396","38.937857"],"北辰区":["117.132440","39.221484"],"武清区":["117.044414","39.384060"],"宝坻区":["117.309865","39.717560"],"滨海新区":["117.710776","39.003677"],"宁河县":["117.824898","39.330613"],"静海县":["116.974130","38.947512"],"蓟县":["117.408280","40.045865"],"石家庄":["114.514860","38.042307"],"唐山":["118.180194","39.630867"],"秦皇岛":["119.600493","39.935385"],"邯郸":["114.538962","36.625657"],"邢台":["114.504844","37.070589"],"保定":["115.464806","38.873891"],"张家口":["114.887543","40.824418"],"承德":["117.962411","40.954071"],"沧州":["116.838835","38.304477"],"廊坊":["116.683752","39.538047"],"衡水":["115.670177","37.738920"],"太原":["112.548879","37.870590"],"大同":["113.300129","40.076763"],"阳泉":["113.580519","37.856972"],"长治":["113.116255","36.195386"],"晋城":["112.851831","35.490702"],"朔州":["112.432825","39.331595"],"晋中":["112.752695","37.687024"],"运城":["111.007529","35.026412"],"忻州":["112.734174","38.416663"],"临汾":["111.518976","36.088005"],"吕梁":["111.144319","37.518314"],"呼和浩特":["111.749181","40.842585"],"包头":["109.840347","40.657449"],"乌海":["106.794249","39.655389"],"赤峰":["118.886856","42.257817"],"通辽":["122.243444","43.652890"],"鄂尔多斯":["109.781327","39.608266"],"呼伦贝尔":["119.765745","49.211575"],"巴彦淖尔":["107.387657","40.743213"],"乌兰察布":["113.132585","40.994786"],"兴安盟":["122.067042","46.077561"],"锡林郭勒盟":["116.048222","43.933454"],"阿拉善盟":["105.728969","38.851892"],"沈阳":["123.431475","41.805698"],"大连":["121.614682","38.914003"],"鞍山":["122.994329","41.108647"],"抚顺":["123.957208","41.880872"],"本溪":["123.766485","41.294176"],"丹东":["124.354707","40.000500"],"锦州":["121.127004","41.095120"],"营口":["122.235418","40.667012"],"阜新":["121.670324","42.021619"],"辽阳":["123.236944","41.267244"],"盘锦":["122.070714","41.119997"],"铁岭":["123.726166","42.223769"],"朝阳":["120.450372","41.573734"],"葫芦岛":["120.836932","40.711052"],"长春":["125.323544","43.817072"],"四平":["124.350398","43.166420"],"辽源":["125.143532","42.887918"],"通化":["125.939697","41.728401"],"白山":["126.423587","41.939994"],"松原":["124.825118","45.141789"],"白城":["122.839024","45.619641"],"延边":["129.508946","42.891254"],"哈尔滨":["126.534967","45.803775"],"齐齐哈尔":["123.918186","47.354348"],"鸡西":["130.969333","45.295075"],"鹤岗":["130.297964","47.349916"],"双鸭山":["131.159133","46.646509"],"大庆":["125.103784","46.589310"],"伊春":["128.841148","47.727536"],"佳木斯":["130.318917","46.799923"],"七台河":["131.003138","45.771727"],"牡丹江":["129.633169","44.551653"],"黑河":["127.528560","50.245329"],"绥化":["126.968887","46.653845"],"大兴安岭":["124.711081","52.335206"],"黄浦区":["121.484443","31.231763"],"徐汇区":["121.436525","31.188523"],"长宁区":["121.424629","31.220367"],"静安区":["121.447568","31.227935"],"普陀区":["121.395555","31.249840"],"闸北区":["121.459382","31.247111"],"虹口区":["121.505126","31.264579"],"杨浦区":["121.526074","31.259547"],"闵行区":["121.381709","31.112813"],"宝山区":["121.489612","31.405457"],"嘉定区":["121.265300","31.375602"],"浦东新区":["121.544379","31.221517"],"金山区":["121.341970","30.741991"],"松江区":["121.227747","31.032243"],"青浦区":["121.124178","31.150681"],"奉贤区":["121.474042","30.917795"],"崇明县":["121.397417","31.623587"],"南京":["118.796877","32.060255"],"无锡":["120.311910","31.491170"],"徐州":["117.284124","34.205768"],"常州":["119.973987","31.810689"],"苏州":["120.585316","31.298886"],"南通":["120.894291","31.980172"],"连云港":["119.221611","34.596653"],"淮安":["119.015286","33.610354"],"盐城":["120.163562","33.347383"],"扬州":["119.412966","32.394210"],"镇江":["119.425836","32.187849"],"泰州":["119.923116","32.455778"],"宿迁":["118.275198","33.963232"],"杭州":["120.155070","30.274085"],"宁波":["121.550357","29.874557"],"温州":["120.699367","27.994267"],"嘉兴":["120.755486","30.746129"],"湖州":["120.086823","30.894348"],"绍兴":["120.580232","30.029753"],"金华":["119.647445","29.079059"],"衢州":["118.859457","28.970080"],"舟山":["122.207216","29.985295"],"台州":["121.420757","28.656386"],"丽水":["119.922796","28.467630"],"合肥":["117.227239","31.820587"],"芜湖":["118.432941","31.352859"],"蚌埠":["117.389719","32.916287"],"淮南":["116.999933","32.625478"],"马鞍山":["118.506760","31.670452"],"淮北":["116.798265","33.955845"],"铜陵":["117.812079","30.945430"],"安庆":["117.063755","30.543494"],"黄山":["118.337482","29.714656"],"滁州":["118.317107","32.301556"],"阜阳":["115.814205","32.890124"],"宿州":["116.964356","33.646373"],"六安":["116.521855","31.733700"],"亳州":["115.778676","33.844582"],"池州":["117.491568","30.664800"],"宣城":["118.758816","30.940718"],"福州":["119.296494","26.074508"],"厦门":["118.089425","24.479834"],"莆田":["119.007777","25.454085"],"三明":["117.638678","26.263407"],"泉州":["118.675676","24.874132"],"漳州":["117.647481","24.512949"],"南平":["118.177708","26.641769"],"龙岩":["117.017537","25.075123"],"宁德":["119.547933","26.665617"],"南昌":["115.858198","28.682892"],"景德镇":["117.178420","29.268836"],"萍乡":["113.854556","27.622768"],"九江":["116.001930","29.705078"],"新余":["114.917347","27.817809"],"鹰潭":["117.069202","28.260189"],"赣州":["114.935030","25.831829"],"吉安":["114.992509","27.113443"],"宜春":["114.416778","27.815619"],"抚州":["116.358182","27.949217"],"上饶":["117.943433","28.454863"],"济南":["117.120000","36.651216"],"青岛":["120.382640","36.067082"],"淄博":["118.054927","36.813487"],"枣庄":["117.323725","34.810488"],"东营":["118.674767","37.434751"],"烟台":["121.447935","37.463822"],"潍坊":["119.161756","36.706774"],"济宁":["116.587099","35.414921"],"泰安":["117.087614","36.200252"],"威海":["122.120420","37.513068"],"日照":["119.526888","35.416377"],"莱芜":["117.676724","36.213814"],"临沂":["118.356448","35.104672"],"德州":["116.357465","37.434093"],"聊城":["115.985371","36.456704"],"滨州":["117.970703","37.381990"],"菏泽":["115.480656","35.233750"],"郑州":["113.625368","34.746600"],"开封":["114.307582","34.797239"],"洛阳":["112.454040","34.619683"],"平顶山":["113.192661","33.766170"],"安阳":["114.392393","36.097577"],"鹤壁":["114.297273","35.747225"],"新乡":["113.926800","35.303004"],"焦作":["113.241823","35.215893"],"濮阳":["115.029216","35.761829"],"许昌":["113.852640","34.035506"],"漯河":["114.016539","33.581413"],"三门峡":["111.200135","34.772494"],"南阳":["112.528322","32.990833"],"商丘":["115.656370","34.414172"],"信阳":["114.091023","32.146984"],"周口":["114.696951","33.626149"],"驻马店":["114.022298","33.011529"],"济源市":["112.601919","35.067243"],"武汉":["114.305393","30.593099"],"黄石":["115.038520","30.199652"],"十堰":["110.797991","32.629397"],"宜昌":["111.286471","30.691967"],"襄阳":["112.122415","32.008986"],"鄂州":["114.894843","30.391940"],"荆门":["112.199265","31.035423"],"孝感":["113.916903","30.924568"],"荆州":["112.239741","30.335165"],"黄冈":["114.872316","30.453906"],"咸宁":["114.322492","29.841443"],"随州":["113.382458","31.690216"],"恩施":["109.488172","30.272156"],"仙桃市":["113.454593","30.362641"],"潜江市":["112.900079","30.402110"],"天门市":["113.166530","30.663372"],"神农架林区":["110.680448","31.743483"],"长沙":["112.938814","28.228209"],"株洲":["113.134003","27.827550"],"湘潭":["112.944049","27.829738"],"衡阳":["112.571997","26.893231"],"邵阳":["111.467791","27.238893"],"岳阳":["113.128958","29.357104"],"常德":["111.698497","29.031673"],"张家界":["110.479191","29.117096"],"益阳":["112.355180","28.553860"],"郴州":["113.014718","25.770510"],"永州":["111.613445","26.420394"],"怀化":["109.998488","27.554978"],"娄底":["111.993497","27.700063"],"湘西":["109.739172","28.311948"],"广州":["113.264435","23.129163"],"韶关":["113.597522","24.810403"],"深圳":["114.057868","22.543099"],"珠海":["113.576726","22.270715"],"汕头":["116.681972","23.354091"],"佛山":["113.121416","23.021548"],"江门":["113.081901","22.578738"],"湛江":["110.359377","21.270708"],"茂名":["110.925456","21.662999"],"肇庆":["112.465091","23.047192"],"惠州":["114.416196","23.111847"],"梅州":["116.122239","24.288615"],"汕尾":["115.375279","22.786211"],"河源":["114.700447","23.743538"],"阳江":["111.982232","21.857958"],"清远":["113.056031","23.681764"],"东莞":["113.751765","23.020536"],"中山":["113.392782","22.517646"],"东沙群岛":["116.887312","20.617512"],"潮州":["116.622604","23.656950"],"揭阳":["116.372831","23.549993"],"云浮":["112.044491","22.915094"],"南宁":["108.366543","22.817002"],"柳州":["109.415953","24.325502"],"桂林":["110.290195","25.273566"],"梧州":["111.279115","23.476963"],"北海":["109.119927","21.481254"],"防城港":["108.353847","21.686860"],"钦州":["108.654147","21.979934"],"贵港":["109.598927","23.111531"],"玉林":["110.164756","22.636379"],"百色":["106.618201","23.902333"],"贺州":["111.566694","24.403582"],"河池":["108.085261","24.692931"],"来宾":["109.221466","23.750306"],"崇左":["107.364711","22.376533"],"海口":["110.198293","20.044002"],"三亚":["109.511909","18.252847"],"三沙":["112.338696","16.831840"],"五指山市":["109.516925","18.775147"],"琼海市":["110.474648","19.258342"],"儋州市":["109.580811","19.521134"],"文昌市":["110.797698","19.543322"],"万宁市":["110.391073","18.795143"],"东方市":["108.651815","19.095351"],"定安县":["110.358891","19.681434"],"屯昌县":["110.103415","19.351766"],"澄迈县":["110.006755","19.738521"],"临高县":["109.690508","19.912026"],"白沙黎族自治县":["109.451474","19.224872"],"昌江黎族自治县":["109.055719","19.298045"],"乐东黎族自治县":["109.173055","18.750260"],"陵水黎族自治县":["110.037504","18.506048"],"保亭黎族苗族自治县":["109.702590","18.639130"],"琼中黎族苗族自治县":["109.838389","19.033369"],"万州区":["108.408746","30.807823"],"涪陵区":["107.389298","29.703113"],"渝中区":["106.568892","29.552750"],"大渡口区":["106.482284","29.484595"],"江北区":["106.574271","29.606703"],"沙坪坝区":["106.456966","29.541134"],"九龙坡区":["106.510816","29.502302"],"南岸区":["106.563586","29.522440"],"北碚区":["106.395569","29.805098"],"綦江区":["106.651362","29.028067"],"大足区":["105.721733","29.707032"],"渝北区":["106.631052","29.718171"],"巴南区":["106.540295","29.402409"],"黔江区":["108.770458","29.533884"],"长寿区":["107.081283","29.857996"],"江津区":["106.259281","29.290069"],"合川区":["106.276130","29.972084"],"永川区":["105.927376","29.356117"],"南川区":["107.099266","29.157891"],"潼南县":["105.840556","30.191013"],"铜梁县":["106.056404","29.844811"],"荣昌县":["105.594623","29.405003"],"璧山县":["106.227305","29.592024"],"梁平县":["107.803911","30.674362"],"城口县":["108.664260","31.947695"],"丰都县":["107.730895","29.863500"],"垫江县":["107.333390","30.327717"],"武隆县":["107.759913","29.325497"],"忠县":["108.039002","30.299560"],"开县":["108.393135","31.160711"],"云阳县":["108.697293","30.930615"],"奉节县":["109.463987","31.018498"],"巫山县":["109.879153","31.074834"],"巫溪县":["109.570062","31.398604"],"石柱土家族自治县":["108.114069","29.999285"],"秀山土家族苗族自治县":["109.007094","28.447997"],"酉阳土家族苗族自治县":["108.767731","28.841196"],"彭水苗族土家族自治县":["108.165545","29.293963"],"成都":["104.066541","30.572269"],"自贡":["104.778442","29.339030"],"攀枝花":["101.718637","26.582347"],"泸州":["105.442258","28.871811"],"德阳":["104.397894","31.126856"],"绵阳":["104.679114","31.467450"],"广元":["105.843357","32.435435"],"遂宁":["105.592898","30.532847"],"内江":["105.058433","29.580229"],"乐山":["103.765568","29.552106"],"南充":["106.110698","30.837793"],"眉山":["103.848538","30.075440"],"宜宾":["104.643215","28.751769"],"广安":["106.633212","30.455962"],"达州":["107.468023","31.209572"],"雅安":["103.013261","29.980537"],"巴中":["106.747478","31.867903"],"资阳":["104.627636","30.128901"],"阿坝":["102.224653","31.899413"],"甘孜":["101.962311","30.049520"],"凉山":["102.267335","27.881611"],"贵阳":["106.630154","26.647661"],"六盘水":["104.830359","26.592666"],"遵义":["106.927389","27.725654"],"安顺":["105.947594","26.253072"],"毕节":["105.283992","27.302589"],"铜仁":["109.189598","27.731515"],"黔西南":["104.906397","25.087825"],"黔东南":["107.982859","26.583442"],"黔南":["107.522098","26.254092"],"昆明":["102.832892","24.880095"],"曲靖":["103.796167","25.490000"],"玉溪":["102.546543","24.352036"],"保山":["99.161761","25.112046"],"昭通":["103.717465","27.338257"],"丽江":["100.227751","26.855047"],"普洱":["100.966512","22.825066"],"临沧":["100.079583","23.877573"],"楚雄":["101.528069","25.045532"],"红河":["103.374799","23.363130"],"文山":["104.216248","23.400733"],"西双版纳":["100.797777","22.007351"],"大理":["100.267638","25.606486"],"德宏":["98.584895","24.433353"],"怒江":["98.853097","25.852548"],"迪庆":["99.702234","27.818882"],"拉萨":["91.140856","29.645554"],"昌都":["97.172020","31.140969"],"山南":["91.773134","29.237137"],"日喀则":["88.880583","29.266870"],"那曲":["92.051239","31.476202"],"阿里":["80.105804","32.501111"],"林芝":["94.361490","29.649128"],"西安":["108.940175","34.341568"],"铜川":["108.945233","34.896756"],"宝鸡":["107.237974","34.361980"],"咸阳":["108.708991","34.329605"],"渭南":["109.509786","34.499995"],"延安":["109.489727","36.585455"],"汉中":["107.023323","33.067480"],"榆林":["109.734589","38.285390"],"安康":["109.029022","32.684715"],"商洛":["109.940477","33.870422"],"兰州":["103.834304","36.061089"],"嘉峪关":["98.293431","39.769734"],"金昌":["102.188043","38.520089"],"白银":["104.138560","36.544756"],"天水":["105.724947","34.580864"],"武威":["102.638011","37.928265"],"张掖":["100.449818","38.925875"],"平凉":["106.665240","35.543051"],"酒泉":["98.494483","39.732411"],"庆阳":["107.643631","35.709077"],"定西":["104.626282","35.580663"],"陇南":["104.921841","33.400685"],"临夏":["103.210539","35.601182"],"甘南":["102.911027","34.983386"],"西宁":["101.778228","36.617144"],"海东":["102.104287","36.502040"],"海北":["100.900998","36.954413"],"黄南":["102.015248","35.519549"],"果洛":["100.244809","34.471431"],"玉树":["97.091934","33.011674"],"海西":["97.369752","37.377139"],"银川":["106.230909","38.487194"],"石嘴山":["106.383304","38.983236"],"吴忠":["106.198394","37.997461"],"固原":["106.242610","36.015855"],"中卫":["105.196902","37.499973"],"乌鲁木齐":["87.616848","43.825592"],"克拉玛依":["84.889207","45.579889"],"吐鲁番":["89.189655","42.951384"],"哈密":["93.514917","42.818501"],"昌吉":["87.308225","44.011183"],"博尔塔拉":["82.066159","44.905588"],"巴音郭楞":["86.145298","41.764115"],"阿克苏":["80.260605","41.168779"],"克孜勒苏":["76.167819","39.714526"],"喀什":["75.989755","39.470400"],"和田":["79.922211","37.114157"],"伊犁":["81.324136","43.916823"],"塔城":["82.980317","46.745364"],"阿勒泰":["88.141253","47.844924"],"石河子市":["86.080602","44.306097"],"阿拉尔市":["81.280527","40.547653"],"图木舒克市":["79.069332","39.864867"],"五家渠市":["87.543240","44.166757"],"中西区":["114.154334","22.281931"],"湾仔区":["114.182990","22.276345"],"东区":["114.225965","22.279779"],"南区":["114.160023","22.245811"],"油尖旺区":["114.173347","22.311632"],"深水埗区":["114.163349","22.333775"],"九龙城区":["114.193047","22.312373"],"黄大仙区":["114.203985","22.336112"],"观塘区":["114.214083","22.320679"],"荃湾区":["114.121234","22.368458"],"屯门区":["113.976308","22.393896"],"元朗区":["114.032528","22.441320"],"北区":["114.147404","22.496143"],"大埔区":["114.171713","22.445730"],"西贡区":["114.264813","22.314203"],"沙田区":["114.195126","22.379715"],"葵青区":["114.139180","22.363908"],"离岛区":["113.946059","22.286371"],"花地玛堂区":["113.552965","22.207882"],"花王堂区":["113.549052","22.199175"],"望德堂区":["113.550252","22.193791"],"大堂区":["113.553740","22.188119"],"风顺堂区":["113.541670","22.187778"],"嘉模堂区":["113.558783","22.154124"],"路凼填海区":["113.569250","22.136546"],"圣方济各堂区":["113.559954","22.124049"]};    // 合并新增进来的geo
    geoCoordMap = $.extend({}, geoCoordMap, geoCoordMapExtend)

    var convertData = function (data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
            var dataItem = data[i];
            var fromCoord = geoCoordMap[dataItem[0].name];
            var toCoord = geoCoordMap[dataItem[1].name];
            if (fromCoord && toCoord) {
                res.push({
                    fromName: dataItem[0].name,
                    toName: dataItem[1].name,
                    coords: [fromCoord, toCoord]
                });
            }
        }
        return res;
    };
    // 分组点大小，2 4 6 8 10
    var symbolSizeCal = function(val) {
        // 分组点大小阶梯
        var sizeList = sizeListAll;
        // 全部数据，由小到大排序
        var valueAllSort = valueAll.sort(function(a, b){return a - b;});
        // 数据长度
        var valueLen = valueAllSort.length;
        // 当前val处于哪个位置
        var index = valueAllSort.indexOf(val);
        // 步长
        var sep = Math.floor(valueLen / sizeList.length);

        // 兼容，不在数据组时，按0计算(一般不可能不在数据组里)
        if (index < 0) {
            index = 0;
        }
        // 不满足5个步长时，则直接取值
        if (valueLen <= sizeList.length) {
            return sizeList[index];
        } else {
            return sizeList[Math.ceil(index/sep)];
        }
    };

    var series = [];
    dataAll.forEach(function (item, i) {
        series.push({
            name: item[0],
            type: 'lines',
            zlevel: 1,
            effect: {
                show: true,
                period: period,
                trailLength: 0.7,
                color: colorB,
                symbolSize: symbolSizeTail
            },
            lineStyle: {
                normal: {
                    color: colorA,
                    width: widthTail,
                    curveness: curveness
                }
            },
            data: convertData(item[1])
        },
        {
            name: item[0],
            type: 'lines',
            zlevel: 2,
            symbol: ['none', 'arrow'],
            symbolSize: 10,
            effect: {
                show: true,
                period: period,
                trailLength: 0,
                symbol: modelToUse == 'train' ? trainPath : planePath,
                symbolSize: modelToUse == 'train' ? trainSize : planeSize
            },
            lineStyle: {
                normal: {
                    color: colorA,
                    width: widthPlane,
                    opacity: 0.6,
                    curveness: curveness
                }
            },
            tooltip: {
                formatter: function(e) {
                    return item[1][e.dataIndex][0].name + '-' + item[1][e.dataIndex][1].name + ": " + item[1][e.dataIndex][1].value;
                }
            },
            data: convertData(item[1])
        },
        {
            name: item[0],
            type: 'effectScatter',
            coordinateSystem: 'geo',
            zlevel: 2,            rippleEffect: {
                brushType: 'stroke'
            },
            label: {
                normal: {
                    show: true,
                    position: 'right',
                    formatter: '{b}'
                }
            },
            symbolSize: function (val) {
                return symbolSizeCal(val[2]);
            },
            tooltip: {
                formatter: function(e) {
                    return item[1][e.dataIndex][0].name + '-' + item[1][e.dataIndex][1].name + ": " + item[1][e.dataIndex][1].value;
                }
            },
            itemStyle: {
                normal: {
                    color: colorA
                }
            },
            data: item[1].map(function (dataItem) {
                var coord = geoCoordMap[dataItem[0].name];
                if (!coord) {
                  console.log(dataItem[0].name + "的经纬度坐标不存在");
                  coord = [0, 0];
                }
                return {
                    name: dataItem[0].name,
                    value: coord.concat([dataItem[0].value])
                };
            })
        });
    });

    option = {
        backgroundColor: colorBg,  // 背景色
        title : {
            text: textTitle, // 标题
            subtext: subtextTitle,  // 子标题
            left: leftPos,
            textStyle : {
                color: textColor
            }
        },
        tooltip : {
            trigger: 'item'
        },
        geo: {
            map: 'china',
            label: {
                emphasis: {
                    show: false
                }
            },
            roam: true,
            itemStyle: {
                normal: {
                    areaColor: colorC,  // 地图区块颜色
                    borderColor: colorD  // 地图轮廓颜色
                },
                emphasis: {
                    areaColor: colorE  // 鼠标移到地图区块后的颜色
                }
            }
        },
        series: series
    };

  // 粘贴代码结束
}
  
